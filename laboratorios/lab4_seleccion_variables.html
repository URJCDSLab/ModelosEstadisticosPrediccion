<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.21">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Víctor Aceña Gil - Isaac Martín de Diego">
<meta name="dcterms.date" content="2025-09-03">

<title>Laboratorio 4: Selección de Variables, Regularización y Validación</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="lab4_seleccion_variables_files/libs/clipboard/clipboard.min.js"></script>
<script src="lab4_seleccion_variables_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="lab4_seleccion_variables_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="lab4_seleccion_variables_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="lab4_seleccion_variables_files/libs/quarto-html/popper.min.js"></script>
<script src="lab4_seleccion_variables_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="lab4_seleccion_variables_files/libs/quarto-html/anchor.min.js"></script>
<link href="lab4_seleccion_variables_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="lab4_seleccion_variables_files/libs/quarto-html/quarto-syntax-highlighting-ea1d7ac60288e0f1efdbc993fd8432ae.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="lab4_seleccion_variables_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="lab4_seleccion_variables_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="lab4_seleccion_variables_files/libs/bootstrap/bootstrap-4d7f0bce1131f3e5f9547cd857cfbfc8.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#objetivos-del-laboratorio" id="toc-objetivos-del-laboratorio" class="nav-link active" data-scroll-target="#objetivos-del-laboratorio">Objetivos del Laboratorio</a></li>
  <li><a href="#configuración-inicial" id="toc-configuración-inicial" class="nav-link" data-scroll-target="#configuración-inicial">Configuración Inicial</a></li>
  <li><a href="#parte-1-preparación-de-datos-y-análisis-exploratorio" id="toc-parte-1-preparación-de-datos-y-análisis-exploratorio" class="nav-link" data-scroll-target="#parte-1-preparación-de-datos-y-análisis-exploratorio">Parte 1: Preparación de Datos y Análisis Exploratorio</a>
  <ul class="collapse">
  <li><a href="#dataset-de-trabajo" id="toc-dataset-de-trabajo" class="nav-link" data-scroll-target="#dataset-de-trabajo">Dataset de Trabajo</a></li>
  <li><a href="#visualización-de-relaciones" id="toc-visualización-de-relaciones" class="nav-link" data-scroll-target="#visualización-de-relaciones">Visualización de Relaciones</a></li>
  </ul></li>
  <li><a href="#parte-2-filtrado-basado-en-información-básica" id="toc-parte-2-filtrado-basado-en-información-básica" class="nav-link" data-scroll-target="#parte-2-filtrado-basado-en-información-básica">Parte 2: Filtrado Basado en Información Básica</a>
  <ul class="collapse">
  <li><a href="#análisis-de-variabilidad" id="toc-análisis-de-variabilidad" class="nav-link" data-scroll-target="#análisis-de-variabilidad">Análisis de Variabilidad</a></li>
  <li><a href="#análisis-de-correlación-con-variable-respuesta" id="toc-análisis-de-correlación-con-variable-respuesta" class="nav-link" data-scroll-target="#análisis-de-correlación-con-variable-respuesta">Análisis de Correlación con Variable Respuesta</a></li>
  <li><a href="#análisis-de-multicolinealidad" id="toc-análisis-de-multicolinealidad" class="nav-link" data-scroll-target="#análisis-de-multicolinealidad">Análisis de Multicolinealidad</a></li>
  <li><a href="#resumen-del-filtrado-inicial" id="toc-resumen-del-filtrado-inicial" class="nav-link" data-scroll-target="#resumen-del-filtrado-inicial">Resumen del Filtrado Inicial</a></li>
  </ul></li>
  <li><a href="#parte-3-criterios-de-bondad-de-ajuste" id="toc-parte-3-criterios-de-bondad-de-ajuste" class="nav-link" data-scroll-target="#parte-3-criterios-de-bondad-de-ajuste">Parte 3: Criterios de Bondad de Ajuste</a>
  <ul class="collapse">
  <li><a href="#modelos-candidatos-con-diferentes-números-de-variables" id="toc-modelos-candidatos-con-diferentes-números-de-variables" class="nav-link" data-scroll-target="#modelos-candidatos-con-diferentes-números-de-variables">Modelos Candidatos con Diferentes Números de Variables</a></li>
  <li><a href="#comparación-usando-aic-bic-y-cp-de-mallows" id="toc-comparación-usando-aic-bic-y-cp-de-mallows" class="nav-link" data-scroll-target="#comparación-usando-aic-bic-y-cp-de-mallows">Comparación usando AIC, BIC y Cp de Mallows</a></li>
  <li><a href="#visualización-de-criterios" id="toc-visualización-de-criterios" class="nav-link" data-scroll-target="#visualización-de-criterios">Visualización de Criterios</a></li>
  </ul></li>
  <li><a href="#parte-4-métodos-de-selección-exhaustiva" id="toc-parte-4-métodos-de-selección-exhaustiva" class="nav-link" data-scroll-target="#parte-4-métodos-de-selección-exhaustiva">Parte 4: Métodos de Selección Exhaustiva</a>
  <ul class="collapse">
  <li><a href="#best-subset-selection" id="toc-best-subset-selection" class="nav-link" data-scroll-target="#best-subset-selection">Best Subset Selection</a></li>
  <li><a href="#visualización-del-best-subset-selection" id="toc-visualización-del-best-subset-selection" class="nav-link" data-scroll-target="#visualización-del-best-subset-selection">Visualización del Best Subset Selection</a></li>
  </ul></li>
  <li><a href="#parte-5-métodos-automáticos-paso-a-paso" id="toc-parte-5-métodos-automáticos-paso-a-paso" class="nav-link" data-scroll-target="#parte-5-métodos-automáticos-paso-a-paso">Parte 5: Métodos Automáticos Paso a Paso</a>
  <ul class="collapse">
  <li><a href="#forward-selection" id="toc-forward-selection" class="nav-link" data-scroll-target="#forward-selection">Forward Selection</a></li>
  <li><a href="#backward-elimination" id="toc-backward-elimination" class="nav-link" data-scroll-target="#backward-elimination">Backward Elimination</a></li>
  <li><a href="#stepwise-selection" id="toc-stepwise-selection" class="nav-link" data-scroll-target="#stepwise-selection">Stepwise Selection</a></li>
  <li><a href="#comparación-de-variables-seleccionadas" id="toc-comparación-de-variables-seleccionadas" class="nav-link" data-scroll-target="#comparación-de-variables-seleccionadas">Comparación de Variables Seleccionadas</a></li>
  </ul></li>
  <li><a href="#parte-6-métodos-de-regularización" id="toc-parte-6-métodos-de-regularización" class="nav-link" data-scroll-target="#parte-6-métodos-de-regularización">Parte 6: Métodos de Regularización</a>
  <ul class="collapse">
  <li><a href="#preparación-de-datos-para-regularización" id="toc-preparación-de-datos-para-regularización" class="nav-link" data-scroll-target="#preparación-de-datos-para-regularización">Preparación de Datos para Regularización</a></li>
  <li><a href="#ridge-regression" id="toc-ridge-regression" class="nav-link" data-scroll-target="#ridge-regression">Ridge Regression</a></li>
  <li><a href="#lasso-regression" id="toc-lasso-regression" class="nav-link" data-scroll-target="#lasso-regression">Lasso Regression</a></li>
  <li><a href="#elastic-net" id="toc-elastic-net" class="nav-link" data-scroll-target="#elastic-net">Elastic Net</a></li>
  <li><a href="#comparación-de-métodos-de-regularización" id="toc-comparación-de-métodos-de-regularización" class="nav-link" data-scroll-target="#comparación-de-métodos-de-regularización">Comparación de Métodos de Regularización</a></li>
  </ul></li>
  <li><a href="#parte-7-validación-rigurosa-del-modelo" id="toc-parte-7-validación-rigurosa-del-modelo" class="nav-link" data-scroll-target="#parte-7-validación-rigurosa-del-modelo">Parte 7: Validación Rigurosa del Modelo</a>
  <ul class="collapse">
  <li><a href="#partición-final-de-datos" id="toc-partición-final-de-datos" class="nav-link" data-scroll-target="#partición-final-de-datos">Partición Final de Datos</a></li>
  <li><a href="#validación-cruzada-de-modelos-seleccionados" id="toc-validación-cruzada-de-modelos-seleccionados" class="nav-link" data-scroll-target="#validación-cruzada-de-modelos-seleccionados">Validación Cruzada de Modelos Seleccionados</a></li>
  <li><a href="#evaluación-final-en-datos-no-vistos" id="toc-evaluación-final-en-datos-no-vistos" class="nav-link" data-scroll-target="#evaluación-final-en-datos-no-vistos">Evaluación Final en Datos No Vistos</a></li>
  <li><a href="#diagnóstico-visual-del-modelo-final" id="toc-diagnóstico-visual-del-modelo-final" class="nav-link" data-scroll-target="#diagnóstico-visual-del-modelo-final">Diagnóstico Visual del Modelo Final</a></li>
  </ul></li>
  <li><a href="#parte-8-ejercicios-prácticos" id="toc-parte-8-ejercicios-prácticos" class="nav-link" data-scroll-target="#parte-8-ejercicios-prácticos">Parte 8: Ejercicios Prácticos</a>
  <ul class="collapse">
  <li><a href="#ejercicio-1-dataset-mtcars" id="toc-ejercicio-1-dataset-mtcars" class="nav-link" data-scroll-target="#ejercicio-1-dataset-mtcars">Ejercicio 1: Dataset mtcars</a></li>
  <li><a href="#ejercicio-2-dataset-simulado-con-ruido" id="toc-ejercicio-2-dataset-simulado-con-ruido" class="nav-link" data-scroll-target="#ejercicio-2-dataset-simulado-con-ruido">Ejercicio 2: Dataset Simulado con Ruido</a></li>
  <li><a href="#ejercicio-3-comparación-sistemática" id="toc-ejercicio-3-comparación-sistemática" class="nav-link" data-scroll-target="#ejercicio-3-comparación-sistemática">Ejercicio 3: Comparación Sistemática</a></li>
  </ul></li>
  <li><a href="#parte-9-conceptos-clave-para-recordar" id="toc-parte-9-conceptos-clave-para-recordar" class="nav-link" data-scroll-target="#parte-9-conceptos-clave-para-recordar">Parte 9: Conceptos Clave para Recordar</a>
  <ul class="collapse">
  <li><a href="#resumen-de-métodos" id="toc-resumen-de-métodos" class="nav-link" data-scroll-target="#resumen-de-métodos">Resumen de Métodos</a></li>
  <li><a href="#métricas-de-validación" id="toc-métricas-de-validación" class="nav-link" data-scroll-target="#métricas-de-validación">Métricas de Validación</a></li>
  <li><a href="#señales-de-alerta" id="toc-señales-de-alerta" class="nav-link" data-scroll-target="#señales-de-alerta">Señales de Alerta</a></li>
  <li><a href="#mejores-prácticas" id="toc-mejores-prácticas" class="nav-link" data-scroll-target="#mejores-prácticas">Mejores Prácticas</a></li>
  </ul></li>
  <li><a href="#próximo-laboratorio" id="toc-próximo-laboratorio" class="nav-link" data-scroll-target="#próximo-laboratorio">Próximo Laboratorio</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Laboratorio 4: Selección de Variables, Regularización y Validación</h1>
<p class="subtitle lead">Modelos Estadísticos de Predicción</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Víctor Aceña Gil - Isaac Martín de Diego </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 3, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="objetivos-del-laboratorio" class="level2">
<h2 class="anchored" data-anchor-id="objetivos-del-laboratorio">Objetivos del Laboratorio</h2>
<p>Al finalizar este laboratorio, serás capaz de:</p>
<ul>
<li>Aplicar filtros básicos para eliminación preliminar de variables</li>
<li>Utilizar criterios de información (AIC, BIC, Cp) para comparar modelos</li>
<li>Implementar métodos de selección exhaustiva (Best Subset Selection)</li>
<li>Ejecutar métodos automáticos paso a paso (forward, backward, stepwise)</li>
<li>Aplicar técnicas de regularización (Ridge, Lasso, Elastic Net)</li>
<li>Validar modelos usando estrategias train/test y validación cruzada</li>
<li>Interpretar métricas de rendimiento predictivo</li>
</ul>
</section>
<section id="configuración-inicial" class="level2">
<h2 class="anchored" data-anchor-id="configuración-inicial">Configuración Inicial</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cargar librerías necesarias</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressPackageStartupMessages</span>({</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(tidyverse)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(car)          <span class="co"># Para VIF</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(leaps)        <span class="co"># Para best subset selection</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(glmnet)       <span class="co"># Para regularización</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(caret)        <span class="co"># Para validación cruzada</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(corrplot)     <span class="co"># Para matrices de correlación</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(MASS)         <span class="co"># Para métodos stepwise</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(broom)        <span class="co"># Para resultados ordenados</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(gridExtra)    <span class="co"># Para múltiples gráficos</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="parte-1-preparación-de-datos-y-análisis-exploratorio" class="level2">
<h2 class="anchored" data-anchor-id="parte-1-preparación-de-datos-y-análisis-exploratorio">Parte 1: Preparación de Datos y Análisis Exploratorio</h2>
<section id="dataset-de-trabajo" class="level3">
<h3 class="anchored" data-anchor-id="dataset-de-trabajo">Dataset de Trabajo</h3>
<p>Utilizaremos el dataset Boston Housing para demonstrar todas las técnicas. Este dataset contiene información sobre precios de viviendas en Boston y sus características.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cargar y explorar el dataset</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Boston)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Información básica del dataset</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== INFORMACIÓN DEL DATASET ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== INFORMACIÓN DEL DATASET ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Dimensiones:"</span>, <span class="fu">nrow</span>(Boston), <span class="st">"observaciones,"</span>, <span class="fu">ncol</span>(Boston), <span class="st">"variables</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dimensiones: 506 observaciones, 14 variables</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mostrar las primeras filas</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Boston)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>     crim zn indus chas   nox    rm  age    dis rad tax ptratio  black lstat
1 0.00632 18  2.31    0 0.538 6.575 65.2 4.0900   1 296    15.3 396.90  4.98
2 0.02731  0  7.07    0 0.469 6.421 78.9 4.9671   2 242    17.8 396.90  9.14
3 0.02729  0  7.07    0 0.469 7.185 61.1 4.9671   2 242    17.8 392.83  4.03
4 0.03237  0  2.18    0 0.458 6.998 45.8 6.0622   3 222    18.7 394.63  2.94
5 0.06905  0  2.18    0 0.458 7.147 54.2 6.0622   3 222    18.7 396.90  5.33
6 0.02985  0  2.18    0 0.458 6.430 58.7 6.0622   3 222    18.7 394.12  5.21
  medv
1 24.0
2 21.6
3 34.7
4 33.4
5 36.2
6 28.7</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Resumen estadístico</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Boston)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>      crim                zn             indus            chas        
 Min.   : 0.00632   Min.   :  0.00   Min.   : 0.46   Min.   :0.00000  
 1st Qu.: 0.08205   1st Qu.:  0.00   1st Qu.: 5.19   1st Qu.:0.00000  
 Median : 0.25651   Median :  0.00   Median : 9.69   Median :0.00000  
 Mean   : 3.61352   Mean   : 11.36   Mean   :11.14   Mean   :0.06917  
 3rd Qu.: 3.67708   3rd Qu.: 12.50   3rd Qu.:18.10   3rd Qu.:0.00000  
 Max.   :88.97620   Max.   :100.00   Max.   :27.74   Max.   :1.00000  
      nox               rm             age              dis        
 Min.   :0.3850   Min.   :3.561   Min.   :  2.90   Min.   : 1.130  
 1st Qu.:0.4490   1st Qu.:5.886   1st Qu.: 45.02   1st Qu.: 2.100  
 Median :0.5380   Median :6.208   Median : 77.50   Median : 3.207  
 Mean   :0.5547   Mean   :6.285   Mean   : 68.57   Mean   : 3.795  
 3rd Qu.:0.6240   3rd Qu.:6.623   3rd Qu.: 94.08   3rd Qu.: 5.188  
 Max.   :0.8710   Max.   :8.780   Max.   :100.00   Max.   :12.127  
      rad              tax           ptratio          black       
 Min.   : 1.000   Min.   :187.0   Min.   :12.60   Min.   :  0.32  
 1st Qu.: 4.000   1st Qu.:279.0   1st Qu.:17.40   1st Qu.:375.38  
 Median : 5.000   Median :330.0   Median :19.05   Median :391.44  
 Mean   : 9.549   Mean   :408.2   Mean   :18.46   Mean   :356.67  
 3rd Qu.:24.000   3rd Qu.:666.0   3rd Qu.:20.20   3rd Qu.:396.23  
 Max.   :24.000   Max.   :711.0   Max.   :22.00   Max.   :396.90  
     lstat            medv      
 Min.   : 1.73   Min.   : 5.00  
 1st Qu.: 6.95   1st Qu.:17.02  
 Median :11.36   Median :21.20  
 Mean   :12.65   Mean   :22.53  
 3rd Qu.:16.95   3rd Qu.:25.00  
 Max.   :37.97   Max.   :50.00  </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Verificar valores faltantes</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== VALORES FALTANTES ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== VALORES FALTANTES ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colSums</span>(<span class="fu">is.na</span>(Boston))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   crim      zn   indus    chas     nox      rm     age     dis     rad     tax 
      0       0       0       0       0       0       0       0       0       0 
ptratio   black   lstat    medv 
      0       0       0       0 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Descripción de variables</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== DESCRIPCIÓN DE VARIABLES ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== DESCRIPCIÓN DE VARIABLES ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"medv: Valor mediano de viviendas (variable respuesta)</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>medv: Valor mediano de viviendas (variable respuesta)</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"crim: Tasa de criminalidad per cápita</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>crim: Tasa de criminalidad per cápita</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"zn: Proporción de lotes residenciales &gt; 25,000 sq.ft</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>zn: Proporción de lotes residenciales &gt; 25,000 sq.ft</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"indus: Proporción de acres comerciales no retail</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>indus: Proporción de acres comerciales no retail</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"chas: Variable dummy para río Charles (1 si limita, 0 si no)</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>chas: Variable dummy para río Charles (1 si limita, 0 si no)</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"nox: Concentración de óxidos nítricos</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>nox: Concentración de óxidos nítricos</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"rm: Número promedio de habitaciones</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>rm: Número promedio de habitaciones</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"age: Proporción de unidades ocupadas construidas antes de 1940</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>age: Proporción de unidades ocupadas construidas antes de 1940</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"dis: Distancias ponderadas a centros de empleo</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>dis: Distancias ponderadas a centros de empleo</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"rad: Índice de accesibilidad a autopistas radiales</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>rad: Índice de accesibilidad a autopistas radiales</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"tax: Tasa de impuesto a la propiedad</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>tax: Tasa de impuesto a la propiedad</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"ptratio: Proporción alumno-profesor</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>ptratio: Proporción alumno-profesor</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"black: Proporción de población afroamericana</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>black: Proporción de población afroamericana</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"lstat: Porcentaje de población de bajo estatus</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>lstat: Porcentaje de población de bajo estatus</code></pre>
</div>
</div>
</section>
<section id="visualización-de-relaciones" class="level3">
<h3 class="anchored" data-anchor-id="visualización-de-relaciones">Visualización de Relaciones</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Matriz de correlaciones</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>cor_matrix <span class="ot">&lt;-</span> <span class="fu">cor</span>(Boston)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualizar matriz de correlaciones</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(cor_matrix, <span class="at">method =</span> <span class="st">"color"</span>, <span class="at">type =</span> <span class="st">"upper"</span>, </span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">order =</span> <span class="st">"hclust"</span>, <span class="at">tl.cex =</span> <span class="fl">0.8</span>, <span class="at">tl.col =</span> <span class="st">"black"</span>,</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">addCoef.col =</span> <span class="st">"black"</span>, <span class="at">number.cex =</span> <span class="fl">0.6</span>)</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">"Matriz de Correlaciones - Boston Housing"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lab4_seleccion_variables_files/figure-html/exploratory_visualization-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Histograma de la variable respuesta</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Boston, <span class="fu">aes</span>(<span class="at">x =</span> medv)) <span class="sc">+</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">30</span>, <span class="at">fill =</span> <span class="st">"lightblue"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribución del Precio de Viviendas"</span>,</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Valor Mediano (miles de $)"</span>, <span class="at">y =</span> <span class="st">"Frecuencia"</span>) <span class="sc">+</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lab4_seleccion_variables_files/figure-html/exploratory_visualization-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Boxplot para identificar outliers</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Boston, <span class="fu">aes</span>(<span class="at">y =</span> medv)) <span class="sc">+</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">fill =</span> <span class="st">"lightgreen"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Boxplot del Precio de Viviendas"</span>,</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Valor Mediano (miles de $)"</span>) <span class="sc">+</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lab4_seleccion_variables_files/figure-html/exploratory_visualization-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="parte-2-filtrado-basado-en-información-básica" class="level2">
<h2 class="anchored" data-anchor-id="parte-2-filtrado-basado-en-información-básica">Parte 2: Filtrado Basado en Información Básica</h2>
<section id="análisis-de-variabilidad" class="level3">
<h3 class="anchored" data-anchor-id="análisis-de-variabilidad">Análisis de Variabilidad</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcular varianzas de todas las variables predictoras</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>varianzas <span class="ot">&lt;-</span> Boston <span class="sc">%&gt;%</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>medv) <span class="sc">%&gt;%</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise_all</span>(var) <span class="sc">%&gt;%</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(variable, varianza) <span class="sc">%&gt;%</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(varianza)</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(varianzas)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   variable     varianza
1       nox 1.342764e-02
2      chas 6.451297e-02
3        rm 4.936709e-01
4       dis 4.434015e+00
5   ptratio 4.686989e+00
6     indus 4.706444e+01
7     lstat 5.099476e+01
8      crim 7.398658e+01
9       rad 7.581637e+01
10       zn 5.439368e+02
11      age 7.923584e+02
12    black 8.334752e+03
13      tax 2.840476e+04</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Identificar variables con baja variabilidad (umbral arbitrario)</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>umbral_varianza <span class="ot">&lt;-</span> <span class="fl">0.01</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>vars_baja_varianza <span class="ot">&lt;-</span> varianzas<span class="sc">$</span>variable[varianzas<span class="sc">$</span>varianza <span class="sc">&lt;</span> umbral_varianza]</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== VARIABLES CON BAJA VARIABILIDAD ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== VARIABLES CON BAJA VARIABILIDAD ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">length</span>(vars_baja_varianza) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Variables con varianza &lt;"</span>, umbral_varianza, <span class="st">":"</span>, <span class="fu">paste</span>(vars_baja_varianza, <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"No hay variables con varianza excesivamente baja</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>No hay variables con varianza excesivamente baja</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualizar varianzas</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(varianzas, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(variable, varianza), <span class="at">y =</span> varianza)) <span class="sc">+</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"steelblue"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Varianza de Variables Predictoras"</span>,</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Variable"</span>, <span class="at">y =</span> <span class="st">"Varianza"</span>) <span class="sc">+</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lab4_seleccion_variables_files/figure-html/variability_analysis-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="análisis-de-correlación-con-variable-respuesta" class="level3">
<h3 class="anchored" data-anchor-id="análisis-de-correlación-con-variable-respuesta">Análisis de Correlación con Variable Respuesta</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcular correlaciones con la variable respuesta</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>correlaciones_y <span class="ot">&lt;-</span> <span class="fu">cor</span>(Boston[, <span class="sc">-</span><span class="fu">which</span>(<span class="fu">names</span>(Boston) <span class="sc">==</span> <span class="st">"medv"</span>)], Boston<span class="sc">$</span>medv) <span class="sc">%&gt;%</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"variable"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">correlacion =</span> V1) <span class="sc">%&gt;%</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">correlacion_abs =</span> <span class="fu">abs</span>(correlacion)) <span class="sc">%&gt;%</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(correlacion_abs))</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(correlaciones_y)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   variable correlacion correlacion_abs
1     lstat  -0.7376627       0.7376627
2        rm   0.6953599       0.6953599
3   ptratio  -0.5077867       0.5077867
4     indus  -0.4837252       0.4837252
5       tax  -0.4685359       0.4685359
6       nox  -0.4273208       0.4273208
7      crim  -0.3883046       0.3883046
8       rad  -0.3816262       0.3816262
9       age  -0.3769546       0.3769546
10       zn   0.3604453       0.3604453
11    black   0.3334608       0.3334608
12      dis   0.2499287       0.2499287
13     chas   0.1752602       0.1752602</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualizar correlaciones</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(correlaciones_y, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(variable, correlacion), <span class="at">y =</span> correlacion)) <span class="sc">+</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">fill =</span> correlacion <span class="sc">&gt;</span> <span class="dv">0</span>), <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>), </span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Negativa"</span>, <span class="st">"Positiva"</span>),</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">name =</span> <span class="st">"Correlación"</span>) <span class="sc">+</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Correlación de Variables Predictoras con Precio"</span>,</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Variable"</span>, <span class="at">y =</span> <span class="st">"Correlación con medv"</span>) <span class="sc">+</span></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lab4_seleccion_variables_files/figure-html/correlation_analysis-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Identificar variables con correlación muy baja</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>umbral_correlacion <span class="ot">&lt;-</span> <span class="fl">0.1</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>vars_baja_corr <span class="ot">&lt;-</span> correlaciones_y<span class="sc">$</span>variable[correlaciones_y<span class="sc">$</span>correlacion_abs <span class="sc">&lt;</span> umbral_correlacion]</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== VARIABLES CON BAJA CORRELACIÓN ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== VARIABLES CON BAJA CORRELACIÓN ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">length</span>(vars_baja_corr) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Variables con |correlación| &lt;"</span>, umbral_correlacion, <span class="st">":"</span>, <span class="fu">paste</span>(vars_baja_corr, <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Todas las variables tienen correlación &gt; 0.1 con la respuesta</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Todas las variables tienen correlación &gt; 0.1 con la respuesta</code></pre>
</div>
</div>
</section>
<section id="análisis-de-multicolinealidad" class="level3">
<h3 class="anchored" data-anchor-id="análisis-de-multicolinealidad">Análisis de Multicolinealidad</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ajustar modelo completo para calcular VIF</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>modelo_completo <span class="ot">&lt;-</span> <span class="fu">lm</span>(medv <span class="sc">~</span> ., <span class="at">data =</span> Boston)</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcular VIF</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>vif_valores <span class="ot">&lt;-</span> <span class="fu">vif</span>(modelo_completo)</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>vif_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">variable =</span> <span class="fu">names</span>(vif_valores),</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">VIF =</span> vif_valores</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(VIF))</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(vif_df)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>        variable      VIF
tax          tax 9.008554
rad          rad 7.484496
nox          nox 4.393720
indus      indus 3.991596
dis          dis 3.955945
age          age 3.100826
lstat      lstat 2.941491
zn            zn 2.298758
rm            rm 1.933744
ptratio  ptratio 1.799084
crim        crim 1.792192
black      black 1.348521
chas        chas 1.073995</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualizar VIF</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(vif_df, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(variable, VIF), <span class="at">y =</span> VIF)) <span class="sc">+</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"orange"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">10</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">5</span>, <span class="at">color =</span> <span class="st">"orange"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Factor de Inflación de la Varianza (VIF)"</span>,</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Línea roja: VIF = 10 (problemático), Línea naranja: VIF = 5 (moderado)"</span>,</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Variable"</span>, <span class="at">y =</span> <span class="st">"VIF"</span>) <span class="sc">+</span></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lab4_seleccion_variables_files/figure-html/multicollinearity_analysis-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Identificar variables con VIF alto</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>vars_alto_vif <span class="ot">&lt;-</span> vif_df<span class="sc">$</span>variable[vif_df<span class="sc">$</span>VIF <span class="sc">&gt;</span> <span class="dv">5</span>]</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== VARIABLES CON VIF ALTO ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== VARIABLES CON VIF ALTO ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">length</span>(vars_alto_vif) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Variables con VIF &gt; 5:"</span>, <span class="fu">paste</span>(vars_alto_vif, <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Considera eliminar algunas de estas variables para reducir multicolinealidad</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"No hay problemas severos de multicolinealidad</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Variables con VIF &gt; 5: tax, rad 
Considera eliminar algunas de estas variables para reducir multicolinealidad</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Matriz de correlación entre predictores altamente correlacionados</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">length</span>(vars_alto_vif) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  high_vif_cors <span class="ot">&lt;-</span> <span class="fu">cor</span>(Boston[, vars_alto_vif])</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">corrplot</span>(high_vif_cors, <span class="at">method =</span> <span class="st">"color"</span>, <span class="at">addCoef.col =</span> <span class="st">"black"</span>,</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">title =</span> <span class="st">"Correlaciones entre Variables con VIF Alto"</span>, <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>))</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lab4_seleccion_variables_files/figure-html/multicollinearity_analysis-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="resumen-del-filtrado-inicial" class="level3">
<h3 class="anchored" data-anchor-id="resumen-del-filtrado-inicial">Resumen del Filtrado Inicial</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Resumen de filtrado</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== RESUMEN DEL FILTRADO INICIAL ===</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== RESUMEN DEL FILTRADO INICIAL ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Variables originales:"</span>, <span class="fu">ncol</span>(Boston) <span class="sc">-</span> <span class="dv">1</span>, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Variables originales: 13 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Variables con baja variabilidad:"</span>, <span class="fu">length</span>(vars_baja_varianza), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Variables con baja variabilidad: 0 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Variables con baja correlación:"</span>, <span class="fu">length</span>(vars_baja_corr), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Variables con baja correlación: 0 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Variables con VIF alto:"</span>, <span class="fu">length</span>(vars_alto_vif), <span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Variables con VIF alto: 2 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Variables a considerar eliminar</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>vars_eliminar_candidatas <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">c</span>(vars_baja_varianza, vars_baja_corr))</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">length</span>(vars_eliminar_candidatas) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Variables candidatas a eliminar:"</span>, <span class="fu">paste</span>(vars_eliminar_candidatas, <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"No se identificaron variables claras para eliminar en filtrado básico</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>No se identificaron variables claras para eliminar en filtrado básico</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Para continuar, mantendremos todas las variables y dejaremos que los métodos </span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="co"># de selección decidan cuáles son importantes</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>variables_finales <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(Boston), <span class="st">"medv"</span>)</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Variables para análisis posterior:"</span>, <span class="fu">length</span>(variables_finales), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Variables para análisis posterior: 13 </code></pre>
</div>
</div>
</section>
</section>
<section id="parte-3-criterios-de-bondad-de-ajuste" class="level2">
<h2 class="anchored" data-anchor-id="parte-3-criterios-de-bondad-de-ajuste">Parte 3: Criterios de Bondad de Ajuste</h2>
<section id="modelos-candidatos-con-diferentes-números-de-variables" class="level3">
<h3 class="anchored" data-anchor-id="modelos-candidatos-con-diferentes-números-de-variables">Modelos Candidatos con Diferentes Números de Variables</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear algunos modelos candidatos de diferentes complejidades</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>modelo_simple <span class="ot">&lt;-</span> <span class="fu">lm</span>(medv <span class="sc">~</span> lstat, <span class="at">data =</span> Boston)</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>modelo_dos_vars <span class="ot">&lt;-</span> <span class="fu">lm</span>(medv <span class="sc">~</span> lstat <span class="sc">+</span> rm, <span class="at">data =</span> Boston)</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>modelo_tres_vars <span class="ot">&lt;-</span> <span class="fu">lm</span>(medv <span class="sc">~</span> lstat <span class="sc">+</span> rm <span class="sc">+</span> ptratio, <span class="at">data =</span> Boston)</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>modelo_intermedio <span class="ot">&lt;-</span> <span class="fu">lm</span>(medv <span class="sc">~</span> lstat <span class="sc">+</span> rm <span class="sc">+</span> ptratio <span class="sc">+</span> nox <span class="sc">+</span> crim, <span class="at">data =</span> Boston)</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>modelo_complejo <span class="ot">&lt;-</span> <span class="fu">lm</span>(medv <span class="sc">~</span> lstat <span class="sc">+</span> rm <span class="sc">+</span> ptratio <span class="sc">+</span> nox <span class="sc">+</span> crim <span class="sc">+</span> dis <span class="sc">+</span> age, <span class="at">data =</span> Boston)</span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>modelo_completo <span class="ot">&lt;-</span> <span class="fu">lm</span>(medv <span class="sc">~</span> ., <span class="at">data =</span> Boston)</span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Lista de modelos para comparación</span></span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>modelos_candidatos <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Simple (1 var)"</span> <span class="ot">=</span> modelo_simple,</span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Dos variables"</span> <span class="ot">=</span> modelo_dos_vars,</span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Tres variables"</span> <span class="ot">=</span> modelo_tres_vars,</span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Intermedio (5 vars)"</span> <span class="ot">=</span> modelo_intermedio,</span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Complejo (7 vars)"</span> <span class="ot">=</span> modelo_complejo,</span>
<span id="cb83-16"><a href="#cb83-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Completo (13 vars)"</span> <span class="ot">=</span> modelo_completo</span>
<span id="cb83-17"><a href="#cb83-17" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="comparación-usando-aic-bic-y-cp-de-mallows" class="level3">
<h3 class="anchored" data-anchor-id="comparación-usando-aic-bic-y-cp-de-mallows">Comparación usando AIC, BIC y Cp de Mallows</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Función para extraer métricas de los modelos</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>extraer_metricas <span class="ot">&lt;-</span> <span class="cf">function</span>(modelo) {</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>  summ <span class="ot">&lt;-</span> <span class="fu">summary</span>(modelo)</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">nobs</span>(modelo)</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">coef</span>(modelo)) <span class="sc">-</span> <span class="dv">1</span>  <span class="co"># Excluir intercepto</span></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calcular Cp de Mallows usando el modelo completo como referencia</span></span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>  mse_full <span class="ot">&lt;-</span> <span class="fu">summary</span>(modelo_completo)<span class="sc">$</span>sigma<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>  sse_model <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">residuals</span>(modelo)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>  cp <span class="ot">&lt;-</span> sse_model <span class="sc">/</span> mse_full <span class="sc">-</span> n <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> (p <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">data.frame</span>(</span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_variables =</span> p,</span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">R2 =</span> summ<span class="sc">$</span>r.squared,</span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">R2_adj =</span> summ<span class="sc">$</span>adj.r.squared,</span>
<span id="cb84-16"><a href="#cb84-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">AIC =</span> <span class="fu">AIC</span>(modelo),</span>
<span id="cb84-17"><a href="#cb84-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">BIC =</span> <span class="fu">BIC</span>(modelo),</span>
<span id="cb84-18"><a href="#cb84-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">Cp =</span> cp,</span>
<span id="cb84-19"><a href="#cb84-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">RMSE =</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(<span class="fu">residuals</span>(modelo)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb84-20"><a href="#cb84-20" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb84-21"><a href="#cb84-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb84-22"><a href="#cb84-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-23"><a href="#cb84-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraer métricas para todos los modelos</span></span>
<span id="cb84-24"><a href="#cb84-24" aria-hidden="true" tabindex="-1"></a>comparacion_modelos <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(modelos_candidatos, extraer_metricas, <span class="at">.id =</span> <span class="st">"Modelo"</span>)</span>
<span id="cb84-25"><a href="#cb84-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-26"><a href="#cb84-26" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(comparacion_modelos)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>               Modelo n_variables        R2    R2_adj      AIC      BIC
1      Simple (1 var)           1 0.5441463 0.5432418 3288.975 3301.655
2       Dos variables           2 0.6385616 0.6371245 3173.542 3190.448
3      Tres variables           3 0.6786242 0.6767036 3116.097 3137.230
4 Intermedio (5 vars)           5 0.6816623 0.6784790 3115.291 3144.877
5   Complejo (7 vars)           7 0.7114477 0.7073917 3069.583 3107.622
6  Completo (13 vars)          13 0.7406427 0.7337897 3027.609 3091.007
         Cp     RMSE
1 362.75295 6.203464
2 185.64743 5.523809
3 111.64889 5.208686
4 109.88547 5.184007
5  57.38275 4.935530
6  14.00000 4.679191</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Identificar mejores modelos según cada criterio</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>mejor_aic <span class="ot">&lt;-</span> comparacion_modelos<span class="sc">$</span>Modelo[<span class="fu">which.min</span>(comparacion_modelos<span class="sc">$</span>AIC)]</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>mejor_bic <span class="ot">&lt;-</span> comparacion_modelos<span class="sc">$</span>Modelo[<span class="fu">which.min</span>(comparacion_modelos<span class="sc">$</span>BIC)]</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>mejor_cp <span class="ot">&lt;-</span> comparacion_modelos<span class="sc">$</span>Modelo[<span class="fu">which.min</span>(comparacion_modelos<span class="sc">$</span>Cp)]</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>mejor_r2_adj <span class="ot">&lt;-</span> comparacion_modelos<span class="sc">$</span>Modelo[<span class="fu">which.max</span>(comparacion_modelos<span class="sc">$</span>R2_adj)]</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== MEJORES MODELOS SEGÚN CADA CRITERIO ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== MEJORES MODELOS SEGÚN CADA CRITERIO ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Mejor AIC:"</span>, mejor_aic, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mejor AIC: Completo (13 vars) </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Mejor BIC:"</span>, mejor_bic, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mejor BIC: Completo (13 vars) </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Mejor Cp:"</span>, mejor_cp, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mejor Cp: Completo (13 vars) </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Mejor R² ajustado:"</span>, mejor_r2_adj, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mejor R² ajustado: Completo (13 vars) </code></pre>
</div>
</div>
</section>
<section id="visualización-de-criterios" class="level3">
<h3 class="anchored" data-anchor-id="visualización-de-criterios">Visualización de Criterios</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráfico de AIC vs número de variables</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(comparacion_modelos, <span class="fu">aes</span>(<span class="at">x =</span> n_variables, <span class="at">y =</span> AIC)) <span class="sc">+</span></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> comparacion_modelos[comparacion_modelos<span class="sc">$</span>Modelo <span class="sc">==</span> mejor_aic, ],</span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"AIC vs Número de Variables"</span>,</span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Número de Variables"</span>, <span class="at">y =</span> <span class="st">"AIC"</span>) <span class="sc">+</span></span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráfico de BIC vs número de variables</span></span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(comparacion_modelos, <span class="fu">aes</span>(<span class="at">x =</span> n_variables, <span class="at">y =</span> BIC)) <span class="sc">+</span></span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"green"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb96-14"><a href="#cb96-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"green"</span>) <span class="sc">+</span></span>
<span id="cb96-15"><a href="#cb96-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> comparacion_modelos[comparacion_modelos<span class="sc">$</span>Modelo <span class="sc">==</span> mejor_bic, ],</span>
<span id="cb96-16"><a href="#cb96-16" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb96-17"><a href="#cb96-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"BIC vs Número de Variables"</span>,</span>
<span id="cb96-18"><a href="#cb96-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Número de Variables"</span>, <span class="at">y =</span> <span class="st">"BIC"</span>) <span class="sc">+</span></span>
<span id="cb96-19"><a href="#cb96-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb96-20"><a href="#cb96-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-21"><a href="#cb96-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráfico de Cp vs número de variables</span></span>
<span id="cb96-22"><a href="#cb96-22" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(comparacion_modelos, <span class="fu">aes</span>(<span class="at">x =</span> n_variables, <span class="at">y =</span> Cp)) <span class="sc">+</span></span>
<span id="cb96-23"><a href="#cb96-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"purple"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb96-24"><a href="#cb96-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"purple"</span>) <span class="sc">+</span></span>
<span id="cb96-25"><a href="#cb96-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">1</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb96-26"><a href="#cb96-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> comparacion_modelos[comparacion_modelos<span class="sc">$</span>Modelo <span class="sc">==</span> mejor_cp, ],</span>
<span id="cb96-27"><a href="#cb96-27" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb96-28"><a href="#cb96-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Cp de Mallows vs Número de Variables"</span>,</span>
<span id="cb96-29"><a href="#cb96-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Línea roja: Cp = p + 1 (referencia ideal)"</span>,</span>
<span id="cb96-30"><a href="#cb96-30" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Número de Variables"</span>, <span class="at">y =</span> <span class="st">"Cp"</span>) <span class="sc">+</span></span>
<span id="cb96-31"><a href="#cb96-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb96-32"><a href="#cb96-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-33"><a href="#cb96-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráfico de R² ajustado vs número de variables</span></span>
<span id="cb96-34"><a href="#cb96-34" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(comparacion_modelos, <span class="fu">aes</span>(<span class="at">x =</span> n_variables, <span class="at">y =</span> R2_adj)) <span class="sc">+</span></span>
<span id="cb96-35"><a href="#cb96-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"orange"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb96-36"><a href="#cb96-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"orange"</span>) <span class="sc">+</span></span>
<span id="cb96-37"><a href="#cb96-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> comparacion_modelos[comparacion_modelos<span class="sc">$</span>Modelo <span class="sc">==</span> mejor_r2_adj, ],</span>
<span id="cb96-38"><a href="#cb96-38" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb96-39"><a href="#cb96-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"R² Ajustado vs Número de Variables"</span>,</span>
<span id="cb96-40"><a href="#cb96-40" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Número de Variables"</span>, <span class="at">y =</span> <span class="st">"R² Ajustado"</span>) <span class="sc">+</span></span>
<span id="cb96-41"><a href="#cb96-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb96-42"><a href="#cb96-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-43"><a href="#cb96-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Mostrar todos los gráficos</span></span>
<span id="cb96-44"><a href="#cb96-44" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p1, p2, p3, p4, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lab4_seleccion_variables_files/figure-html/criteria_visualization-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="parte-4-métodos-de-selección-exhaustiva" class="level2">
<h2 class="anchored" data-anchor-id="parte-4-métodos-de-selección-exhaustiva">Parte 4: Métodos de Selección Exhaustiva</h2>
<section id="best-subset-selection" class="level3">
<h3 class="anchored" data-anchor-id="best-subset-selection">Best Subset Selection</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Realizar best subset selection</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>best_subset <span class="ot">&lt;-</span> <span class="fu">regsubsets</span>(medv <span class="sc">~</span> ., <span class="at">data =</span> Boston, <span class="at">nvmax =</span> <span class="dv">13</span>)</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>subset_summary <span class="ot">&lt;-</span> <span class="fu">summary</span>(best_subset)</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear dataframe con resultados</span></span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>subset_results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_vars =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">13</span>,</span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">RSS =</span> subset_summary<span class="sc">$</span>rss,</span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">R2 =</span> subset_summary<span class="sc">$</span>rsq,</span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">R2_adj =</span> subset_summary<span class="sc">$</span>adjr2,</span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">Cp =</span> subset_summary<span class="sc">$</span>cp,</span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">BIC =</span> subset_summary<span class="sc">$</span>bic</span>
<span id="cb97-13"><a href="#cb97-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb97-14"><a href="#cb97-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-15"><a href="#cb97-15" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(subset_results)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   n_vars      RSS        R2    R2_adj        Cp       BIC
1       1 19472.38 0.5441463 0.5432418 362.75295 -385.0521
2       2 15439.31 0.6385616 0.6371245 185.64743 -496.2582
3       3 13727.99 0.6786242 0.6767036 111.64889 -549.4767
4       4 13228.91 0.6903077 0.6878351  91.48526 -561.9884
5       5 12469.34 0.7080893 0.7051702  59.75364 -585.6823
6       6 12141.07 0.7157742 0.7123567  47.17537 -592.9553
7       7 11868.24 0.7221614 0.7182560  37.05889 -598.2295
8       8 11678.30 0.7266079 0.7222072  30.62398 -600.1663
9       9 11526.12 0.7301704 0.7252743  25.86592 -600.5767
10     10 11308.58 0.7352631 0.7299149  18.20493 -603.9917
11     11 11081.36 0.7405823 0.7348058  10.11455 -608.0353
12     12 11078.85 0.7406412 0.7343282  12.00275 -601.9237
13     13 11078.78 0.7406427 0.7337897  14.00000 -595.7000</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Identificar mejores modelos</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>mejor_r2_adj_idx <span class="ot">&lt;-</span> <span class="fu">which.max</span>(subset_results<span class="sc">$</span>R2_adj)</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>mejor_cp_idx <span class="ot">&lt;-</span> <span class="fu">which.min</span>(subset_results<span class="sc">$</span>Cp)</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>mejor_bic_idx <span class="ot">&lt;-</span> <span class="fu">which.min</span>(subset_results<span class="sc">$</span>BIC)</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== MEJORES MODELOS - BEST SUBSET SELECTION ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== MEJORES MODELOS - BEST SUBSET SELECTION ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Mejor R² ajustado:"</span>, mejor_r2_adj_idx, <span class="st">"variables</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mejor R² ajustado: 11 variables</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Mejor Cp:"</span>, mejor_cp_idx, <span class="st">"variables</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mejor Cp: 11 variables</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Mejor BIC:"</span>, mejor_bic_idx, <span class="st">"variables</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mejor BIC: 11 variables</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Variables en cada modelo óptimo</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== VARIABLES EN MODELOS ÓPTIMOS ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== VARIABLES EN MODELOS ÓPTIMOS ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Modelo con mejor R² ajustado ("</span>, mejor_r2_adj_idx, <span class="st">"vars):</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Modelo con mejor R² ajustado ( 11 vars):</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>vars_mejor_r2 <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">which</span>(subset_summary<span class="sc">$</span>which[mejor_r2_adj_idx, <span class="sc">-</span><span class="dv">1</span>]))</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">paste</span>(vars_mejor_r2, <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>crim, zn, chas, nox, rm, dis, rad, tax, ptratio, black, lstat </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Modelo con mejor Cp ("</span>, mejor_cp_idx, <span class="st">"vars):</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Modelo con mejor Cp ( 11 vars):</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>vars_mejor_cp <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">which</span>(subset_summary<span class="sc">$</span>which[mejor_cp_idx, <span class="sc">-</span><span class="dv">1</span>]))</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">paste</span>(vars_mejor_cp, <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>crim, zn, chas, nox, rm, dis, rad, tax, ptratio, black, lstat </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Modelo con mejor BIC ("</span>, mejor_bic_idx, <span class="st">"vars):</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Modelo con mejor BIC ( 11 vars):</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>vars_mejor_bic <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">which</span>(subset_summary<span class="sc">$</span>which[mejor_bic_idx, <span class="sc">-</span><span class="dv">1</span>]))</span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">paste</span>(vars_mejor_bic, <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>crim, zn, chas, nox, rm, dis, rad, tax, ptratio, black, lstat </code></pre>
</div>
</div>
</section>
<section id="visualización-del-best-subset-selection" class="level3">
<h3 class="anchored" data-anchor-id="visualización-del-best-subset-selection">Visualización del Best Subset Selection</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráfico de R² ajustado</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(subset_results, <span class="fu">aes</span>(<span class="at">x =</span> n_vars, <span class="at">y =</span> R2_adj)) <span class="sc">+</span></span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> mejor_r2_adj_idx, <span class="at">y =</span> R2_adj[mejor_r2_adj_idx]), </span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"R² Ajustado - Best Subset"</span>,</span>
<span id="cb121-8"><a href="#cb121-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Número de Variables"</span>, <span class="at">y =</span> <span class="st">"R² Ajustado"</span>) <span class="sc">+</span></span>
<span id="cb121-9"><a href="#cb121-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb121-10"><a href="#cb121-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-11"><a href="#cb121-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráfico de Cp</span></span>
<span id="cb121-12"><a href="#cb121-12" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(subset_results, <span class="fu">aes</span>(<span class="at">x =</span> n_vars, <span class="at">y =</span> Cp)) <span class="sc">+</span></span>
<span id="cb121-13"><a href="#cb121-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"purple"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb121-14"><a href="#cb121-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"purple"</span>) <span class="sc">+</span></span>
<span id="cb121-15"><a href="#cb121-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">1</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb121-16"><a href="#cb121-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> mejor_cp_idx, <span class="at">y =</span> Cp[mejor_cp_idx]), </span>
<span id="cb121-17"><a href="#cb121-17" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb121-18"><a href="#cb121-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Cp de Mallows - Best Subset"</span>,</span>
<span id="cb121-19"><a href="#cb121-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Número de Variables"</span>, <span class="at">y =</span> <span class="st">"Cp"</span>) <span class="sc">+</span></span>
<span id="cb121-20"><a href="#cb121-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb121-21"><a href="#cb121-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-22"><a href="#cb121-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráfico de BIC</span></span>
<span id="cb121-23"><a href="#cb121-23" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(subset_results, <span class="fu">aes</span>(<span class="at">x =</span> n_vars, <span class="at">y =</span> BIC)) <span class="sc">+</span></span>
<span id="cb121-24"><a href="#cb121-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"green"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb121-25"><a href="#cb121-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"green"</span>) <span class="sc">+</span></span>
<span id="cb121-26"><a href="#cb121-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> mejor_bic_idx, <span class="at">y =</span> BIC[mejor_bic_idx]), </span>
<span id="cb121-27"><a href="#cb121-27" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb121-28"><a href="#cb121-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"BIC - Best Subset"</span>,</span>
<span id="cb121-29"><a href="#cb121-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Número de Variables"</span>, <span class="at">y =</span> <span class="st">"BIC"</span>) <span class="sc">+</span></span>
<span id="cb121-30"><a href="#cb121-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb121-31"><a href="#cb121-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-32"><a href="#cb121-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Mostrar gráficos</span></span>
<span id="cb121-33"><a href="#cb121-33" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p1, p2, p3, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lab4_seleccion_variables_files/figure-html/best_subset_visualization-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mostrar matriz de selección de variables</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(best_subset, <span class="at">scale =</span> <span class="st">"adjr2"</span>, <span class="at">main =</span> <span class="st">"Variables Seleccionadas por Tamaño de Modelo"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lab4_seleccion_variables_files/figure-html/best_subset_visualization-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="parte-5-métodos-automáticos-paso-a-paso" class="level2">
<h2 class="anchored" data-anchor-id="parte-5-métodos-automáticos-paso-a-paso">Parte 5: Métodos Automáticos Paso a Paso</h2>
<section id="forward-selection" class="level3">
<h3 class="anchored" data-anchor-id="forward-selection">Forward Selection</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Modelo inicial (solo intercepto)</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>modelo_inicial <span class="ot">&lt;-</span> <span class="fu">lm</span>(medv <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> Boston)</span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Modelo completo (todas las variables)</span></span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a>modelo_completo_step <span class="ot">&lt;-</span> <span class="fu">lm</span>(medv <span class="sc">~</span> ., <span class="at">data =</span> Boston)</span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Forward selection usando AIC</span></span>
<span id="cb123-8"><a href="#cb123-8" aria-hidden="true" tabindex="-1"></a>forward_aic <span class="ot">&lt;-</span> <span class="fu">step</span>(modelo_inicial, </span>
<span id="cb123-9"><a href="#cb123-9" aria-hidden="true" tabindex="-1"></a>                    <span class="at">scope =</span> <span class="fu">list</span>(<span class="at">lower =</span> modelo_inicial, <span class="at">upper =</span> modelo_completo_step),</span>
<span id="cb123-10"><a href="#cb123-10" aria-hidden="true" tabindex="-1"></a>                    <span class="at">direction =</span> <span class="st">"forward"</span>, </span>
<span id="cb123-11"><a href="#cb123-11" aria-hidden="true" tabindex="-1"></a>                    <span class="at">trace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb123-12"><a href="#cb123-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-13"><a href="#cb123-13" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== FORWARD SELECTION (AIC) ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== FORWARD SELECTION (AIC) ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Variables seleccionadas:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Variables seleccionadas:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>forward_vars <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">coef</span>(forward_aic))[<span class="sc">-</span><span class="dv">1</span>]  <span class="co"># Excluir intercepto</span></span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">paste</span>(forward_vars, <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>lstat, rm, ptratio, dis, nox, chas, black, zn, crim, rad, tax </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"AIC final:"</span>, <span class="fu">AIC</span>(forward_aic), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>AIC final: 3023.726 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Número de variables:"</span>, <span class="fu">length</span>(forward_vars), <span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Número de variables: 11 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Resumen del modelo final</span></span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(forward_aic)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = medv ~ lstat + rm + ptratio + dis + nox + chas + 
    black + zn + crim + rad + tax, data = Boston)

Residuals:
     Min       1Q   Median       3Q      Max 
-15.5984  -2.7386  -0.5046   1.7273  26.2373 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  36.341145   5.067492   7.171 2.73e-12 ***
lstat        -0.522553   0.047424 -11.019  &lt; 2e-16 ***
rm            3.801579   0.406316   9.356  &lt; 2e-16 ***
ptratio      -0.946525   0.129066  -7.334 9.24e-13 ***
dis          -1.492711   0.185731  -8.037 6.84e-15 ***
nox         -17.376023   3.535243  -4.915 1.21e-06 ***
chas          2.718716   0.854240   3.183 0.001551 ** 
black         0.009291   0.002674   3.475 0.000557 ***
zn            0.045845   0.013523   3.390 0.000754 ***
crim         -0.108413   0.032779  -3.307 0.001010 ** 
rad           0.299608   0.063402   4.726 3.00e-06 ***
tax          -0.011778   0.003372  -3.493 0.000521 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 4.736 on 494 degrees of freedom
Multiple R-squared:  0.7406,    Adjusted R-squared:  0.7348 
F-statistic: 128.2 on 11 and 494 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
</section>
<section id="backward-elimination" class="level3">
<h3 class="anchored" data-anchor-id="backward-elimination">Backward Elimination</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Backward elimination usando AIC</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>backward_aic <span class="ot">&lt;-</span> <span class="fu">step</span>(modelo_completo_step, </span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">direction =</span> <span class="st">"backward"</span>, </span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">trace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== BACKWARD ELIMINATION (AIC) ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== BACKWARD ELIMINATION (AIC) ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Variables seleccionadas:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Variables seleccionadas:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>backward_vars <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">coef</span>(backward_aic))[<span class="sc">-</span><span class="dv">1</span>]  <span class="co"># Excluir intercepto</span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">paste</span>(backward_vars, <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>crim, zn, chas, nox, rm, dis, rad, tax, ptratio, black, lstat </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"AIC final:"</span>, <span class="fu">AIC</span>(backward_aic), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>AIC final: 3023.726 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Número de variables:"</span>, <span class="fu">length</span>(backward_vars), <span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Número de variables: 11 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Resumen del modelo final</span></span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(backward_aic)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = medv ~ crim + zn + chas + nox + rm + dis + rad + 
    tax + ptratio + black + lstat, data = Boston)

Residuals:
     Min       1Q   Median       3Q      Max 
-15.5984  -2.7386  -0.5046   1.7273  26.2373 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  36.341145   5.067492   7.171 2.73e-12 ***
crim         -0.108413   0.032779  -3.307 0.001010 ** 
zn            0.045845   0.013523   3.390 0.000754 ***
chas          2.718716   0.854240   3.183 0.001551 ** 
nox         -17.376023   3.535243  -4.915 1.21e-06 ***
rm            3.801579   0.406316   9.356  &lt; 2e-16 ***
dis          -1.492711   0.185731  -8.037 6.84e-15 ***
rad           0.299608   0.063402   4.726 3.00e-06 ***
tax          -0.011778   0.003372  -3.493 0.000521 ***
ptratio      -0.946525   0.129066  -7.334 9.24e-13 ***
black         0.009291   0.002674   3.475 0.000557 ***
lstat        -0.522553   0.047424 -11.019  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 4.736 on 494 degrees of freedom
Multiple R-squared:  0.7406,    Adjusted R-squared:  0.7348 
F-statistic: 128.2 on 11 and 494 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
</section>
<section id="stepwise-selection" class="level3">
<h3 class="anchored" data-anchor-id="stepwise-selection">Stepwise Selection</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Stepwise selection usando AIC</span></span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>stepwise_aic <span class="ot">&lt;-</span> <span class="fu">step</span>(modelo_inicial, </span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">scope =</span> <span class="fu">list</span>(<span class="at">lower =</span> modelo_inicial, <span class="at">upper =</span> modelo_completo_step),</span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">direction =</span> <span class="st">"both"</span>, </span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">trace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb147-6"><a href="#cb147-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-7"><a href="#cb147-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== STEPWISE SELECTION (AIC) ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== STEPWISE SELECTION (AIC) ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Variables seleccionadas:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Variables seleccionadas:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a>stepwise_vars <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">coef</span>(stepwise_aic))[<span class="sc">-</span><span class="dv">1</span>]  <span class="co"># Excluir intercepto</span></span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">paste</span>(stepwise_vars, <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>lstat, rm, ptratio, dis, nox, chas, black, zn, crim, rad, tax </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"AIC final:"</span>, <span class="fu">AIC</span>(stepwise_aic), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>AIC final: 3023.726 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Número de variables:"</span>, <span class="fu">length</span>(stepwise_vars), <span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Número de variables: 11 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Comparación de métodos automáticos</span></span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a>metodos_automaticos <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Metodo =</span> <span class="fu">c</span>(<span class="st">"Forward"</span>, <span class="st">"Backward"</span>, <span class="st">"Stepwise"</span>),</span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">N_Variables =</span> <span class="fu">c</span>(<span class="fu">length</span>(forward_vars), <span class="fu">length</span>(backward_vars), <span class="fu">length</span>(stepwise_vars)),</span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">AIC =</span> <span class="fu">c</span>(<span class="fu">AIC</span>(forward_aic), <span class="fu">AIC</span>(backward_aic), <span class="fu">AIC</span>(stepwise_aic)),</span>
<span id="cb157-6"><a href="#cb157-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">R2_adj =</span> <span class="fu">c</span>(<span class="fu">summary</span>(forward_aic)<span class="sc">$</span>adj.r.squared,</span>
<span id="cb157-7"><a href="#cb157-7" aria-hidden="true" tabindex="-1"></a>             <span class="fu">summary</span>(backward_aic)<span class="sc">$</span>adj.r.squared,</span>
<span id="cb157-8"><a href="#cb157-8" aria-hidden="true" tabindex="-1"></a>             <span class="fu">summary</span>(stepwise_aic)<span class="sc">$</span>adj.r.squared)</span>
<span id="cb157-9"><a href="#cb157-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb157-10"><a href="#cb157-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-11"><a href="#cb157-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(metodos_automaticos)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Metodo N_Variables      AIC    R2_adj
1  Forward          11 3023.726 0.7348058
2 Backward          11 3023.726 0.7348058
3 Stepwise          11 3023.726 0.7348058</code></pre>
</div>
</div>
</section>
<section id="comparación-de-variables-seleccionadas" class="level3">
<h3 class="anchored" data-anchor-id="comparación-de-variables-seleccionadas">Comparación de Variables Seleccionadas</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear matriz de comparación de variables seleccionadas</span></span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a>todas_vars <span class="ot">&lt;-</span> <span class="fu">names</span>(Boston)[<span class="sc">-</span><span class="fu">which</span>(<span class="fu">names</span>(Boston) <span class="sc">==</span> <span class="st">"medv"</span>)]</span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a>comparacion_seleccion <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Variable =</span> todas_vars,</span>
<span id="cb159-6"><a href="#cb159-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Forward =</span> todas_vars <span class="sc">%in%</span> forward_vars,</span>
<span id="cb159-7"><a href="#cb159-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">Backward =</span> todas_vars <span class="sc">%in%</span> backward_vars,</span>
<span id="cb159-8"><a href="#cb159-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">Stepwise =</span> todas_vars <span class="sc">%in%</span> stepwise_vars,</span>
<span id="cb159-9"><a href="#cb159-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">Best_Subset_BIC =</span> todas_vars <span class="sc">%in%</span> vars_mejor_bic,</span>
<span id="cb159-10"><a href="#cb159-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">Best_Subset_Cp =</span> todas_vars <span class="sc">%in%</span> vars_mejor_cp</span>
<span id="cb159-11"><a href="#cb159-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb159-12"><a href="#cb159-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-13"><a href="#cb159-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(comparacion_seleccion)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Variable Forward Backward Stepwise Best_Subset_BIC Best_Subset_Cp
1      crim    TRUE     TRUE     TRUE            TRUE           TRUE
2        zn    TRUE     TRUE     TRUE            TRUE           TRUE
3     indus   FALSE    FALSE    FALSE           FALSE          FALSE
4      chas    TRUE     TRUE     TRUE            TRUE           TRUE
5       nox    TRUE     TRUE     TRUE            TRUE           TRUE
6        rm    TRUE     TRUE     TRUE            TRUE           TRUE
7       age   FALSE    FALSE    FALSE           FALSE          FALSE
8       dis    TRUE     TRUE     TRUE            TRUE           TRUE
9       rad    TRUE     TRUE     TRUE            TRUE           TRUE
10      tax    TRUE     TRUE     TRUE            TRUE           TRUE
11  ptratio    TRUE     TRUE     TRUE            TRUE           TRUE
12    black    TRUE     TRUE     TRUE            TRUE           TRUE
13    lstat    TRUE     TRUE     TRUE            TRUE           TRUE</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Contar coincidencias</span></span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== ANÁLISIS DE COINCIDENCIAS ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== ANÁLISIS DE COINCIDENCIAS ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Variables seleccionadas por todos los métodos:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Variables seleccionadas por todos los métodos:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb165"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a>vars_todas <span class="ot">&lt;-</span> todas_vars[<span class="fu">apply</span>(comparacion_seleccion[,<span class="sc">-</span><span class="dv">1</span>], <span class="dv">1</span>, all)]</span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">length</span>(vars_todas) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">paste</span>(vars_todas, <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb165-4"><a href="#cb165-4" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb165-5"><a href="#cb165-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Ninguna variable fue seleccionada por todos los métodos</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb165-6"><a href="#cb165-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>crim, zn, chas, nox, rm, dis, rad, tax, ptratio, black, lstat </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb167"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Variables seleccionadas por al menos 3 métodos:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Variables seleccionadas por al menos 3 métodos:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb169"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a>vars_mayoria <span class="ot">&lt;-</span> todas_vars[<span class="fu">apply</span>(comparacion_seleccion[,<span class="sc">-</span><span class="dv">1</span>], <span class="dv">1</span>, sum) <span class="sc">&gt;=</span> <span class="dv">3</span>]</span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">paste</span>(vars_mayoria, <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>crim, zn, chas, nox, rm, dis, rad, tax, ptratio, black, lstat </code></pre>
</div>
</div>
</section>
</section>
<section id="parte-6-métodos-de-regularización" class="level2">
<h2 class="anchored" data-anchor-id="parte-6-métodos-de-regularización">Parte 6: Métodos de Regularización</h2>
<section id="preparación-de-datos-para-regularización" class="level3">
<h3 class="anchored" data-anchor-id="preparación-de-datos-para-regularización">Preparación de Datos para Regularización</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb171"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Preparar matrices para glmnet</span></span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(medv <span class="sc">~</span> ., Boston)[, <span class="sc">-</span><span class="dv">1</span>]  <span class="co"># Excluir intercepto</span></span>
<span id="cb171-3"><a href="#cb171-3" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> Boston<span class="sc">$</span>medv</span>
<span id="cb171-4"><a href="#cb171-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-5"><a href="#cb171-5" aria-hidden="true" tabindex="-1"></a><span class="co"># División train/test para regularización</span></span>
<span id="cb171-6"><a href="#cb171-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb171-7"><a href="#cb171-7" aria-hidden="true" tabindex="-1"></a>train_indices <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(X), <span class="fl">0.7</span> <span class="sc">*</span> <span class="fu">nrow</span>(X))</span>
<span id="cb171-8"><a href="#cb171-8" aria-hidden="true" tabindex="-1"></a>X_train <span class="ot">&lt;-</span> X[train_indices, ]</span>
<span id="cb171-9"><a href="#cb171-9" aria-hidden="true" tabindex="-1"></a>y_train <span class="ot">&lt;-</span> y[train_indices]</span>
<span id="cb171-10"><a href="#cb171-10" aria-hidden="true" tabindex="-1"></a>X_test <span class="ot">&lt;-</span> X[<span class="sc">-</span>train_indices, ]</span>
<span id="cb171-11"><a href="#cb171-11" aria-hidden="true" tabindex="-1"></a>y_test <span class="ot">&lt;-</span> y[<span class="sc">-</span>train_indices]</span>
<span id="cb171-12"><a href="#cb171-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-13"><a href="#cb171-13" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== DATOS PARA REGULARIZACIÓN ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== DATOS PARA REGULARIZACIÓN ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb173"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Entrenamiento:"</span>, <span class="fu">nrow</span>(X_train), <span class="st">"observaciones</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Entrenamiento: 354 observaciones</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb175"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Prueba:"</span>, <span class="fu">nrow</span>(X_test), <span class="st">"observaciones</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Prueba: 152 observaciones</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb177"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Variables predictoras:"</span>, <span class="fu">ncol</span>(X), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Variables predictoras: 13 </code></pre>
</div>
</div>
</section>
<section id="ridge-regression" class="level3">
<h3 class="anchored" data-anchor-id="ridge-regression">Ridge Regression</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb179"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Grid de valores lambda</span></span>
<span id="cb179-2"><a href="#cb179-2" aria-hidden="true" tabindex="-1"></a>lambda_grid <span class="ot">&lt;-</span> <span class="dv">10</span><span class="sc">^</span><span class="fu">seq</span>(<span class="dv">10</span>, <span class="sc">-</span><span class="dv">2</span>, <span class="at">length =</span> <span class="dv">100</span>)</span>
<span id="cb179-3"><a href="#cb179-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-4"><a href="#cb179-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Ajustar Ridge regression</span></span>
<span id="cb179-5"><a href="#cb179-5" aria-hidden="true" tabindex="-1"></a>ridge_model <span class="ot">&lt;-</span> <span class="fu">glmnet</span>(X_train, y_train, <span class="at">alpha =</span> <span class="dv">0</span>, <span class="at">lambda =</span> lambda_grid)</span>
<span id="cb179-6"><a href="#cb179-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-7"><a href="#cb179-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Validación cruzada para seleccionar lambda óptimo</span></span>
<span id="cb179-8"><a href="#cb179-8" aria-hidden="true" tabindex="-1"></a>ridge_cv <span class="ot">&lt;-</span> <span class="fu">cv.glmnet</span>(X_train, y_train, <span class="at">alpha =</span> <span class="dv">0</span>, <span class="at">lambda =</span> lambda_grid, <span class="at">nfolds =</span> <span class="dv">10</span>)</span>
<span id="cb179-9"><a href="#cb179-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-10"><a href="#cb179-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Lambda óptimo</span></span>
<span id="cb179-11"><a href="#cb179-11" aria-hidden="true" tabindex="-1"></a>lambda_ridge_min <span class="ot">&lt;-</span> ridge_cv<span class="sc">$</span>lambda.min</span>
<span id="cb179-12"><a href="#cb179-12" aria-hidden="true" tabindex="-1"></a>lambda_ridge_1se <span class="ot">&lt;-</span> ridge_cv<span class="sc">$</span>lambda<span class="fl">.1</span>se</span>
<span id="cb179-13"><a href="#cb179-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-14"><a href="#cb179-14" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== RIDGE REGRESSION ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== RIDGE REGRESSION ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb181"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Lambda mínimo:"</span>, lambda_ridge_min, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Lambda mínimo: 0.2154435 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb183"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Lambda 1SE:"</span>, lambda_ridge_1se, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Lambda 1SE: 3.511192 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb185"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicciones en conjunto de prueba</span></span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a>ridge_pred_min <span class="ot">&lt;-</span> <span class="fu">predict</span>(ridge_model, <span class="at">s =</span> lambda_ridge_min, <span class="at">newx =</span> X_test)</span>
<span id="cb185-3"><a href="#cb185-3" aria-hidden="true" tabindex="-1"></a>ridge_pred_1se <span class="ot">&lt;-</span> <span class="fu">predict</span>(ridge_model, <span class="at">s =</span> lambda_ridge_1se, <span class="at">newx =</span> X_test)</span>
<span id="cb185-4"><a href="#cb185-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-5"><a href="#cb185-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Métricas de rendimiento</span></span>
<span id="cb185-6"><a href="#cb185-6" aria-hidden="true" tabindex="-1"></a>ridge_rmse_min <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((ridge_pred_min <span class="sc">-</span> y_test)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb185-7"><a href="#cb185-7" aria-hidden="true" tabindex="-1"></a>ridge_rmse_1se <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((ridge_pred_1se <span class="sc">-</span> y_test)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb185-8"><a href="#cb185-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-9"><a href="#cb185-9" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"RMSE (lambda min):"</span>, <span class="fu">round</span>(ridge_rmse_min, <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>RMSE (lambda min): 4.808 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb187"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"RMSE (lambda 1SE):"</span>, <span class="fu">round</span>(ridge_rmse_1se, <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>RMSE (lambda 1SE): 5.097 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb189"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Coeficientes finales</span></span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a>ridge_coefs <span class="ot">&lt;-</span> <span class="fu">predict</span>(ridge_model, <span class="at">type =</span> <span class="st">"coefficients"</span>, <span class="at">s =</span> lambda_ridge_min)[<span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>, ]</span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">round</span>(ridge_coefs, <span class="dv">4</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)        crim          zn       indus        chas         nox 
    35.0389     -0.1006      0.0457     -0.0737      4.1240    -12.3324 
         rm         age         dis         rad         tax     ptratio 
     3.3099     -0.0028     -1.3924      0.2352     -0.0074     -0.8353 
      black       lstat 
     0.0069     -0.5599 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb191"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráfico de validación cruzada</span></span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ridge_cv, <span class="at">main =</span> <span class="st">"Validación Cruzada - Ridge Regression"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lab4_seleccion_variables_files/figure-html/ridge_regression-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="lasso-regression" class="level3">
<h3 class="anchored" data-anchor-id="lasso-regression">Lasso Regression</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb192"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ajustar Lasso regression</span></span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a>lasso_model <span class="ot">&lt;-</span> <span class="fu">glmnet</span>(X_train, y_train, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">lambda =</span> lambda_grid)</span>
<span id="cb192-3"><a href="#cb192-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-4"><a href="#cb192-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Validación cruzada para seleccionar lambda óptimo</span></span>
<span id="cb192-5"><a href="#cb192-5" aria-hidden="true" tabindex="-1"></a>lasso_cv <span class="ot">&lt;-</span> <span class="fu">cv.glmnet</span>(X_train, y_train, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">lambda =</span> lambda_grid, <span class="at">nfolds =</span> <span class="dv">10</span>)</span>
<span id="cb192-6"><a href="#cb192-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-7"><a href="#cb192-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Lambda óptimo</span></span>
<span id="cb192-8"><a href="#cb192-8" aria-hidden="true" tabindex="-1"></a>lambda_lasso_min <span class="ot">&lt;-</span> lasso_cv<span class="sc">$</span>lambda.min</span>
<span id="cb192-9"><a href="#cb192-9" aria-hidden="true" tabindex="-1"></a>lambda_lasso_1se <span class="ot">&lt;-</span> lasso_cv<span class="sc">$</span>lambda<span class="fl">.1</span>se</span>
<span id="cb192-10"><a href="#cb192-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-11"><a href="#cb192-11" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== LASSO REGRESSION ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== LASSO REGRESSION ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb194"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Lambda mínimo:"</span>, lambda_lasso_min, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Lambda mínimo: 0.03053856 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb196"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Lambda 1SE:"</span>, lambda_lasso_1se, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Lambda 1SE: 0.4977024 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb198"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicciones en conjunto de prueba</span></span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a>lasso_pred_min <span class="ot">&lt;-</span> <span class="fu">predict</span>(lasso_model, <span class="at">s =</span> lambda_lasso_min, <span class="at">newx =</span> X_test)</span>
<span id="cb198-3"><a href="#cb198-3" aria-hidden="true" tabindex="-1"></a>lasso_pred_1se <span class="ot">&lt;-</span> <span class="fu">predict</span>(lasso_model, <span class="at">s =</span> lambda_lasso_1se, <span class="at">newx =</span> X_test)</span>
<span id="cb198-4"><a href="#cb198-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-5"><a href="#cb198-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Métricas de rendimiento</span></span>
<span id="cb198-6"><a href="#cb198-6" aria-hidden="true" tabindex="-1"></a>lasso_rmse_min <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((lasso_pred_min <span class="sc">-</span> y_test)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb198-7"><a href="#cb198-7" aria-hidden="true" tabindex="-1"></a>lasso_rmse_1se <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((lasso_pred_1se <span class="sc">-</span> y_test)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb198-8"><a href="#cb198-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-9"><a href="#cb198-9" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"RMSE (lambda min):"</span>, <span class="fu">round</span>(lasso_rmse_min, <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>RMSE (lambda min): 4.809 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb200"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"RMSE (lambda 1SE):"</span>, <span class="fu">round</span>(lasso_rmse_1se, <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>RMSE (lambda 1SE): 5.173 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb202"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Coeficientes finales (Lasso puede hacer coeficientes = 0)</span></span>
<span id="cb202-2"><a href="#cb202-2" aria-hidden="true" tabindex="-1"></a>lasso_coefs <span class="ot">&lt;-</span> <span class="fu">predict</span>(lasso_model, <span class="at">type =</span> <span class="st">"coefficients"</span>, <span class="at">s =</span> lambda_lasso_min)[<span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>, ]</span>
<span id="cb202-3"><a href="#cb202-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">round</span>(lasso_coefs, <span class="dv">4</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)        crim          zn       indus        chas         nox 
    36.6203     -0.0995      0.0480     -0.0601      4.0266    -13.2037 
         rm         age         dis         rad         tax     ptratio 
     3.2292      0.0000     -1.4423      0.2503     -0.0082     -0.8410 
      black       lstat 
     0.0065     -0.5850 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb204"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Variables seleccionadas por Lasso</span></span>
<span id="cb204-2"><a href="#cb204-2" aria-hidden="true" tabindex="-1"></a>vars_lasso <span class="ot">&lt;-</span> <span class="fu">names</span>(lasso_coefs[lasso_coefs <span class="sc">!=</span> <span class="dv">0</span>])[<span class="sc">-</span><span class="dv">1</span>]  <span class="co"># Excluir intercepto</span></span>
<span id="cb204-3"><a href="#cb204-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Variables seleccionadas por Lasso:"</span>, <span class="fu">paste</span>(vars_lasso, <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Variables seleccionadas por Lasso: crim, zn, indus, chas, nox, rm, dis, rad, tax, ptratio, black, lstat </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb206"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Número de variables seleccionadas:"</span>, <span class="fu">length</span>(vars_lasso), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Número de variables seleccionadas: 12 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb208"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráfico de validación cruzada</span></span>
<span id="cb208-2"><a href="#cb208-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lasso_cv, <span class="at">main =</span> <span class="st">"Validación Cruzada - Lasso Regression"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lab4_seleccion_variables_files/figure-html/lasso_regression-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="elastic-net" class="level3">
<h3 class="anchored" data-anchor-id="elastic-net">Elastic Net</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb209"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Grid de valores alpha para Elastic Net</span></span>
<span id="cb209-2"><a href="#cb209-2" aria-hidden="true" tabindex="-1"></a>alpha_grid <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length =</span> <span class="dv">11</span>)</span>
<span id="cb209-3"><a href="#cb209-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-4"><a href="#cb209-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Función para encontrar el mejor alpha</span></span>
<span id="cb209-5"><a href="#cb209-5" aria-hidden="true" tabindex="-1"></a>best_alpha_search <span class="ot">&lt;-</span> <span class="cf">function</span>(alpha_val) {</span>
<span id="cb209-6"><a href="#cb209-6" aria-hidden="true" tabindex="-1"></a>  cv_result <span class="ot">&lt;-</span> <span class="fu">cv.glmnet</span>(X_train, y_train, <span class="at">alpha =</span> alpha_val, <span class="at">lambda =</span> lambda_grid, <span class="at">nfolds =</span> <span class="dv">10</span>)</span>
<span id="cb209-7"><a href="#cb209-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">data.frame</span>(<span class="at">alpha =</span> alpha_val, </span>
<span id="cb209-8"><a href="#cb209-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">lambda_min =</span> cv_result<span class="sc">$</span>lambda.min,</span>
<span id="cb209-9"><a href="#cb209-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">cvm_min =</span> <span class="fu">min</span>(cv_result<span class="sc">$</span>cvm)))</span>
<span id="cb209-10"><a href="#cb209-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb209-11"><a href="#cb209-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-12"><a href="#cb209-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Buscar mejor alpha</span></span>
<span id="cb209-13"><a href="#cb209-13" aria-hidden="true" tabindex="-1"></a>alpha_results <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(alpha_grid, best_alpha_search)</span>
<span id="cb209-14"><a href="#cb209-14" aria-hidden="true" tabindex="-1"></a>best_alpha <span class="ot">&lt;-</span> alpha_results<span class="sc">$</span>alpha[<span class="fu">which.min</span>(alpha_results<span class="sc">$</span>cvm_min)]</span>
<span id="cb209-15"><a href="#cb209-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-16"><a href="#cb209-16" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== ELASTIC NET ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== ELASTIC NET ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb211"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Mejor alpha:"</span>, best_alpha, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mejor alpha: 0.1 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb213"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ajustar Elastic Net con mejor alpha</span></span>
<span id="cb213-2"><a href="#cb213-2" aria-hidden="true" tabindex="-1"></a>elastic_model <span class="ot">&lt;-</span> <span class="fu">glmnet</span>(X_train, y_train, <span class="at">alpha =</span> best_alpha, <span class="at">lambda =</span> lambda_grid)</span>
<span id="cb213-3"><a href="#cb213-3" aria-hidden="true" tabindex="-1"></a>elastic_cv <span class="ot">&lt;-</span> <span class="fu">cv.glmnet</span>(X_train, y_train, <span class="at">alpha =</span> best_alpha, <span class="at">lambda =</span> lambda_grid, <span class="at">nfolds =</span> <span class="dv">10</span>)</span>
<span id="cb213-4"><a href="#cb213-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-5"><a href="#cb213-5" aria-hidden="true" tabindex="-1"></a>lambda_elastic_min <span class="ot">&lt;-</span> elastic_cv<span class="sc">$</span>lambda.min</span>
<span id="cb213-6"><a href="#cb213-6" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Lambda óptimo:"</span>, lambda_elastic_min, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Lambda óptimo: 0.09326033 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb215"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicciones en conjunto de prueba</span></span>
<span id="cb215-2"><a href="#cb215-2" aria-hidden="true" tabindex="-1"></a>elastic_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(elastic_model, <span class="at">s =</span> lambda_elastic_min, <span class="at">newx =</span> X_test)</span>
<span id="cb215-3"><a href="#cb215-3" aria-hidden="true" tabindex="-1"></a>elastic_rmse <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((elastic_pred <span class="sc">-</span> y_test)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb215-4"><a href="#cb215-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-5"><a href="#cb215-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"RMSE:"</span>, <span class="fu">round</span>(elastic_rmse, <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>RMSE: 4.807 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb217"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Coeficientes finales</span></span>
<span id="cb217-2"><a href="#cb217-2" aria-hidden="true" tabindex="-1"></a>elastic_coefs <span class="ot">&lt;-</span> <span class="fu">predict</span>(elastic_model, <span class="at">type =</span> <span class="st">"coefficients"</span>, <span class="at">s =</span> lambda_elastic_min)[<span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>, ]</span>
<span id="cb217-3"><a href="#cb217-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">round</span>(elastic_coefs, <span class="dv">4</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)        crim          zn       indus        chas         nox 
    36.5105     -0.1027      0.0484     -0.0654      4.0768    -13.2051 
         rm         age         dis         rad         tax     ptratio 
     3.2478     -0.0011     -1.4508      0.2576     -0.0084     -0.8440 
      black       lstat 
     0.0068     -0.5747 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb219"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Variables seleccionadas por Elastic Net</span></span>
<span id="cb219-2"><a href="#cb219-2" aria-hidden="true" tabindex="-1"></a>vars_elastic <span class="ot">&lt;-</span> <span class="fu">names</span>(elastic_coefs[<span class="fu">abs</span>(elastic_coefs) <span class="sc">&gt;</span> <span class="fl">1e-6</span>])[<span class="sc">-</span><span class="dv">1</span>]  <span class="co"># Excluir intercepto</span></span>
<span id="cb219-3"><a href="#cb219-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Variables seleccionadas por Elastic Net:"</span>, <span class="fu">paste</span>(vars_elastic, <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Variables seleccionadas por Elastic Net: crim, zn, indus, chas, nox, rm, age, dis, rad, tax, ptratio, black, lstat </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb221"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Número de variables seleccionadas:"</span>, <span class="fu">length</span>(vars_elastic), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Número de variables seleccionadas: 13 </code></pre>
</div>
</div>
</section>
<section id="comparación-de-métodos-de-regularización" class="level3">
<h3 class="anchored" data-anchor-id="comparación-de-métodos-de-regularización">Comparación de Métodos de Regularización</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb223"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Comparar todos los métodos de regularización</span></span>
<span id="cb223-2"><a href="#cb223-2" aria-hidden="true" tabindex="-1"></a>comparacion_reg <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb223-3"><a href="#cb223-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Metodo =</span> <span class="fu">c</span>(<span class="st">"Ridge (min)"</span>, <span class="st">"Ridge (1SE)"</span>, <span class="st">"Lasso (min)"</span>, <span class="st">"Lasso (1SE)"</span>, <span class="st">"Elastic Net"</span>),</span>
<span id="cb223-4"><a href="#cb223-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">RMSE =</span> <span class="fu">c</span>(ridge_rmse_min, ridge_rmse_1se, lasso_rmse_min, lasso_rmse_1se, elastic_rmse),</span>
<span id="cb223-5"><a href="#cb223-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">N_Variables =</span> <span class="fu">c</span>(<span class="fu">sum</span>(<span class="fu">abs</span>(ridge_coefs[<span class="sc">-</span><span class="dv">1</span>]) <span class="sc">&gt;</span> <span class="fl">1e-6</span>),</span>
<span id="cb223-6"><a href="#cb223-6" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">sum</span>(<span class="fu">abs</span>(<span class="fu">predict</span>(ridge_model, <span class="at">type =</span> <span class="st">"coefficients"</span>, <span class="at">s =</span> lambda_ridge_1se)[<span class="dv">2</span><span class="sc">:</span><span class="dv">14</span>, ]) <span class="sc">&gt;</span> <span class="fl">1e-6</span>),</span>
<span id="cb223-7"><a href="#cb223-7" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">length</span>(vars_lasso),</span>
<span id="cb223-8"><a href="#cb223-8" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">sum</span>(<span class="fu">abs</span>(<span class="fu">predict</span>(lasso_model, <span class="at">type =</span> <span class="st">"coefficients"</span>, <span class="at">s =</span> lambda_lasso_1se)[<span class="dv">2</span><span class="sc">:</span><span class="dv">14</span>, ]) <span class="sc">&gt;</span> <span class="fl">1e-6</span>),</span>
<span id="cb223-9"><a href="#cb223-9" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">length</span>(vars_elastic))</span>
<span id="cb223-10"><a href="#cb223-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb223-11"><a href="#cb223-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-12"><a href="#cb223-12" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(comparacion_reg)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>       Metodo     RMSE N_Variables
1 Ridge (min) 4.808306          13
2 Ridge (1SE) 5.097124          13
3 Lasso (min) 4.809276          12
4 Lasso (1SE) 5.173273           7
5 Elastic Net 4.806585          13</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb225"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráfico de comparación</span></span>
<span id="cb225-2"><a href="#cb225-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(comparacion_reg, <span class="fu">aes</span>(<span class="at">x =</span> N_Variables, <span class="at">y =</span> RMSE, <span class="at">color =</span> Metodo)) <span class="sc">+</span></span>
<span id="cb225-3"><a href="#cb225-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb225-4"><a href="#cb225-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> Metodo), <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb225-5"><a href="#cb225-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Comparación de Métodos de Regularización"</span>,</span>
<span id="cb225-6"><a href="#cb225-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Número de Variables Efectivas"</span>, </span>
<span id="cb225-7"><a href="#cb225-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"RMSE en Conjunto de Prueba"</span>) <span class="sc">+</span></span>
<span id="cb225-8"><a href="#cb225-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb225-9"><a href="#cb225-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lab4_seleccion_variables_files/figure-html/regularization_comparison-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="parte-7-validación-rigurosa-del-modelo" class="level2">
<h2 class="anchored" data-anchor-id="parte-7-validación-rigurosa-del-modelo">Parte 7: Validación Rigurosa del Modelo</h2>
<section id="partición-final-de-datos" class="level3">
<h3 class="anchored" data-anchor-id="partición-final-de-datos">Partición Final de Datos</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb226"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Partición inicial: 60% modelado, 40% validación final</span></span>
<span id="cb226-2"><a href="#cb226-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb226-3"><a href="#cb226-3" aria-hidden="true" tabindex="-1"></a>indices_final <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(Boston<span class="sc">$</span>medv, <span class="at">p =</span> <span class="fl">0.6</span>, <span class="at">list =</span> <span class="cn">FALSE</span>)</span>
<span id="cb226-4"><a href="#cb226-4" aria-hidden="true" tabindex="-1"></a>datos_modelado <span class="ot">&lt;-</span> Boston[indices_final, ]</span>
<span id="cb226-5"><a href="#cb226-5" aria-hidden="true" tabindex="-1"></a>datos_validacion_final <span class="ot">&lt;-</span> Boston[<span class="sc">-</span>indices_final, ]</span>
<span id="cb226-6"><a href="#cb226-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-7"><a href="#cb226-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== PARTICIÓN FINAL DE DATOS ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== PARTICIÓN FINAL DE DATOS ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb228"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Datos para modelado:"</span>, <span class="fu">nrow</span>(datos_modelado), <span class="st">"observaciones</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Datos para modelado: 306 observaciones</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb230"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Datos para validación final:"</span>, <span class="fu">nrow</span>(datos_validacion_final), <span class="st">"observaciones</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Datos para validación final: 200 observaciones</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb232"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Dentro de datos de modelado: 75% entrenamiento, 25% test para comparar modelos</span></span>
<span id="cb232-2"><a href="#cb232-2" aria-hidden="true" tabindex="-1"></a>indices_train <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(datos_modelado<span class="sc">$</span>medv, <span class="at">p =</span> <span class="fl">0.75</span>, <span class="at">list =</span> <span class="cn">FALSE</span>)</span>
<span id="cb232-3"><a href="#cb232-3" aria-hidden="true" tabindex="-1"></a>datos_train <span class="ot">&lt;-</span> datos_modelado[indices_train, ]</span>
<span id="cb232-4"><a href="#cb232-4" aria-hidden="true" tabindex="-1"></a>datos_test <span class="ot">&lt;-</span> datos_modelado[<span class="sc">-</span>indices_train, ]</span>
<span id="cb232-5"><a href="#cb232-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-6"><a href="#cb232-6" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Datos de entrenamiento:"</span>, <span class="fu">nrow</span>(datos_train), <span class="st">"observaciones</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Datos de entrenamiento: 231 observaciones</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb234"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Datos de test (comparación):"</span>, <span class="fu">nrow</span>(datos_test), <span class="st">"observaciones</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Datos de test (comparación): 75 observaciones</code></pre>
</div>
</div>
</section>
<section id="validación-cruzada-de-modelos-seleccionados" class="level3">
<h3 class="anchored" data-anchor-id="validación-cruzada-de-modelos-seleccionados">Validación Cruzada de Modelos Seleccionados</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb236"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Configurar validación cruzada 10-fold</span></span>
<span id="cb236-2"><a href="#cb236-2" aria-hidden="true" tabindex="-1"></a>control_cv <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"cv"</span>, <span class="at">number =</span> <span class="dv">10</span>, <span class="at">verboseIter =</span> <span class="cn">FALSE</span>)</span>
<span id="cb236-3"><a href="#cb236-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-4"><a href="#cb236-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Modelos a comparar basados en selecciones anteriores</span></span>
<span id="cb236-5"><a href="#cb236-5" aria-hidden="true" tabindex="-1"></a>modelos_finales <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb236-6"><a href="#cb236-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-7"><a href="#cb236-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Modelo basado en Best Subset (BIC)</span></span>
<span id="cb236-8"><a href="#cb236-8" aria-hidden="true" tabindex="-1"></a>formula_bic <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(<span class="st">"medv ~"</span>, <span class="fu">paste</span>(vars_mejor_bic, <span class="at">collapse =</span> <span class="st">" + "</span>)))</span>
<span id="cb236-9"><a href="#cb236-9" aria-hidden="true" tabindex="-1"></a>modelo_bic_cv <span class="ot">&lt;-</span> <span class="fu">train</span>(formula_bic, <span class="at">data =</span> datos_modelado, <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">trControl =</span> control_cv)</span>
<span id="cb236-10"><a href="#cb236-10" aria-hidden="true" tabindex="-1"></a>modelos_finales[[<span class="st">"Best_Subset_BIC"</span>]] <span class="ot">&lt;-</span> modelo_bic_cv</span>
<span id="cb236-11"><a href="#cb236-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-12"><a href="#cb236-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Modelo basado en Stepwise</span></span>
<span id="cb236-13"><a href="#cb236-13" aria-hidden="true" tabindex="-1"></a>formula_stepwise <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(<span class="st">"medv ~"</span>, <span class="fu">paste</span>(stepwise_vars, <span class="at">collapse =</span> <span class="st">" + "</span>)))</span>
<span id="cb236-14"><a href="#cb236-14" aria-hidden="true" tabindex="-1"></a>modelo_stepwise_cv <span class="ot">&lt;-</span> <span class="fu">train</span>(formula_stepwise, <span class="at">data =</span> datos_modelado, <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">trControl =</span> control_cv)</span>
<span id="cb236-15"><a href="#cb236-15" aria-hidden="true" tabindex="-1"></a>modelos_finales[[<span class="st">"Stepwise"</span>]] <span class="ot">&lt;-</span> modelo_stepwise_cv</span>
<span id="cb236-16"><a href="#cb236-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-17"><a href="#cb236-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Modelo basado en Lasso (usando variables seleccionadas)</span></span>
<span id="cb236-18"><a href="#cb236-18" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">length</span>(vars_lasso) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb236-19"><a href="#cb236-19" aria-hidden="true" tabindex="-1"></a>  formula_lasso <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(<span class="st">"medv ~"</span>, <span class="fu">paste</span>(vars_lasso, <span class="at">collapse =</span> <span class="st">" + "</span>)))</span>
<span id="cb236-20"><a href="#cb236-20" aria-hidden="true" tabindex="-1"></a>  modelo_lasso_cv <span class="ot">&lt;-</span> <span class="fu">train</span>(formula_lasso, <span class="at">data =</span> datos_modelado, <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">trControl =</span> control_cv)</span>
<span id="cb236-21"><a href="#cb236-21" aria-hidden="true" tabindex="-1"></a>  modelos_finales[[<span class="st">"Lasso_Selection"</span>]] <span class="ot">&lt;-</span> modelo_lasso_cv</span>
<span id="cb236-22"><a href="#cb236-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb236-23"><a href="#cb236-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-24"><a href="#cb236-24" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Modelo Ridge (regularizado)</span></span>
<span id="cb236-25"><a href="#cb236-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Preparar datos para glmnet en caret</span></span>
<span id="cb236-26"><a href="#cb236-26" aria-hidden="true" tabindex="-1"></a>X_modelado <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(medv <span class="sc">~</span> ., datos_modelado)[, <span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb236-27"><a href="#cb236-27" aria-hidden="true" tabindex="-1"></a>y_modelado <span class="ot">&lt;-</span> datos_modelado<span class="sc">$</span>medv</span>
<span id="cb236-28"><a href="#cb236-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-29"><a href="#cb236-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Grid de lambda para Ridge</span></span>
<span id="cb236-30"><a href="#cb236-30" aria-hidden="true" tabindex="-1"></a>ridge_grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">alpha =</span> <span class="dv">0</span>, <span class="at">lambda =</span> <span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="dv">10</span>, <span class="at">length =</span> <span class="dv">50</span>))</span>
<span id="cb236-31"><a href="#cb236-31" aria-hidden="true" tabindex="-1"></a>modelo_ridge_cv <span class="ot">&lt;-</span> <span class="fu">train</span>(X_modelado, y_modelado, <span class="at">method =</span> <span class="st">"glmnet"</span>, </span>
<span id="cb236-32"><a href="#cb236-32" aria-hidden="true" tabindex="-1"></a>                        <span class="at">tuneGrid =</span> ridge_grid, <span class="at">trControl =</span> control_cv)</span>
<span id="cb236-33"><a href="#cb236-33" aria-hidden="true" tabindex="-1"></a>modelos_finales[[<span class="st">"Ridge"</span>]] <span class="ot">&lt;-</span> modelo_ridge_cv</span>
<span id="cb236-34"><a href="#cb236-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-35"><a href="#cb236-35" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Modelo Lasso (regularizado)</span></span>
<span id="cb236-36"><a href="#cb236-36" aria-hidden="true" tabindex="-1"></a>lasso_grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">lambda =</span> <span class="fu">seq</span>(<span class="fl">0.01</span>, <span class="dv">1</span>, <span class="at">length =</span> <span class="dv">50</span>))</span>
<span id="cb236-37"><a href="#cb236-37" aria-hidden="true" tabindex="-1"></a>modelo_lasso_reg_cv <span class="ot">&lt;-</span> <span class="fu">train</span>(X_modelado, y_modelado, <span class="at">method =</span> <span class="st">"glmnet"</span>,</span>
<span id="cb236-38"><a href="#cb236-38" aria-hidden="true" tabindex="-1"></a>                            <span class="at">tuneGrid =</span> lasso_grid, <span class="at">trControl =</span> control_cv)</span>
<span id="cb236-39"><a href="#cb236-39" aria-hidden="true" tabindex="-1"></a>modelos_finales[[<span class="st">"Lasso_Regularized"</span>]] <span class="ot">&lt;-</span> modelo_lasso_reg_cv</span>
<span id="cb236-40"><a href="#cb236-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-41"><a href="#cb236-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Comparar resultados de validación cruzada</span></span>
<span id="cb236-42"><a href="#cb236-42" aria-hidden="true" tabindex="-1"></a>resultados_cv <span class="ot">&lt;-</span> <span class="fu">resamples</span>(modelos_finales[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])  <span class="co"># Solo modelos lm</span></span>
<span id="cb236-43"><a href="#cb236-43" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(resultados_cv)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
summary.resamples(object = resultados_cv)

Models: Best_Subset_BIC, Stepwise, Lasso_Selection 
Number of resamples: 10 

MAE 
                    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. NA's
Best_Subset_BIC 2.511621 3.405453 3.709447 3.583130 3.964655 4.261554    0
Stepwise        3.004539 3.138063 3.512252 3.651229 3.908887 5.203631    0
Lasso_Selection 3.005074 3.185410 3.440805 3.582353 3.996335 4.324443    0

RMSE 
                    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. NA's
Best_Subset_BIC 3.548486 4.314765 5.284095 5.102120 6.093742 6.295601    0
Stepwise        3.653542 4.140664 5.029286 5.137206 5.582081 8.352953    0
Lasso_Selection 3.741350 4.523334 4.633436 5.125640 6.000213 6.731290    0

Rsquared 
                     Min.   1st Qu.    Median      Mean   3rd Qu.      Max.
Best_Subset_BIC 0.4930215 0.6516873 0.7047988 0.7104641 0.7644463 0.9291600
Stepwise        0.4532123 0.6946508 0.7499443 0.7224326 0.8189765 0.8821170
Lasso_Selection 0.5412993 0.6201279 0.7349385 0.7142692 0.7787736 0.9108091
                NA's
Best_Subset_BIC    0
Stepwise           0
Lasso_Selection    0</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb238"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraer métricas de todos los modelos</span></span>
<span id="cb238-2"><a href="#cb238-2" aria-hidden="true" tabindex="-1"></a>metricas_cv <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb238-3"><a href="#cb238-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Modelo =</span> <span class="fu">names</span>(modelos_finales),</span>
<span id="cb238-4"><a href="#cb238-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">RMSE_CV =</span> <span class="fu">c</span>(</span>
<span id="cb238-5"><a href="#cb238-5" aria-hidden="true" tabindex="-1"></a>    modelo_bic_cv<span class="sc">$</span>results<span class="sc">$</span>RMSE,</span>
<span id="cb238-6"><a href="#cb238-6" aria-hidden="true" tabindex="-1"></a>    modelo_stepwise_cv<span class="sc">$</span>results<span class="sc">$</span>RMSE,</span>
<span id="cb238-7"><a href="#cb238-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">exists</span>(<span class="st">"modelo_lasso_cv"</span>)) modelo_lasso_cv<span class="sc">$</span>results<span class="sc">$</span>RMSE <span class="cf">else</span> <span class="cn">NA</span>,</span>
<span id="cb238-8"><a href="#cb238-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">min</span>(modelo_ridge_cv<span class="sc">$</span>results<span class="sc">$</span>RMSE),</span>
<span id="cb238-9"><a href="#cb238-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">min</span>(modelo_lasso_reg_cv<span class="sc">$</span>results<span class="sc">$</span>RMSE)</span>
<span id="cb238-10"><a href="#cb238-10" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb238-11"><a href="#cb238-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">R2_CV =</span> <span class="fu">c</span>(</span>
<span id="cb238-12"><a href="#cb238-12" aria-hidden="true" tabindex="-1"></a>    modelo_bic_cv<span class="sc">$</span>results<span class="sc">$</span>Rsquared,</span>
<span id="cb238-13"><a href="#cb238-13" aria-hidden="true" tabindex="-1"></a>    modelo_stepwise_cv<span class="sc">$</span>results<span class="sc">$</span>Rsquared,</span>
<span id="cb238-14"><a href="#cb238-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">exists</span>(<span class="st">"modelo_lasso_cv"</span>)) modelo_lasso_cv<span class="sc">$</span>results<span class="sc">$</span>Rsquared <span class="cf">else</span> <span class="cn">NA</span>,</span>
<span id="cb238-15"><a href="#cb238-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">max</span>(modelo_ridge_cv<span class="sc">$</span>results<span class="sc">$</span>Rsquared),</span>
<span id="cb238-16"><a href="#cb238-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">max</span>(modelo_lasso_reg_cv<span class="sc">$</span>results<span class="sc">$</span>Rsquared)</span>
<span id="cb238-17"><a href="#cb238-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb238-18"><a href="#cb238-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb238-19"><a href="#cb238-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-20"><a href="#cb238-20" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(metricas_cv)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>             Modelo  RMSE_CV     R2_CV
1   Best_Subset_BIC 5.102120 0.7104641
2          Stepwise 5.137206 0.7224326
3   Lasso_Selection 5.125640 0.7142692
4             Ridge 5.006564 0.7293036
5 Lasso_Regularized 5.076481 0.7240252</code></pre>
</div>
</div>
</section>
<section id="evaluación-final-en-datos-no-vistos" class="level3">
<h3 class="anchored" data-anchor-id="evaluación-final-en-datos-no-vistos">Evaluación Final en Datos No Vistos</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb240"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Seleccionar el mejor modelo basado en validación cruzada</span></span>
<span id="cb240-2"><a href="#cb240-2" aria-hidden="true" tabindex="-1"></a>mejor_modelo_idx <span class="ot">&lt;-</span> <span class="fu">which.min</span>(metricas_cv<span class="sc">$</span>RMSE_CV[<span class="sc">!</span><span class="fu">is.na</span>(metricas_cv<span class="sc">$</span>RMSE_CV)])</span>
<span id="cb240-3"><a href="#cb240-3" aria-hidden="true" tabindex="-1"></a>mejor_modelo_nombre <span class="ot">&lt;-</span> metricas_cv<span class="sc">$</span>Modelo[mejor_modelo_idx]</span>
<span id="cb240-4"><a href="#cb240-4" aria-hidden="true" tabindex="-1"></a>mejor_modelo <span class="ot">&lt;-</span> modelos_finales[[mejor_modelo_nombre]]</span>
<span id="cb240-5"><a href="#cb240-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-6"><a href="#cb240-6" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== EVALUACIÓN FINAL ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== EVALUACIÓN FINAL ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb242"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb242-1"><a href="#cb242-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Mejor modelo según CV:"</span>, mejor_modelo_nombre, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mejor modelo según CV: Ridge </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb244"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb244-1"><a href="#cb244-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"RMSE de validación cruzada:"</span>, <span class="fu">round</span>(<span class="fu">min</span>(metricas_cv<span class="sc">$</span>RMSE_CV, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>RMSE de validación cruzada: 5.007 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb246"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb246-1"><a href="#cb246-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicciones en conjunto de validación final</span></span>
<span id="cb246-2"><a href="#cb246-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(mejor_modelo_nombre <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Ridge"</span>, <span class="st">"Lasso_Regularized"</span>)) {</span>
<span id="cb246-3"><a href="#cb246-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Para modelos glmnet, preparar matriz</span></span>
<span id="cb246-4"><a href="#cb246-4" aria-hidden="true" tabindex="-1"></a>  X_validacion <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(medv <span class="sc">~</span> ., datos_validacion_final)[, <span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb246-5"><a href="#cb246-5" aria-hidden="true" tabindex="-1"></a>  predicciones_finales <span class="ot">&lt;-</span> <span class="fu">predict</span>(mejor_modelo, X_validacion)</span>
<span id="cb246-6"><a href="#cb246-6" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb246-7"><a href="#cb246-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Para modelos lm</span></span>
<span id="cb246-8"><a href="#cb246-8" aria-hidden="true" tabindex="-1"></a>  predicciones_finales <span class="ot">&lt;-</span> <span class="fu">predict</span>(mejor_modelo, datos_validacion_final)</span>
<span id="cb246-9"><a href="#cb246-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb246-10"><a href="#cb246-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb246-11"><a href="#cb246-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Métricas en conjunto de validación final</span></span>
<span id="cb246-12"><a href="#cb246-12" aria-hidden="true" tabindex="-1"></a>rmse_final <span class="ot">&lt;-</span> <span class="fu">RMSE</span>(predicciones_finales, datos_validacion_final<span class="sc">$</span>medv)</span>
<span id="cb246-13"><a href="#cb246-13" aria-hidden="true" tabindex="-1"></a>mae_final <span class="ot">&lt;-</span> <span class="fu">MAE</span>(predicciones_finales, datos_validacion_final<span class="sc">$</span>medv)</span>
<span id="cb246-14"><a href="#cb246-14" aria-hidden="true" tabindex="-1"></a>r2_final <span class="ot">&lt;-</span> <span class="fu">cor</span>(predicciones_finales, datos_validacion_final<span class="sc">$</span>medv)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb246-15"><a href="#cb246-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb246-16"><a href="#cb246-16" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== RENDIMIENTO EN DATOS DE VALIDACIÓN FINAL ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== RENDIMIENTO EN DATOS DE VALIDACIÓN FINAL ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb248"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb248-1"><a href="#cb248-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"RMSE:"</span>, <span class="fu">round</span>(rmse_final, <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>RMSE: 4.373 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb250"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb250-1"><a href="#cb250-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"MAE:"</span>, <span class="fu">round</span>(mae_final, <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>MAE: 3.18 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb252"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb252-1"><a href="#cb252-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"R²:"</span>, <span class="fu">round</span>(r2_final, <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>R²: 0.739 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb254"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb254-1"><a href="#cb254-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Comparación CV vs Final</span></span>
<span id="cb254-2"><a href="#cb254-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Comparación CV vs Final:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Comparación CV vs Final:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb256"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb256-1"><a href="#cb256-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"RMSE CV:"</span>, <span class="fu">round</span>(<span class="fu">min</span>(metricas_cv<span class="sc">$</span>RMSE_CV, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>RMSE CV: 5.007 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb258"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb258-1"><a href="#cb258-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"RMSE Final:"</span>, <span class="fu">round</span>(rmse_final, <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>RMSE Final: 4.373 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb260"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a>diferencia_rmse <span class="ot">&lt;-</span> rmse_final <span class="sc">-</span> <span class="fu">min</span>(metricas_cv<span class="sc">$</span>RMSE_CV, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb260-2"><a href="#cb260-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Diferencia:"</span>, <span class="fu">round</span>(diferencia_rmse, <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Diferencia: -0.634 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb262"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb262-1"><a href="#cb262-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">abs</span>(diferencia_rmse) <span class="sc">&lt;</span> <span class="fl">0.5</span>) {</span>
<span id="cb262-2"><a href="#cb262-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"✓ El modelo generaliza bien - diferencia mínima entre CV y validación final</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb262-3"><a href="#cb262-3" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span>(diferencia_rmse <span class="sc">&gt;</span> <span class="fl">0.5</span>) {</span>
<span id="cb262-4"><a href="#cb262-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"⚠ Posible sobreajuste - el modelo funciona peor en datos nuevos</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb262-5"><a href="#cb262-5" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb262-6"><a href="#cb262-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"⚠ El modelo puede estar subestimado por validación cruzada</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb262-7"><a href="#cb262-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>⚠ El modelo puede estar subestimado por validación cruzada</code></pre>
</div>
</div>
</section>
<section id="diagnóstico-visual-del-modelo-final" class="level3">
<h3 class="anchored" data-anchor-id="diagnóstico-visual-del-modelo-final">Diagnóstico Visual del Modelo Final</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb264"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb264-1"><a href="#cb264-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráfico de predicciones vs valores reales</span></span>
<span id="cb264-2"><a href="#cb264-2" aria-hidden="true" tabindex="-1"></a>diagnostic_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb264-3"><a href="#cb264-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Real =</span> datos_validacion_final<span class="sc">$</span>medv,</span>
<span id="cb264-4"><a href="#cb264-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Predicho =</span> <span class="fu">as.numeric</span>(predicciones_finales),</span>
<span id="cb264-5"><a href="#cb264-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Residuo =</span> datos_validacion_final<span class="sc">$</span>medv <span class="sc">-</span> <span class="fu">as.numeric</span>(predicciones_finales)</span>
<span id="cb264-6"><a href="#cb264-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb264-7"><a href="#cb264-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-8"><a href="#cb264-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráfico de predicciones vs reales</span></span>
<span id="cb264-9"><a href="#cb264-9" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(diagnostic_data, <span class="fu">aes</span>(<span class="at">x =</span> Real, <span class="at">y =</span> Predicho)) <span class="sc">+</span></span>
<span id="cb264-10"><a href="#cb264-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb264-11"><a href="#cb264-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb264-12"><a href="#cb264-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Predicciones vs Valores Reales"</span>,</span>
<span id="cb264-13"><a href="#cb264-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">"Modelo:"</span>, mejor_modelo_nombre),</span>
<span id="cb264-14"><a href="#cb264-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Valores Reales"</span>, <span class="at">y =</span> <span class="st">"Predicciones"</span>) <span class="sc">+</span></span>
<span id="cb264-15"><a href="#cb264-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb264-16"><a href="#cb264-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-17"><a href="#cb264-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráfico de residuos</span></span>
<span id="cb264-18"><a href="#cb264-18" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(diagnostic_data, <span class="fu">aes</span>(<span class="at">x =</span> Predicho, <span class="at">y =</span> Residuo)) <span class="sc">+</span></span>
<span id="cb264-19"><a href="#cb264-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb264-20"><a href="#cb264-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb264-21"><a href="#cb264-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"orange"</span>) <span class="sc">+</span></span>
<span id="cb264-22"><a href="#cb264-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Residuos vs Predicciones"</span>,</span>
<span id="cb264-23"><a href="#cb264-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Predicciones"</span>, <span class="at">y =</span> <span class="st">"Residuos"</span>) <span class="sc">+</span></span>
<span id="cb264-24"><a href="#cb264-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb264-25"><a href="#cb264-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-26"><a href="#cb264-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Histograma de residuos</span></span>
<span id="cb264-27"><a href="#cb264-27" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(diagnostic_data, <span class="fu">aes</span>(<span class="at">x =</span> Residuo)) <span class="sc">+</span></span>
<span id="cb264-28"><a href="#cb264-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">20</span>, <span class="at">fill =</span> <span class="st">"lightblue"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb264-29"><a href="#cb264-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribución de Residuos"</span>,</span>
<span id="cb264-30"><a href="#cb264-30" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Residuos"</span>, <span class="at">y =</span> <span class="st">"Frecuencia"</span>) <span class="sc">+</span></span>
<span id="cb264-31"><a href="#cb264-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb264-32"><a href="#cb264-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-33"><a href="#cb264-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Q-Q plot de residuos</span></span>
<span id="cb264-34"><a href="#cb264-34" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(diagnostic_data, <span class="fu">aes</span>(<span class="at">sample =</span> Residuo)) <span class="sc">+</span></span>
<span id="cb264-35"><a href="#cb264-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_qq</span>() <span class="sc">+</span></span>
<span id="cb264-36"><a href="#cb264-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_qq_line</span>(<span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb264-37"><a href="#cb264-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Q-Q Plot de Residuos"</span>,</span>
<span id="cb264-38"><a href="#cb264-38" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Cuantiles Teóricos"</span>, <span class="at">y =</span> <span class="st">"Cuantiles de Residuos"</span>) <span class="sc">+</span></span>
<span id="cb264-39"><a href="#cb264-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb264-40"><a href="#cb264-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-41"><a href="#cb264-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Mostrar todos los gráficos</span></span>
<span id="cb264-42"><a href="#cb264-42" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p1, p2, p3, p4, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lab4_seleccion_variables_files/figure-html/final_diagnostics-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="parte-8-ejercicios-prácticos" class="level2">
<h2 class="anchored" data-anchor-id="parte-8-ejercicios-prácticos">Parte 8: Ejercicios Prácticos</h2>
<section id="ejercicio-1-dataset-mtcars" class="level3">
<h3 class="anchored" data-anchor-id="ejercicio-1-dataset-mtcars">Ejercicio 1: Dataset mtcars</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb265"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb265-1"><a href="#cb265-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Aplicar todo el pipeline a mtcars</span></span>
<span id="cb265-2"><a href="#cb265-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(mtcars)</span>
<span id="cb265-3"><a href="#cb265-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-4"><a href="#cb265-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== EJERCICIO 1: DATASET MTCARS ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== EJERCICIO 1: DATASET MTCARS ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb267"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb267-1"><a href="#cb267-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Tu tarea: Aplicar el pipeline completo de selección de variables</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Tu tarea: Aplicar el pipeline completo de selección de variables</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb269"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb269-1"><a href="#cb269-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Variable respuesta: mpg (millas por galón)</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Variable respuesta: mpg (millas por galón)</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb271"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb271-1"><a href="#cb271-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Variables predictoras:"</span>, <span class="fu">ncol</span>(mtcars) <span class="sc">-</span> <span class="dv">1</span>, <span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Variables predictoras: 10 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb273"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb273-1"><a href="#cb273-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Pasos a seguir:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Pasos a seguir:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb275"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb275-1"><a href="#cb275-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"1. Análisis exploratorio y filtrado básico</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>1. Análisis exploratorio y filtrado básico</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb277"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb277-1"><a href="#cb277-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"2. Comparar modelos usando AIC, BIC, Cp</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>2. Comparar modelos usando AIC, BIC, Cp</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb279"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb279-1"><a href="#cb279-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"3. Aplicar best subset selection</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>3. Aplicar best subset selection</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb281"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb281-1"><a href="#cb281-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"4. Probar métodos automáticos (forward, backward, stepwise)</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>4. Probar métodos automáticos (forward, backward, stepwise)</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb283"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb283-1"><a href="#cb283-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"5. Aplicar regularización (Ridge, Lasso, Elastic Net)</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>5. Aplicar regularización (Ridge, Lasso, Elastic Net)</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb285"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb285-1"><a href="#cb285-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"6. Validar el mejor modelo con validación cruzada</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>6. Validar el mejor modelo con validación cruzada</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb287"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb287-1"><a href="#cb287-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"7. Evaluación final en conjunto de prueba</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>7. Evaluación final en conjunto de prueba</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb289"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb289-1"><a href="#cb289-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tu código aquí:</span></span>
<span id="cb289-2"><a href="#cb289-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Ejemplo de inicio:</span></span>
<span id="cb289-3"><a href="#cb289-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mtcars)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   mpg cyl disp  hp drat    wt  qsec vs am gear carb
Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4
Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4
Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1
Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1
Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2
Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb291"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb291-1"><a href="#cb291-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Continúa con el análisis completo...</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="ejercicio-2-dataset-simulado-con-ruido" class="level3">
<h3 class="anchored" data-anchor-id="ejercicio-2-dataset-simulado-con-ruido">Ejercicio 2: Dataset Simulado con Ruido</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb292"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb292-1"><a href="#cb292-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear dataset desafiante para selección de variables</span></span>
<span id="cb292-2"><a href="#cb292-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">456</span>)</span>
<span id="cb292-3"><a href="#cb292-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb292-4"><a href="#cb292-4" aria-hidden="true" tabindex="-1"></a>p_real <span class="ot">&lt;-</span> <span class="dv">5</span>      <span class="co"># Variables verdaderamente importantes</span></span>
<span id="cb292-5"><a href="#cb292-5" aria-hidden="true" tabindex="-1"></a>p_ruido <span class="ot">&lt;-</span> <span class="dv">15</span>    <span class="co"># Variables de ruido</span></span>
<span id="cb292-6"><a href="#cb292-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb292-7"><a href="#cb292-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Variables importantes</span></span>
<span id="cb292-8"><a href="#cb292-8" aria-hidden="true" tabindex="-1"></a>X_real <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rnorm</span>(n <span class="sc">*</span> p_real), n, p_real)</span>
<span id="cb292-9"><a href="#cb292-9" aria-hidden="true" tabindex="-1"></a>beta_real <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">2.5</span>, <span class="sc">-</span><span class="fl">1.8</span>, <span class="fl">3.2</span>, <span class="sc">-</span><span class="fl">2.1</span>, <span class="fl">1.7</span>)</span>
<span id="cb292-10"><a href="#cb292-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb292-11"><a href="#cb292-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Variables de ruido</span></span>
<span id="cb292-12"><a href="#cb292-12" aria-hidden="true" tabindex="-1"></a>X_ruido <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rnorm</span>(n <span class="sc">*</span> p_ruido), n, p_ruido)</span>
<span id="cb292-13"><a href="#cb292-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb292-14"><a href="#cb292-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear algunas correlaciones entre variables de ruido para mayor desafío</span></span>
<span id="cb292-15"><a href="#cb292-15" aria-hidden="true" tabindex="-1"></a>X_ruido[, <span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fl">0.7</span> <span class="sc">*</span> X_ruido[, <span class="dv">1</span>] <span class="sc">+</span> <span class="fl">0.3</span> <span class="sc">*</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb292-16"><a href="#cb292-16" aria-hidden="true" tabindex="-1"></a>X_ruido[, <span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="fl">0.6</span> <span class="sc">*</span> X_ruido[, <span class="dv">1</span>] <span class="sc">+</span> <span class="fl">0.4</span> <span class="sc">*</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb292-17"><a href="#cb292-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb292-18"><a href="#cb292-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Combinar variables</span></span>
<span id="cb292-19"><a href="#cb292-19" aria-hidden="true" tabindex="-1"></a>X_total <span class="ot">&lt;-</span> <span class="fu">cbind</span>(X_real, X_ruido)</span>
<span id="cb292-20"><a href="#cb292-20" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(X_total) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">paste0</span>(<span class="st">"Important_"</span>, <span class="dv">1</span><span class="sc">:</span>p_real), <span class="fu">paste0</span>(<span class="st">"Noise_"</span>, <span class="dv">1</span><span class="sc">:</span>p_ruido))</span>
<span id="cb292-21"><a href="#cb292-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb292-22"><a href="#cb292-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Variable respuesta</span></span>
<span id="cb292-23"><a href="#cb292-23" aria-hidden="true" tabindex="-1"></a>y_sim <span class="ot">&lt;-</span> X_real <span class="sc">%*%</span> beta_real <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="at">sd =</span> <span class="fl">1.5</span>)</span>
<span id="cb292-24"><a href="#cb292-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb292-25"><a href="#cb292-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Dataset final</span></span>
<span id="cb292-26"><a href="#cb292-26" aria-hidden="true" tabindex="-1"></a>datos_simulados <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">y =</span> y_sim, X_total)</span>
<span id="cb292-27"><a href="#cb292-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb292-28"><a href="#cb292-28" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== EJERCICIO 2: DATASET SIMULADO ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== EJERCICIO 2: DATASET SIMULADO ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb294"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb294-1"><a href="#cb294-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Observaciones:"</span>, <span class="fu">nrow</span>(datos_simulados), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Observaciones: 200 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb296"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb296-1"><a href="#cb296-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Variables predictoras:"</span>, <span class="fu">ncol</span>(datos_simulados) <span class="sc">-</span> <span class="dv">1</span>, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Variables predictoras: 20 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb298"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb298-1"><a href="#cb298-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Variables verdaderamente importantes:"</span>, p_real, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Variables verdaderamente importantes: 5 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb300"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb300-1"><a href="#cb300-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Variables de ruido:"</span>, p_ruido, <span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Variables de ruido: 15 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb302"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb302-1"><a href="#cb302-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Desafío:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Desafío:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb304"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb304-1"><a href="#cb304-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"¿Pueden los métodos de selección identificar correctamente</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>¿Pueden los métodos de selección identificar correctamente</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb306"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb306-1"><a href="#cb306-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"las 5 variables importantes y descartar las 15 de ruido?</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>las 5 variables importantes y descartar las 15 de ruido?</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb308"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb308-1"><a href="#cb308-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tu código aquí:</span></span>
<span id="cb308-2"><a href="#cb308-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Aplica todos los métodos y compara los resultados</span></span>
<span id="cb308-3"><a href="#cb308-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ¿Qué método identifica mejor las variables verdaderas?</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="ejercicio-3-comparación-sistemática" class="level3">
<h3 class="anchored" data-anchor-id="ejercicio-3-comparación-sistemática">Ejercicio 3: Comparación Sistemática</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb309"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb309-1"><a href="#cb309-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Función para evaluar todos los métodos en un dataset</span></span>
<span id="cb309-2"><a href="#cb309-2" aria-hidden="true" tabindex="-1"></a>evaluar_metodos_seleccion <span class="ot">&lt;-</span> <span class="cf">function</span>(datos, var_respuesta) {</span>
<span id="cb309-3"><a href="#cb309-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Esta función debería implementar todo el pipeline</span></span>
<span id="cb309-4"><a href="#cb309-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># y retornar una tabla de comparación</span></span>
<span id="cb309-5"><a href="#cb309-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb309-6"><a href="#cb309-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"=== EJERCICIO 3: FUNCIÓN DE EVALUACIÓN ===</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb309-7"><a href="#cb309-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Implementa una función que:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb309-8"><a href="#cb309-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"1. Reciba un dataset y nombre de variable respuesta</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb309-9"><a href="#cb309-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"2. Aplique todos los métodos de selección</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb309-10"><a href="#cb309-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"3. Compare los resultados usando validación cruzada</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb309-11"><a href="#cb309-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"4. Retorne un resumen con las mejores opciones</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb309-12"><a href="#cb309-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb309-13"><a href="#cb309-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Tu implementación aquí...</span></span>
<span id="cb309-14"><a href="#cb309-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb309-15"><a href="#cb309-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb309-16"><a href="#cb309-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb309-17"><a href="#cb309-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb309-18"><a href="#cb309-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Prueba la función con diferentes datasets</span></span>
<span id="cb309-19"><a href="#cb309-19" aria-hidden="true" tabindex="-1"></a><span class="co"># evaluar_metodos_seleccion(Boston, "medv")</span></span>
<span id="cb309-20"><a href="#cb309-20" aria-hidden="true" tabindex="-1"></a><span class="co"># evaluar_metodos_seleccion(mtcars, "mpg")</span></span>
<span id="cb309-21"><a href="#cb309-21" aria-hidden="true" tabindex="-1"></a><span class="co"># evaluar_metodos_seleccion(datos_simulados, "y")</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section id="parte-9-conceptos-clave-para-recordar" class="level2">
<h2 class="anchored" data-anchor-id="parte-9-conceptos-clave-para-recordar">Parte 9: Conceptos Clave para Recordar</h2>
<section id="resumen-de-métodos" class="level3">
<h3 class="anchored" data-anchor-id="resumen-de-métodos">Resumen de Métodos</h3>
<div class="callout callout-style-default callout-important callout-titled" title="Guía de Decisión para Selección de Variables">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>Guía de Decisión para Selección de Variables
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>¿Cuándo usar cada método?</strong></p>
<p><strong>Filtrado Básico:</strong></p>
<ul>
<li>Siempre como primer paso</li>
<li>Elimina variables obvialmente problemáticas</li>
<li>Reduce dimensionalidad para métodos posteriores</li>
</ul>
<p><strong>Best Subset Selection:</strong></p>
<ul>
<li>Cuando p &lt; 15-20 variables</li>
<li>Se requiere la solución óptima garantizada</li>
<li>Recursos computacionales suficientes</li>
</ul>
<p><strong>Métodos Automáticos (Forward/Backward/Stepwise):</strong></p>
<ul>
<li>Cuando p es moderado a grande (p &gt; 20)</li>
<li>Exploración rápida del espacio de modelos</li>
<li>Como punto de partida para otros métodos</li>
</ul>
<p><strong>Regularización:</strong></p>
<ul>
<li><strong>Ridge:</strong> Todas las variables son potencialmente relevantes, hay multicolinealidad</li>
<li><strong>Lasso:</strong> Se sospecha que muchas variables son irrelevantes</li>
<li><strong>Elastic Net:</strong> Hay grupos de variables correlacionadas, se busca estabilidad</li>
</ul>
<p><strong>Criterios de Información:</strong></p>
<ul>
<li><strong>AIC:</strong> Objetivo predictivo</li>
<li><strong>BIC:</strong> Objetivo de identificar el “modelo verdadero”</li>
<li><strong>Cp de Mallows:</strong> Análisis del sesgo-varianza</li>
</ul>
</div>
</div>
</section>
<section id="métricas-de-validación" class="level3">
<h3 class="anchored" data-anchor-id="métricas-de-validación">Métricas de Validación</h3>
<div class="callout callout-style-default callout-note callout-titled" title="Interpretación de Métricas">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Interpretación de Métricas
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>RMSE (Root Mean Square Error):</strong></p>
<ul>
<li>Unidades de la variable respuesta</li>
<li>Penaliza errores grandes desproporcionadamente</li>
<li>Sensible a outliers</li>
</ul>
<p><strong>MAE (Mean Absolute Error):</strong></p>
<ul>
<li>Unidades de la variable respuesta</li>
<li>Trata todos los errores proporcionalmente</li>
<li>Más robusto a outliers</li>
</ul>
<p><strong>R² de Validación Cruzada:</strong></p>
<ul>
<li>Proporción de varianza explicada en datos no vistos</li>
<li>Mejor indicador que R² de entrenamiento</li>
<li>Valores similares entre CV y test indican buena generalización</li>
</ul>
</div>
</div>
</section>
<section id="señales-de-alerta" class="level3">
<h3 class="anchored" data-anchor-id="señales-de-alerta">Señales de Alerta</h3>
<div class="callout callout-style-default callout-warning callout-titled" title="Problemas Comunes">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Warning</span>Problemas Comunes
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Sobreajuste:</strong></p>
<ul>
<li>Error de entrenamiento &lt;&lt; Error de validación</li>
<li>Modelo muy complejo para el tamaño de muestra</li>
<li>R² muy alto pero RMSE de validación alto</li>
</ul>
<p><strong>Subajuste:</strong></p>
<ul>
<li>Error de entrenamiento ≈ Error de validación (ambos altos)</li>
<li>Modelo demasiado simple</li>
<li>Patrones no capturados en los residuos</li>
</ul>
<p><strong>Selección Inestable:</strong></p>
<ul>
<li>Métodos diferentes seleccionan variables muy distintas</li>
<li>Resultados cambian mucho con pequeñas variaciones en datos</li>
<li>Indica posible sobreajuste o datos insuficientes</li>
</ul>
</div>
</div>
</section>
<section id="mejores-prácticas" class="level3">
<h3 class="anchored" data-anchor-id="mejores-prácticas">Mejores Prácticas</h3>
<ol type="1">
<li><strong>Siempre partir datos antes de cualquier análisis</strong></li>
<li><strong>Usar validación cruzada para selección, conjunto independiente para evaluación final</strong></li>
<li><strong>Comparar múltiples métodos y buscar consenso</strong></li>
<li><strong>Validar supuestos del modelo final</strong></li>
<li><strong>Considerar interpretabilidad vs precisión predictiva</strong></li>
<li><strong>Documentar todo el proceso de selección</strong></li>
</ol>
</section>
</section>
<section id="próximo-laboratorio" class="level2">
<h2 class="anchored" data-anchor-id="próximo-laboratorio">Próximo Laboratorio</h2>
<p>En el Laboratorio 5 exploraremos modelos lineales generalizados (GLM), incluyendo regresión logística y regresión de Poisson, ampliando nuestras herramientas para variables respuesta no continuas.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>