<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.21">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Víctor Aceña Gil - Isaac Martín de Diego">
<meta name="dcterms.date" content="2025-09-03">

<title>Laboratorio 5: Modelos Lineales Generalizados</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="lab5_modelos_generalizados_files/libs/clipboard/clipboard.min.js"></script>
<script src="lab5_modelos_generalizados_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="lab5_modelos_generalizados_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="lab5_modelos_generalizados_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="lab5_modelos_generalizados_files/libs/quarto-html/popper.min.js"></script>
<script src="lab5_modelos_generalizados_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="lab5_modelos_generalizados_files/libs/quarto-html/anchor.min.js"></script>
<link href="lab5_modelos_generalizados_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="lab5_modelos_generalizados_files/libs/quarto-html/quarto-syntax-highlighting-ea1d7ac60288e0f1efdbc993fd8432ae.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="lab5_modelos_generalizados_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="lab5_modelos_generalizados_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="lab5_modelos_generalizados_files/libs/bootstrap/bootstrap-4d7f0bce1131f3e5f9547cd857cfbfc8.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#objetivos-del-laboratorio" id="toc-objetivos-del-laboratorio" class="nav-link active" data-scroll-target="#objetivos-del-laboratorio">Objetivos del Laboratorio</a></li>
  <li><a href="#configuración-inicial" id="toc-configuración-inicial" class="nav-link" data-scroll-target="#configuración-inicial">Configuración Inicial</a></li>
  <li><a href="#parte-1-introducción-a-los-glms" id="toc-parte-1-introducción-a-los-glms" class="nav-link" data-scroll-target="#parte-1-introducción-a-los-glms">Parte 1: Introducción a los GLMs</a>
  <ul class="collapse">
  <li><a href="#conceptos-fundamentales" id="toc-conceptos-fundamentales" class="nav-link" data-scroll-target="#conceptos-fundamentales">Conceptos Fundamentales</a></li>
  <li><a href="#comparación-con-regresión-lineal" id="toc-comparación-con-regresión-lineal" class="nav-link" data-scroll-target="#comparación-con-regresión-lineal">Comparación con Regresión Lineal</a></li>
  </ul></li>
  <li><a href="#parte-2-regresión-logística" id="toc-parte-2-regresión-logística" class="nav-link" data-scroll-target="#parte-2-regresión-logística">Parte 2: Regresión Logística</a>
  <ul class="collapse">
  <li><a href="#dataset-de-trabajo" id="toc-dataset-de-trabajo" class="nav-link" data-scroll-target="#dataset-de-trabajo">Dataset de Trabajo</a></li>
  <li><a href="#ajuste-del-modelo-logístico" id="toc-ajuste-del-modelo-logístico" class="nav-link" data-scroll-target="#ajuste-del-modelo-logístico">Ajuste del Modelo Logístico</a></li>
  <li><a href="#selección-de-variables" id="toc-selección-de-variables" class="nav-link" data-scroll-target="#selección-de-variables">Selección de Variables</a></li>
  <li><a href="#bondad-de-ajuste" id="toc-bondad-de-ajuste" class="nav-link" data-scroll-target="#bondad-de-ajuste">Bondad de Ajuste</a></li>
  <li><a href="#diagnósticos-del-modelo" id="toc-diagnósticos-del-modelo" class="nav-link" data-scroll-target="#diagnósticos-del-modelo">Diagnósticos del Modelo</a></li>
  <li><a href="#validación-y-predicción" id="toc-validación-y-predicción" class="nav-link" data-scroll-target="#validación-y-predicción">Validación y Predicción</a></li>
  </ul></li>
  <li><a href="#parte-3-regresión-de-poisson" id="toc-parte-3-regresión-de-poisson" class="nav-link" data-scroll-target="#parte-3-regresión-de-poisson">Parte 3: Regresión de Poisson</a>
  <ul class="collapse">
  <li><a href="#simulación-de-datos-de-conteo" id="toc-simulación-de-datos-de-conteo" class="nav-link" data-scroll-target="#simulación-de-datos-de-conteo">Simulación de Datos de Conteo</a></li>
  <li><a href="#ajuste-del-modelo-de-poisson" id="toc-ajuste-del-modelo-de-poisson" class="nav-link" data-scroll-target="#ajuste-del-modelo-de-poisson">Ajuste del Modelo de Poisson</a></li>
  <li><a href="#diagnóstico-del-modelo-de-poisson" id="toc-diagnóstico-del-modelo-de-poisson" class="nav-link" data-scroll-target="#diagnóstico-del-modelo-de-poisson">Diagnóstico del Modelo de Poisson</a></li>
  <li><a href="#modelo-binomial-negativo" id="toc-modelo-binomial-negativo" class="nav-link" data-scroll-target="#modelo-binomial-negativo">Modelo Binomial Negativo</a></li>
  <li><a href="#validación-del-modelo-de-conteo" id="toc-validación-del-modelo-de-conteo" class="nav-link" data-scroll-target="#validación-del-modelo-de-conteo">Validación del Modelo de Conteo</a></li>
  </ul></li>
  <li><a href="#parte-4-otros-glms" id="toc-parte-4-otros-glms" class="nav-link" data-scroll-target="#parte-4-otros-glms">Parte 4: Otros GLMs</a>
  <ul class="collapse">
  <li><a href="#regresión-gamma" id="toc-regresión-gamma" class="nav-link" data-scroll-target="#regresión-gamma">Regresión Gamma</a></li>
  <li><a href="#comparación-de-familias-de-distribución" id="toc-comparación-de-familias-de-distribución" class="nav-link" data-scroll-target="#comparación-de-familias-de-distribución">Comparación de Familias de Distribución</a></li>
  </ul></li>
  <li><a href="#parte-5-ejercicios-prácticos" id="toc-parte-5-ejercicios-prácticos" class="nav-link" data-scroll-target="#parte-5-ejercicios-prácticos">Parte 5: Ejercicios Prácticos</a>
  <ul class="collapse">
  <li><a href="#ejercicio-1-análisis-completo-de-regresión-logística" id="toc-ejercicio-1-análisis-completo-de-regresión-logística" class="nav-link" data-scroll-target="#ejercicio-1-análisis-completo-de-regresión-logística">Ejercicio 1: Análisis Completo de Regresión Logística</a></li>
  <li><a href="#ejercicio-2-análisis-de-datos-de-conteo" id="toc-ejercicio-2-análisis-de-datos-de-conteo" class="nav-link" data-scroll-target="#ejercicio-2-análisis-de-datos-de-conteo">Ejercicio 2: Análisis de Datos de Conteo</a></li>
  <li><a href="#ejercicio-3-selección-de-modelo-glm" id="toc-ejercicio-3-selección-de-modelo-glm" class="nav-link" data-scroll-target="#ejercicio-3-selección-de-modelo-glm">Ejercicio 3: Selección de Modelo GLM</a></li>
  </ul></li>
  <li><a href="#parte-6-conceptos-clave-para-recordar" id="toc-parte-6-conceptos-clave-para-recordar" class="nav-link" data-scroll-target="#parte-6-conceptos-clave-para-recordar">Parte 6: Conceptos Clave para Recordar</a>
  <ul class="collapse">
  <li><a href="#guía-de-decisión-para-glms" id="toc-guía-de-decisión-para-glms" class="nav-link" data-scroll-target="#guía-de-decisión-para-glms">Guía de Decisión para GLMs</a></li>
  <li><a href="#diagnósticos-específicos-para-glms" id="toc-diagnósticos-específicos-para-glms" class="nav-link" data-scroll-target="#diagnósticos-específicos-para-glms">Diagnósticos Específicos para GLMs</a></li>
  <li><a href="#interpretación-de-coeficientes" id="toc-interpretación-de-coeficientes" class="nav-link" data-scroll-target="#interpretación-de-coeficientes">Interpretación de Coeficientes</a></li>
  <li><a href="#validación-por-tipo-de-modelo" id="toc-validación-por-tipo-de-modelo" class="nav-link" data-scroll-target="#validación-por-tipo-de-modelo">Validación por Tipo de Modelo</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Laboratorio 5: Modelos Lineales Generalizados</h1>
<p class="subtitle lead">Modelos Estadísticos de Predicción</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Víctor Aceña Gil - Isaac Martín de Diego </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 3, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="objetivos-del-laboratorio" class="level2">
<h2 class="anchored" data-anchor-id="objetivos-del-laboratorio">Objetivos del Laboratorio</h2>
<p>Al finalizar este laboratorio, serás capaz de:</p>
<ul>
<li>Entender los fundamentos de los Modelos Lineales Generalizados (GLM)</li>
<li>Ajustar e interpretar modelos de regresión logística</li>
<li>Implementar regresión de Poisson para datos de conteo</li>
<li>Aplicar regresión binomial negativa para datos con sobredispersión</li>
<li>Evaluar la bondad de ajuste usando deviance y criterios de información</li>
<li>Realizar diagnósticos específicos para GLMs</li>
<li>Validar modelos usando métricas apropiadas para cada tipo de respuesta</li>
</ul>
</section>
<section id="configuración-inicial" class="level2">
<h2 class="anchored" data-anchor-id="configuración-inicial">Configuración Inicial</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cargar librerías necesarias</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressPackageStartupMessages</span>({</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(tidyverse)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(MASS)         <span class="co"># Para datasets y binomial negativa</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(car)          <span class="co"># Para diagnósticos</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(broom)        <span class="co"># Para resultados ordenados</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(pROC)         <span class="co"># Para curvas ROC</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(caret)        <span class="co"># Para matrices de confusión</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(corrplot)     <span class="co"># Para visualizaciones</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(gridExtra)    <span class="co"># Para múltiples gráficos</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(performance)  <span class="co"># Para diagnósticos de modelos</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(see)          <span class="co"># Para visualizaciones de performance</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="parte-1-introducción-a-los-glms" class="level2">
<h2 class="anchored" data-anchor-id="parte-1-introducción-a-los-glms">Parte 1: Introducción a los GLMs</h2>
<section id="conceptos-fundamentales" class="level3">
<h3 class="anchored" data-anchor-id="conceptos-fundamentales">Conceptos Fundamentales</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== COMPONENTES DE UN MODELO LINEAL GENERALIZADO ===</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== COMPONENTES DE UN MODELO LINEAL GENERALIZADO ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"1. COMPONENTE ALEATORIO:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>1. COMPONENTE ALEATORIO:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"   - Define la distribución de la variable respuesta</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   - Define la distribución de la variable respuesta</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"   - Debe pertenecer a la familia exponencial</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   - Debe pertenecer a la familia exponencial</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"   - Ejemplos: Normal, Binomial, Poisson, Gamma</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   - Ejemplos: Normal, Binomial, Poisson, Gamma</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"2. COMPONENTE SISTEMÁTICO:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>2. COMPONENTE SISTEMÁTICO:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"   - Combinación lineal de predictores: η = β₀ + β₁X₁ + ... + βₚXₚ</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   - Combinación lineal de predictores: η = β₀ + β₁X₁ + ... + βₚXₚ</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"   - η es el predictor lineal</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   - η es el predictor lineal</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"3. FUNCIÓN DE ENLACE:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>3. FUNCIÓN DE ENLACE:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"   - Conecta la media de Y con el predictor lineal: g(μ) = η</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   - Conecta la media de Y con el predictor lineal: g(μ) = η</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"   - Debe ser monótona y diferenciable</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   - Debe ser monótona y diferenciable</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tabla de distribuciones comunes y sus enlaces</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>distribuciones_glm <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Distribucion =</span> <span class="fu">c</span>(<span class="st">"Normal"</span>, <span class="st">"Binomial"</span>, <span class="st">"Poisson"</span>, <span class="st">"Gamma"</span>, <span class="st">"Inversa Gaussiana"</span>),</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Uso_Tipico =</span> <span class="fu">c</span>(<span class="st">"Variables continuas"</span>, <span class="st">"Proporciones/Binarias"</span>, <span class="st">"Conteos"</span>, </span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"Variables positivas sesgadas"</span>, <span class="st">"Tiempos hasta evento"</span>),</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Funcion_Varianza =</span> <span class="fu">c</span>(<span class="st">"1"</span>, <span class="st">"μ(1-μ)"</span>, <span class="st">"μ"</span>, <span class="st">"μ²"</span>, <span class="st">"μ³"</span>),</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">Enlace_Canonico =</span> <span class="fu">c</span>(<span class="st">"Identidad: μ"</span>, <span class="st">"Logit: log(μ/(1-μ))"</span>, <span class="st">"Log: log(μ)"</span>, </span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"Inverso: 1/μ"</span>, <span class="st">"Inverso cuadrado: 1/μ²"</span>),</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">Enlace_Comun =</span> <span class="fu">c</span>(<span class="st">"Identidad"</span>, <span class="st">"Logit"</span>, <span class="st">"Log"</span>, <span class="st">"Log"</span>, <span class="st">"Log"</span>)</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(distribuciones_glm)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>       Distribucion                   Uso_Tipico Funcion_Varianza
1            Normal          Variables continuas                1
2          Binomial        Proporciones/Binarias           μ(1-μ)
3           Poisson                      Conteos                μ
4             Gamma Variables positivas sesgadas               μ²
5 Inversa Gaussiana         Tiempos hasta evento               μ³
         Enlace_Canonico Enlace_Comun
1           Identidad: μ    Identidad
2    Logit: log(μ/(1-μ))        Logit
3            Log: log(μ)          Log
4           Inverso: 1/μ          Log
5 Inverso cuadrado: 1/μ²          Log</code></pre>
</div>
</div>
</section>
<section id="comparación-con-regresión-lineal" class="level3">
<h3 class="anchored" data-anchor-id="comparación-con-regresión-lineal">Comparación con Regresión Lineal</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generar datos para mostrar limitaciones de regresión lineal con respuesta binaria</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">3</span>, <span class="at">length.out =</span> n)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Generar probabilidades usando función logística</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>prob_real <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="dv">2</span> <span class="sc">-</span> <span class="fl">1.5</span><span class="sc">*</span>x))</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>y_binario <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, prob_real)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>datos_ejemplo <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> x, <span class="at">y =</span> y_binario, <span class="at">prob_real =</span> prob_real)</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Ajustar modelo lineal (incorrecto)</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>modelo_lineal <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> datos_ejemplo)</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Ajustar modelo logístico (correcto)</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>modelo_logistico <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> datos_ejemplo, <span class="at">family =</span> binomial)</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicciones</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>datos_ejemplo<span class="sc">$</span>pred_lineal <span class="ot">&lt;-</span> <span class="fu">predict</span>(modelo_lineal)</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>datos_ejemplo<span class="sc">$</span>pred_logistico <span class="ot">&lt;-</span> <span class="fu">predict</span>(modelo_logistico, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualización</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(datos_ejemplo, <span class="fu">aes</span>(<span class="at">x =</span> x)) <span class="sc">+</span></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> y), <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> prob_real), <span class="at">color =</span> <span class="st">"green"</span>, <span class="at">size =</span> <span class="fl">1.2</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> pred_lineal), <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> pred_logistico), <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Comparación: Regresión Lineal vs Logística"</span>,</span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Verde: Probabilidad real, Rojo: Modelo lineal, Azul: Modelo logístico"</span>,</span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Variable Predictora"</span>, <span class="at">y =</span> <span class="st">"Probabilidad / Respuesta"</span>) <span class="sc">+</span></span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lab5_modelos_generalizados_files/figure-html/glm_vs_linear-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== PROBLEMAS DE LA REGRESIÓN LINEAL PARA RESPUESTA BINARIA ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== PROBLEMAS DE LA REGRESIÓN LINEAL PARA RESPUESTA BINARIA ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"1. Predicciones fuera del rango [0,1]</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>1. Predicciones fuera del rango [0,1]</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"2. Varianza no constante (heterocedasticidad)</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>2. Varianza no constante (heterocedasticidad)</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"3. Residuos no normales</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>3. Residuos no normales</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"4. Relación no lineal entre predictores y probabilidad</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>4. Relación no lineal entre predictores y probabilidad</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mostrar predicciones problemáticas del modelo lineal</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>pred_problematicas <span class="ot">&lt;-</span> <span class="fu">sum</span>(datos_ejemplo<span class="sc">$</span>pred_lineal <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">|</span> datos_ejemplo<span class="sc">$</span>pred_lineal <span class="sc">&gt;</span> <span class="dv">1</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Predicciones fuera de [0,1] en modelo lineal:"</span>, pred_problematicas, <span class="st">"de"</span>, n, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Predicciones fuera de [0,1] en modelo lineal: 38 de 200 </code></pre>
</div>
</div>
</section>
</section>
<section id="parte-2-regresión-logística" class="level2">
<h2 class="anchored" data-anchor-id="parte-2-regresión-logística">Parte 2: Regresión Logística</h2>
<section id="dataset-de-trabajo" class="level3">
<h3 class="anchored" data-anchor-id="dataset-de-trabajo">Dataset de Trabajo</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Usar el dataset Pima Indians Diabetes</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Pima.tr)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Pima.te)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Combinar datasets para mayor tamaño de muestra</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>pima_completo <span class="ot">&lt;-</span> <span class="fu">rbind</span>(Pima.tr, Pima.te)</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Información del dataset</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== DATASET PIMA INDIANS DIABETES ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== DATASET PIMA INDIANS DIABETES ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Observaciones:"</span>, <span class="fu">nrow</span>(pima_completo), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Observaciones: 532 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Variables:"</span>, <span class="fu">ncol</span>(pima_completo), <span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Variables: 8 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Descripción de variables</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Variables:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Variables:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"type: Diabetes (Yes/No) - Variable respuesta</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>type: Diabetes (Yes/No) - Variable respuesta</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"npreg: Número de embarazos</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>npreg: Número de embarazos</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"glu: Concentración de glucosa en plasma</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>glu: Concentración de glucosa en plasma</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"bp: Presión arterial diastólica</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>bp: Presión arterial diastólica</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"skin: Grosor del pliegue cutáneo del tríceps</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>skin: Grosor del pliegue cutáneo del tríceps</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"bmi: Índice de masa corporal</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>bmi: Índice de masa corporal</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"ped: Función de pedigrí de diabetes</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>ped: Función de pedigrí de diabetes</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"age: Edad</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>age: Edad</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Resumen estadístico</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pima_completo)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>     npreg             glu               bp              skin      
 Min.   : 0.000   Min.   : 56.00   Min.   : 24.00   Min.   : 7.00  
 1st Qu.: 1.000   1st Qu.: 98.75   1st Qu.: 64.00   1st Qu.:22.00  
 Median : 2.000   Median :115.00   Median : 72.00   Median :29.00  
 Mean   : 3.517   Mean   :121.03   Mean   : 71.51   Mean   :29.18  
 3rd Qu.: 5.000   3rd Qu.:141.25   3rd Qu.: 80.00   3rd Qu.:36.00  
 Max.   :17.000   Max.   :199.00   Max.   :110.00   Max.   :99.00  
      bmi             ped              age         type    
 Min.   :18.20   Min.   :0.0850   Min.   :21.00   No :355  
 1st Qu.:27.88   1st Qu.:0.2587   1st Qu.:23.00   Yes:177  
 Median :32.80   Median :0.4160   Median :28.00            
 Mean   :32.89   Mean   :0.5030   Mean   :31.61            
 3rd Qu.:36.90   3rd Qu.:0.6585   3rd Qu.:38.00            
 Max.   :67.10   Max.   :2.4200   Max.   :81.00            </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Distribución de la variable respuesta</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(pima_completo<span class="sc">$</span>type)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 No Yes 
355 177 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(pima_completo<span class="sc">$</span>type))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
       No       Yes 
0.6672932 0.3327068 </code></pre>
</div>
</div>
</section>
<section id="ajuste-del-modelo-logístico" class="level3">
<h3 class="anchored" data-anchor-id="ajuste-del-modelo-logístico">Ajuste del Modelo Logístico</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Dividir datos en entrenamiento y prueba</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>indices_train <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(pima_completo<span class="sc">$</span>type, <span class="at">p =</span> <span class="fl">0.7</span>, <span class="at">list =</span> <span class="cn">FALSE</span>)</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>datos_train <span class="ot">&lt;-</span> pima_completo[indices_train, ]</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>datos_test <span class="ot">&lt;-</span> pima_completo[<span class="sc">-</span>indices_train, ]</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== DIVISIÓN DE DATOS ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== DIVISIÓN DE DATOS ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Entrenamiento:"</span>, <span class="fu">nrow</span>(datos_train), <span class="st">"observaciones</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Entrenamiento: 373 observaciones</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Prueba:"</span>, <span class="fu">nrow</span>(datos_test), <span class="st">"observaciones</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Prueba: 159 observaciones</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ajustar modelo logístico completo</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>modelo_logit_completo <span class="ot">&lt;-</span> <span class="fu">glm</span>(type <span class="sc">~</span> ., <span class="at">data =</span> datos_train, <span class="at">family =</span> binomial)</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Resumen del modelo</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modelo_logit_completo)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = type ~ ., family = binomial, data = datos_train)

Coefficients:
             Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -9.689185   1.199830  -8.075 6.72e-16 ***
npreg        0.124403   0.050839   2.447  0.01441 *  
glu          0.034387   0.005088   6.758 1.40e-11 ***
bp          -0.004979   0.012363  -0.403  0.68714    
skin         0.012013   0.017157   0.700  0.48383    
bmi          0.087642   0.029762   2.945  0.00323 ** 
ped          1.010223   0.437825   2.307  0.02103 *  
age          0.023155   0.015416   1.502  0.13310    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 474.38  on 372  degrees of freedom
Residual deviance: 329.30  on 365  degrees of freedom
AIC: 345.3

Number of Fisher Scoring iterations: 5</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Interpretación de coeficientes mediante odds ratios</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>odds_ratios <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">coef</span>(modelo_logit_completo))</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>conf_intervals <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">confint</span>(modelo_logit_completo))</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== ODDS RATIOS E INTERVALOS DE CONFIANZA ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== ODDS RATIOS E INTERVALOS DE CONFIANZA ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>resultados_or <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Variable =</span> <span class="fu">names</span>(odds_ratios),</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">OR =</span> <span class="fu">round</span>(odds_ratios, <span class="dv">3</span>),</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">IC_2.5 =</span> <span class="fu">round</span>(conf_intervals[,<span class="dv">1</span>], <span class="dv">3</span>),</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">IC_97.5 =</span> <span class="fu">round</span>(conf_intervals[,<span class="dv">2</span>], <span class="dv">3</span>)</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(resultados_or)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>               Variable    OR IC_2.5 IC_97.5
(Intercept) (Intercept) 0.000  0.000   0.001
npreg             npreg 1.132  1.027   1.254
glu                 glu 1.035  1.025   1.046
bp                   bp 0.995  0.971   1.020
skin               skin 1.012  0.979   1.047
bmi                 bmi 1.092  1.031   1.159
ped                 ped 2.746  1.176   6.569
age                 age 1.023  0.993   1.055</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Interpretación práctica</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== INTERPRETACIÓN DE ODDS RATIOS ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== INTERPRETACIÓN DE ODDS RATIOS ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"glu (Glucosa): OR ="</span>, <span class="fu">round</span>(odds_ratios[<span class="st">"glu"</span>], <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>glu (Glucosa): OR = 1.035 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  → Por cada mg/dl adicional de glucosa, las odds de diabetes se multiplican por"</span>, <span class="fu">round</span>(odds_ratios[<span class="st">"glu"</span>], <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  → Por cada mg/dl adicional de glucosa, las odds de diabetes se multiplican por 1.035 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  → Esto representa un cambio de"</span>, <span class="fu">round</span>((odds_ratios[<span class="st">"glu"</span>] <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>), <span class="st">"% en las odds</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  → Esto representa un cambio de 3.5 % en las odds</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"bmi (IMC): OR ="</span>, <span class="fu">round</span>(odds_ratios[<span class="st">"bmi"</span>], <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>bmi (IMC): OR = 1.092 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  → Por cada unidad adicional de IMC, las odds de diabetes se multiplican por"</span>, <span class="fu">round</span>(odds_ratios[<span class="st">"bmi"</span>], <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  → Por cada unidad adicional de IMC, las odds de diabetes se multiplican por 1.092 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  → Esto representa un cambio de"</span>, <span class="fu">round</span>((odds_ratios[<span class="st">"bmi"</span>] <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>), <span class="st">"% en las odds</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  → Esto representa un cambio de 9.2 % en las odds</code></pre>
</div>
</div>
</section>
<section id="selección-de-variables" class="level3">
<h3 class="anchored" data-anchor-id="selección-de-variables">Selección de Variables</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Método stepwise para selección de variables</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>modelo_inicial <span class="ot">&lt;-</span> <span class="fu">glm</span>(type <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> datos_train, <span class="at">family =</span> binomial)</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>modelo_stepwise <span class="ot">&lt;-</span> <span class="fu">step</span>(modelo_inicial, </span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">scope =</span> <span class="fu">list</span>(<span class="at">lower =</span> modelo_inicial, <span class="at">upper =</span> modelo_logit_completo),</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">direction =</span> <span class="st">"both"</span>, <span class="at">trace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== SELECCIÓN STEPWISE ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== SELECCIÓN STEPWISE ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Variables seleccionadas:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Variables seleccionadas:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>formula_final <span class="ot">&lt;-</span> <span class="fu">formula</span>(modelo_stepwise)</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(formula_final)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>type ~ glu + bmi + npreg + ped + age</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Comparar modelos</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== COMPARACIÓN DE MODELOS ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== COMPARACIÓN DE MODELOS ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Modelo completo - AIC:"</span>, <span class="fu">round</span>(<span class="fu">AIC</span>(modelo_logit_completo), <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Modelo completo - AIC: 345.3 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Modelo stepwise - AIC:"</span>, <span class="fu">round</span>(<span class="fu">AIC</span>(modelo_stepwise), <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Modelo stepwise - AIC: 341.96 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test de razón de verosimilitudes</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>lrt_test <span class="ot">&lt;-</span> <span class="fu">anova</span>(modelo_stepwise, modelo_logit_completo, <span class="at">test =</span> <span class="st">"LRT"</span>)</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(lrt_test)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table

Model 1: type ~ glu + bmi + npreg + ped + age
Model 2: type ~ npreg + glu + bp + skin + bmi + ped + age
  Resid. Df Resid. Dev Df Deviance Pr(&gt;Chi)
1       367     329.96                     
2       365     329.30  2  0.66843   0.7159</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Usar modelo final (stepwise)</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>modelo_final <span class="ot">&lt;-</span> modelo_stepwise</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modelo_final)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = type ~ glu + bmi + npreg + ped + age, family = binomial, 
    data = datos_train)

Coefficients:
             Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -9.943128   1.111885  -8.943  &lt; 2e-16 ***
glu          0.034063   0.005003   6.808 9.91e-12 ***
bmi          0.097160   0.023507   4.133 3.58e-05 ***
npreg        0.126841   0.050554   2.509   0.0121 *  
ped          1.023143   0.437064   2.341   0.0192 *  
age          0.022165   0.014731   1.505   0.1324    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 474.38  on 372  degrees of freedom
Residual deviance: 329.96  on 367  degrees of freedom
AIC: 341.96

Number of Fisher Scoring iterations: 5</code></pre>
</div>
</div>
</section>
<section id="bondad-de-ajuste" class="level3">
<h3 class="anchored" data-anchor-id="bondad-de-ajuste">Bondad de Ajuste</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pseudo R²</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>mcfadden_r2 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> (<span class="fu">logLik</span>(modelo_final) <span class="sc">/</span> <span class="fu">logLik</span>(modelo_inicial))</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>nagelkerke_r2 <span class="ot">&lt;-</span> <span class="cf">function</span>(modelo_null, modelo_full) {</span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">nobs</span>(modelo_full)</span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>  cox_snell <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> (<span class="fu">exp</span>(<span class="fu">logLik</span>(modelo_null))<span class="sc">/</span><span class="fu">exp</span>(<span class="fu">logLik</span>(modelo_full)))<span class="sc">^</span>(<span class="dv">2</span><span class="sc">/</span>n)</span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>  max_r2 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">exp</span>(<span class="fu">logLik</span>(modelo_null))<span class="sc">^</span>(<span class="dv">2</span><span class="sc">/</span>n)</span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(cox_snell <span class="sc">/</span> max_r2)</span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== MEDIDAS DE BONDAD DE AJUSTE ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== MEDIDAS DE BONDAD DE AJUSTE ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"McFadden R²:"</span>, <span class="fu">round</span>(<span class="fu">as.numeric</span>(mcfadden_r2), <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>McFadden R²: 0.304 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Nagelkerke R²:"</span>, <span class="fu">round</span>(<span class="fu">nagelkerke_r2</span>(modelo_inicial, modelo_final), <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Nagelkerke R²: 0.446 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"AIC:"</span>, <span class="fu">round</span>(<span class="fu">AIC</span>(modelo_final), <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>AIC: 341.96 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Deviance:"</span>, <span class="fu">round</span>(<span class="fu">deviance</span>(modelo_final), <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Deviance: 329.96 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Deviance nula:"</span>, <span class="fu">round</span>(modelo_final<span class="sc">$</span>null.deviance, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Deviance nula: 474.38 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test de significancia global</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>deviance_diff <span class="ot">&lt;-</span> modelo_final<span class="sc">$</span>null.deviance <span class="sc">-</span> <span class="fu">deviance</span>(modelo_final)</span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>df_diff <span class="ot">&lt;-</span> modelo_final<span class="sc">$</span>df.null <span class="sc">-</span> modelo_final<span class="sc">$</span>df.residual</span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>p_valor_global <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">pchisq</span>(deviance_diff, df_diff)</span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== TEST DE SIGNIFICANCIA GLOBAL ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== TEST DE SIGNIFICANCIA GLOBAL ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Chi-cuadrado:"</span>, <span class="fu">round</span>(deviance_diff, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Chi-cuadrado: 144.41 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Grados de libertad:"</span>, df_diff, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Grados de libertad: 5 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"p-valor:"</span>, <span class="fu">format.pval</span>(p_valor_global, <span class="at">digits =</span> <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>p-valor: &lt;2e-16 </code></pre>
</div>
</div>
</section>
<section id="diagnósticos-del-modelo" class="level3">
<h3 class="anchored" data-anchor-id="diagnósticos-del-modelo">Diagnósticos del Modelo</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcular diferentes tipos de residuos</span></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>datos_train<span class="sc">$</span>residuos_pearson <span class="ot">&lt;-</span> <span class="fu">residuals</span>(modelo_final, <span class="at">type =</span> <span class="st">"pearson"</span>)</span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>datos_train<span class="sc">$</span>residuos_deviance <span class="ot">&lt;-</span> <span class="fu">residuals</span>(modelo_final, <span class="at">type =</span> <span class="st">"deviance"</span>)</span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>datos_train<span class="sc">$</span>valores_ajustados <span class="ot">&lt;-</span> <span class="fu">fitted</span>(modelo_final)</span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>datos_train<span class="sc">$</span>leverage <span class="ot">&lt;-</span> <span class="fu">hatvalues</span>(modelo_final)</span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a>datos_train<span class="sc">$</span>cook_distance <span class="ot">&lt;-</span> <span class="fu">cooks.distance</span>(modelo_final)</span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráficos de diagnóstico</span></span>
<span id="cb131-9"><a href="#cb131-9" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(datos_train, <span class="fu">aes</span>(<span class="at">x =</span> valores_ajustados, <span class="at">y =</span> residuos_deviance)) <span class="sc">+</span></span>
<span id="cb131-10"><a href="#cb131-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb131-11"><a href="#cb131-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb131-12"><a href="#cb131-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb131-13"><a href="#cb131-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Residuos Deviance vs Valores Ajustados"</span>,</span>
<span id="cb131-14"><a href="#cb131-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Probabilidades Predichas"</span>, <span class="at">y =</span> <span class="st">"Residuos Deviance"</span>) <span class="sc">+</span></span>
<span id="cb131-15"><a href="#cb131-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb131-16"><a href="#cb131-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-17"><a href="#cb131-17" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(datos_train, <span class="fu">aes</span>(<span class="at">sample =</span> residuos_deviance)) <span class="sc">+</span></span>
<span id="cb131-18"><a href="#cb131-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_qq</span>() <span class="sc">+</span></span>
<span id="cb131-19"><a href="#cb131-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_qq_line</span>(<span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb131-20"><a href="#cb131-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Q-Q Plot de Residuos Deviance"</span>,</span>
<span id="cb131-21"><a href="#cb131-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Cuantiles Teóricos"</span>, <span class="at">y =</span> <span class="st">"Cuantiles Muestra"</span>) <span class="sc">+</span></span>
<span id="cb131-22"><a href="#cb131-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb131-23"><a href="#cb131-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-24"><a href="#cb131-24" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(datos_train, <span class="fu">aes</span>(<span class="at">x =</span> leverage, <span class="at">y =</span> residuos_deviance)) <span class="sc">+</span></span>
<span id="cb131-25"><a href="#cb131-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb131-26"><a href="#cb131-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb131-27"><a href="#cb131-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Residuos vs Leverage"</span>,</span>
<span id="cb131-28"><a href="#cb131-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Leverage"</span>, <span class="at">y =</span> <span class="st">"Residuos Deviance"</span>) <span class="sc">+</span></span>
<span id="cb131-29"><a href="#cb131-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb131-30"><a href="#cb131-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-31"><a href="#cb131-31" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(datos_train, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">seq_along</span>(cook_distance), <span class="at">y =</span> cook_distance)) <span class="sc">+</span></span>
<span id="cb131-32"><a href="#cb131-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb131-33"><a href="#cb131-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">4</span><span class="sc">/</span><span class="fu">nrow</span>(datos_train), <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb131-34"><a href="#cb131-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distancia de Cook"</span>,</span>
<span id="cb131-35"><a href="#cb131-35" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Observación"</span>, <span class="at">y =</span> <span class="st">"Distancia de Cook"</span>) <span class="sc">+</span></span>
<span id="cb131-36"><a href="#cb131-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb131-37"><a href="#cb131-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-38"><a href="#cb131-38" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p1, p2, p3, p4, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lab5_modelos_generalizados_files/figure-html/logistic_diagnostics-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Identificar observaciones influyentes</span></span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>n_obs <span class="ot">&lt;-</span> <span class="fu">nrow</span>(datos_train)</span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>outliers_cook <span class="ot">&lt;-</span> <span class="fu">which</span>(datos_train<span class="sc">$</span>cook_distance <span class="sc">&gt;</span> <span class="dv">4</span><span class="sc">/</span>n_obs)</span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a>outliers_leverage <span class="ot">&lt;-</span> <span class="fu">which</span>(datos_train<span class="sc">$</span>leverage <span class="sc">&gt;</span> <span class="dv">2</span><span class="sc">*</span><span class="fu">length</span>(<span class="fu">coef</span>(modelo_final))<span class="sc">/</span>n_obs)</span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== DIAGNÓSTICO DE OBSERVACIONES INFLUYENTES ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== DIAGNÓSTICO DE OBSERVACIONES INFLUYENTES ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Observaciones con alta distancia de Cook (&gt;4/n):"</span>, <span class="fu">length</span>(outliers_cook), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Observaciones con alta distancia de Cook (&gt;4/n): 22 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">length</span>(outliers_cook) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Índices:"</span>, <span class="fu">head</span>(outliers_cook, <span class="dv">10</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Índices: 4 6 9 26 59 76 80 82 100 147 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Observaciones con alto leverage (&gt;2p/n):"</span>, <span class="fu">length</span>(outliers_leverage), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Observaciones con alto leverage (&gt;2p/n): 39 </code></pre>
</div>
</div>
</section>
<section id="validación-y-predicción" class="level3">
<h3 class="anchored" data-anchor-id="validación-y-predicción">Validación y Predicción</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicciones en conjunto de prueba</span></span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>pred_prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(modelo_final, <span class="at">newdata =</span> datos_test, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>pred_class <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(pred_prob <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="st">"Yes"</span>, <span class="st">"No"</span>)</span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Matriz de confusión</span></span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a>matriz_confusion <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">Predicho =</span> pred_class, <span class="at">Real =</span> datos_test<span class="sc">$</span>type)</span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(matriz_confusion)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Real
Predicho No Yes
     No  93  20
     Yes 13  33</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Métricas de clasificación</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>accuracy <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">diag</span>(matriz_confusion)) <span class="sc">/</span> <span class="fu">sum</span>(matriz_confusion)</span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>sensitivity <span class="ot">&lt;-</span> matriz_confusion[<span class="dv">2</span>,<span class="dv">2</span>] <span class="sc">/</span> <span class="fu">sum</span>(matriz_confusion[,<span class="dv">2</span>])  <span class="co"># VP / (VP + FN)</span></span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a>specificity <span class="ot">&lt;-</span> matriz_confusion[<span class="dv">1</span>,<span class="dv">1</span>] <span class="sc">/</span> <span class="fu">sum</span>(matriz_confusion[,<span class="dv">1</span>])  <span class="co"># VN / (VN + FP)</span></span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a>precision <span class="ot">&lt;-</span> matriz_confusion[<span class="dv">2</span>,<span class="dv">2</span>] <span class="sc">/</span> <span class="fu">sum</span>(matriz_confusion[<span class="dv">2</span>,])    <span class="co"># VP / (VP + FP)</span></span>
<span id="cb142-6"><a href="#cb142-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-7"><a href="#cb142-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== MÉTRICAS DE CLASIFICACIÓN ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== MÉTRICAS DE CLASIFICACIÓN ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Accuracy (Precisión):"</span>, <span class="fu">round</span>(accuracy, <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Accuracy (Precisión): 0.792 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Sensitivity (Sensibilidad):"</span>, <span class="fu">round</span>(sensitivity, <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sensitivity (Sensibilidad): 0.623 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Specificity (Especificidad):"</span>, <span class="fu">round</span>(specificity, <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Specificity (Especificidad): 0.877 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Precision (Precisión Positiva):"</span>, <span class="fu">round</span>(precision, <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Precision (Precisión Positiva): 0.717 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Curva ROC</span></span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a>roc_curve <span class="ot">&lt;-</span> <span class="fu">roc</span>(datos_test<span class="sc">$</span>type, pred_prob)</span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a>auc_value <span class="ot">&lt;-</span> <span class="fu">auc</span>(roc_curve)</span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-5"><a href="#cb152-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráfico ROC</span></span>
<span id="cb152-6"><a href="#cb152-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(roc_curve, <span class="at">main =</span> <span class="st">"Curva ROC - Regresión Logística"</span>, </span>
<span id="cb152-7"><a href="#cb152-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb152-8"><a href="#cb152-8" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="fl">0.6</span>, <span class="fl">0.4</span>, <span class="fu">paste</span>(<span class="st">"AUC ="</span>, <span class="fu">round</span>(auc_value, <span class="dv">3</span>)), <span class="at">cex =</span> <span class="fl">1.2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lab5_modelos_generalizados_files/figure-html/logistic_validation-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== ANÁLISIS ROC ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== ANÁLISIS ROC ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"AUC (Área bajo la curva):"</span>, <span class="fu">round</span>(auc_value, <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>AUC (Área bajo la curva): 0.87 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Interpretación del AUC</span></span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(auc_value <span class="sc">&gt;=</span> <span class="fl">0.9</span>) {</span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Interpretación: Excelente discriminación</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span>(auc_value <span class="sc">&gt;=</span> <span class="fl">0.8</span>) {</span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Interpretación: Buena discriminación</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb157-6"><a href="#cb157-6" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span>(auc_value <span class="sc">&gt;=</span> <span class="fl">0.7</span>) {</span>
<span id="cb157-7"><a href="#cb157-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Interpretación: Discriminación aceptable</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb157-8"><a href="#cb157-8" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span>(auc_value <span class="sc">&gt;=</span> <span class="fl">0.6</span>) {</span>
<span id="cb157-9"><a href="#cb157-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Interpretación: Discriminación pobre</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb157-10"><a href="#cb157-10" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb157-11"><a href="#cb157-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Interpretación: Sin capacidad discriminativa útil</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb157-12"><a href="#cb157-12" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Interpretación: Buena discriminación</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Punto óptimo en la curva ROC</span></span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a>coords_optimo <span class="ot">&lt;-</span> <span class="fu">coords</span>(roc_curve, <span class="st">"best"</span>, <span class="at">ret =</span> <span class="fu">c</span>(<span class="st">"threshold"</span>, <span class="st">"sensitivity"</span>, <span class="st">"specificity"</span>))</span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Punto óptimo:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Punto óptimo:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Umbral:"</span>, <span class="fu">round</span>(coords_optimo<span class="sc">$</span>threshold, <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Umbral: 0.289 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Sensibilidad:"</span>, <span class="fu">round</span>(coords_optimo<span class="sc">$</span>sensitivity, <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sensibilidad: 0.887 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb165"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Especificidad:"</span>, <span class="fu">round</span>(coords_optimo<span class="sc">$</span>specificity, <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Especificidad: 0.764 </code></pre>
</div>
</div>
</section>
</section>
<section id="parte-3-regresión-de-poisson" class="level2">
<h2 class="anchored" data-anchor-id="parte-3-regresión-de-poisson">Parte 3: Regresión de Poisson</h2>
<section id="simulación-de-datos-de-conteo" class="level3">
<h3 class="anchored" data-anchor-id="simulación-de-datos-de-conteo">Simulación de Datos de Conteo</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb167"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simular datos de conteo realistas</span></span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">456</span>)</span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb167-4"><a href="#cb167-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-5"><a href="#cb167-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Variables predictoras</span></span>
<span id="cb167-6"><a href="#cb167-6" aria-hidden="true" tabindex="-1"></a>hospital_size <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"Pequeño"</span>, <span class="st">"Mediano"</span>, <span class="st">"Grande"</span>), n, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.4</span>, <span class="fl">0.4</span>, <span class="fl">0.2</span>))</span>
<span id="cb167-7"><a href="#cb167-7" aria-hidden="true" tabindex="-1"></a>quality_score <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">75</span>, <span class="at">sd =</span> <span class="dv">10</span>)</span>
<span id="cb167-8"><a href="#cb167-8" aria-hidden="true" tabindex="-1"></a>patient_complexity <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">50</span>, <span class="at">sd =</span> <span class="dv">15</span>)</span>
<span id="cb167-9"><a href="#cb167-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-10"><a href="#cb167-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Codificar tamaño del hospital</span></span>
<span id="cb167-11"><a href="#cb167-11" aria-hidden="true" tabindex="-1"></a>size_medium <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(hospital_size <span class="sc">==</span> <span class="st">"Mediano"</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb167-12"><a href="#cb167-12" aria-hidden="true" tabindex="-1"></a>size_large <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(hospital_size <span class="sc">==</span> <span class="st">"Grande"</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb167-13"><a href="#cb167-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-14"><a href="#cb167-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Generar número de infecciones (variable de conteo)</span></span>
<span id="cb167-15"><a href="#cb167-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Log-tasa lineal con los predictores</span></span>
<span id="cb167-16"><a href="#cb167-16" aria-hidden="true" tabindex="-1"></a>log_lambda <span class="ot">&lt;-</span> <span class="fl">1.5</span> <span class="sc">-</span> <span class="fl">0.02</span><span class="sc">*</span>quality_score <span class="sc">+</span> size_medium<span class="sc">*</span><span class="fl">0.5</span> <span class="sc">+</span> size_large<span class="sc">*</span><span class="fl">0.8</span> <span class="sc">+</span> <span class="fl">0.01</span><span class="sc">*</span>patient_complexity</span>
<span id="cb167-17"><a href="#cb167-17" aria-hidden="true" tabindex="-1"></a>lambda <span class="ot">&lt;-</span> <span class="fu">exp</span>(log_lambda)</span>
<span id="cb167-18"><a href="#cb167-18" aria-hidden="true" tabindex="-1"></a>infecciones <span class="ot">&lt;-</span> <span class="fu">rpois</span>(n, lambda)</span>
<span id="cb167-19"><a href="#cb167-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-20"><a href="#cb167-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear dataset</span></span>
<span id="cb167-21"><a href="#cb167-21" aria-hidden="true" tabindex="-1"></a>datos_hospitales <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb167-22"><a href="#cb167-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">infecciones =</span> infecciones,</span>
<span id="cb167-23"><a href="#cb167-23" aria-hidden="true" tabindex="-1"></a>  tamaño <span class="ot">=</span> hospital_size,</span>
<span id="cb167-24"><a href="#cb167-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">calidad =</span> quality_score,</span>
<span id="cb167-25"><a href="#cb167-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">complejidad =</span> patient_complexity,</span>
<span id="cb167-26"><a href="#cb167-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">size_medium =</span> size_medium,</span>
<span id="cb167-27"><a href="#cb167-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">size_large =</span> size_large</span>
<span id="cb167-28"><a href="#cb167-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb167-29"><a href="#cb167-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-30"><a href="#cb167-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Información del dataset</span></span>
<span id="cb167-31"><a href="#cb167-31" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== DATASET SIMULADO: INFECCIONES HOSPITALARIAS ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== DATASET SIMULADO: INFECCIONES HOSPITALARIAS ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb169"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Observaciones:"</span>, <span class="fu">nrow</span>(datos_hospitales), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Observaciones: 200 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb171"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Variable respuesta: Número de infecciones por hospital</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Variable respuesta: Número de infecciones por hospital</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb173"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estadísticas descriptivas</span></span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== ESTADÍSTICAS DESCRIPTIVAS ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== ESTADÍSTICAS DESCRIPTIVAS ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb175"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(datos_hospitales)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  infecciones       tamaño             calidad        complejidad   
 Min.   :0.000   Length:200         Min.   : 51.18   Min.   :14.29  
 1st Qu.:1.000   Class :character   1st Qu.: 67.50   1st Qu.:42.95  
 Median :2.000   Mode  :character   Median : 74.99   Median :52.06  
 Mean   :2.815                      Mean   : 74.91   Mean   :52.91  
 3rd Qu.:4.000                      3rd Qu.: 82.84   3rd Qu.:62.26  
 Max.   :9.000                      Max.   :101.99   Max.   :95.14  
  size_medium      size_large  
 Min.   :0.000   Min.   :0.00  
 1st Qu.:0.000   1st Qu.:0.00  
 Median :0.000   Median :0.00  
 Mean   :0.335   Mean   :0.24  
 3rd Qu.:1.000   3rd Qu.:0.00  
 Max.   :1.000   Max.   :1.00  </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb177"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Distribución de la variable respuesta</span></span>
<span id="cb177-2"><a href="#cb177-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== DISTRIBUCIÓN DE INFECCIONES ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== DISTRIBUCIÓN DE INFECCIONES ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb179"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(datos_hospitales<span class="sc">$</span>infecciones)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 0  1  2  3  4  5  6  7  8  9 
13 47 42 37 23 16 12  4  5  1 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb181"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Verificar supuesto de equidispersión</span></span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a>media_infecciones <span class="ot">&lt;-</span> <span class="fu">mean</span>(datos_hospitales<span class="sc">$</span>infecciones)</span>
<span id="cb181-3"><a href="#cb181-3" aria-hidden="true" tabindex="-1"></a>var_infecciones <span class="ot">&lt;-</span> <span class="fu">var</span>(datos_hospitales<span class="sc">$</span>infecciones)</span>
<span id="cb181-4"><a href="#cb181-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Media:"</span>, <span class="fu">round</span>(media_infecciones, <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Media: 2.815 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb183"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Varianza:"</span>, <span class="fu">round</span>(var_infecciones, <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Varianza: 3.82 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb185"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Razón Varianza/Media:"</span>, <span class="fu">round</span>(var_infecciones<span class="sc">/</span>media_infecciones, <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Razón Varianza/Media: 1.357 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb187"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Histograma</span></span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(datos_hospitales, <span class="fu">aes</span>(<span class="at">x =</span> infecciones)) <span class="sc">+</span></span>
<span id="cb187-3"><a href="#cb187-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">15</span>, <span class="at">fill =</span> <span class="st">"lightblue"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb187-4"><a href="#cb187-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribución del Número de Infecciones"</span>,</span>
<span id="cb187-5"><a href="#cb187-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Número de Infecciones"</span>, <span class="at">y =</span> <span class="st">"Frecuencia"</span>) <span class="sc">+</span></span>
<span id="cb187-6"><a href="#cb187-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lab5_modelos_generalizados_files/figure-html/poisson_data-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="ajuste-del-modelo-de-poisson" class="level3">
<h3 class="anchored" data-anchor-id="ajuste-del-modelo-de-poisson">Ajuste del Modelo de Poisson</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb188"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Dividir datos</span></span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a>indices_train_pois <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(datos_hospitales<span class="sc">$</span>infecciones, <span class="at">p =</span> <span class="fl">0.7</span>, <span class="at">list =</span> <span class="cn">FALSE</span>)</span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a>train_pois <span class="ot">&lt;-</span> datos_hospitales[indices_train_pois, ]</span>
<span id="cb188-4"><a href="#cb188-4" aria-hidden="true" tabindex="-1"></a>test_pois <span class="ot">&lt;-</span> datos_hospitales[<span class="sc">-</span>indices_train_pois, ]</span>
<span id="cb188-5"><a href="#cb188-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-6"><a href="#cb188-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Ajustar modelo de Poisson</span></span>
<span id="cb188-7"><a href="#cb188-7" aria-hidden="true" tabindex="-1"></a>modelo_poisson <span class="ot">&lt;-</span> <span class="fu">glm</span>(infecciones <span class="sc">~</span> calidad <span class="sc">+</span> size_medium <span class="sc">+</span> size_large <span class="sc">+</span> complejidad, </span>
<span id="cb188-8"><a href="#cb188-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> train_pois, <span class="at">family =</span> poisson)</span>
<span id="cb188-9"><a href="#cb188-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-10"><a href="#cb188-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modelo_poisson)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = infecciones ~ calidad + size_medium + size_large + 
    complejidad, family = poisson, data = train_pois)

Coefficients:
             Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  1.168845   0.454286   2.573   0.0101 *  
calidad     -0.012462   0.005370  -2.321   0.0203 *  
size_medium  0.597779   0.126300   4.733 2.21e-06 ***
size_large   0.826954   0.129682   6.377 1.81e-10 ***
complejidad  0.006368   0.003492   1.824   0.0682 .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 196.79  on 140  degrees of freedom
Residual deviance: 141.79  on 136  degrees of freedom
AIC: 524.19

Number of Fisher Scoring iterations: 5</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb190"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Interpretación de coeficientes como IRR (Incidence Rate Ratios)</span></span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a>irr <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">coef</span>(modelo_poisson))</span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a>conf_int_pois <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">confint</span>(modelo_poisson))</span>
<span id="cb190-4"><a href="#cb190-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-5"><a href="#cb190-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== INCIDENCE RATE RATIOS (IRR) ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== INCIDENCE RATE RATIOS (IRR) ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb192"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a>resultados_irr <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Variable =</span> <span class="fu">names</span>(irr),</span>
<span id="cb192-3"><a href="#cb192-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">IRR =</span> <span class="fu">round</span>(irr, <span class="dv">3</span>),</span>
<span id="cb192-4"><a href="#cb192-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">IC_2.5 =</span> <span class="fu">round</span>(conf_int_pois[,<span class="dv">1</span>], <span class="dv">3</span>),</span>
<span id="cb192-5"><a href="#cb192-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">IC_97.5 =</span> <span class="fu">round</span>(conf_int_pois[,<span class="dv">2</span>], <span class="dv">3</span>)</span>
<span id="cb192-6"><a href="#cb192-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb192-7"><a href="#cb192-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(resultados_irr)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>               Variable   IRR IC_2.5 IC_97.5
(Intercept) (Intercept) 3.218  1.313   7.796
calidad         calidad 0.988  0.977   0.998
size_medium size_medium 1.818  1.421   2.333
size_large   size_large 2.286  1.775   2.953
complejidad complejidad 1.006  0.999   1.013</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb194"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Interpretación práctica</span></span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== INTERPRETACIÓN DE IRR ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== INTERPRETACIÓN DE IRR ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb196"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"calidad: IRR ="</span>, <span class="fu">round</span>(irr[<span class="st">"calidad"</span>], <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>calidad: IRR = 0.988 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb198"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  → Por cada punto adicional en calidad, la tasa de infecciones se multiplica por"</span>, <span class="fu">round</span>(irr[<span class="st">"calidad"</span>], <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  → Por cada punto adicional en calidad, la tasa de infecciones se multiplica por 0.988 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb200"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  → Esto representa una disminución del"</span>, <span class="fu">round</span>((<span class="dv">1</span> <span class="sc">-</span> irr[<span class="st">"calidad"</span>]) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>), <span class="st">"% en la tasa</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  → Esto representa una disminución del 1.2 % en la tasa</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb202"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"size_large: IRR ="</span>, <span class="fu">round</span>(irr[<span class="st">"size_large"</span>], <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>size_large: IRR = 2.286 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb204"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  → Hospitales grandes tienen una tasa"</span>, <span class="fu">round</span>(irr[<span class="st">"size_large"</span>], <span class="dv">2</span>), <span class="st">"veces mayor que pequeños</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  → Hospitales grandes tienen una tasa 2.29 veces mayor que pequeños</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb206"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  → Esto representa un aumento del"</span>, <span class="fu">round</span>((irr[<span class="st">"size_large"</span>] <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>), <span class="st">"% en la tasa</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  → Esto representa un aumento del 128.6 % en la tasa</code></pre>
</div>
</div>
</section>
<section id="diagnóstico-del-modelo-de-poisson" class="level3">
<h3 class="anchored" data-anchor-id="diagnóstico-del-modelo-de-poisson">Diagnóstico del Modelo de Poisson</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb208"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Residuos y diagnósticos</span></span>
<span id="cb208-2"><a href="#cb208-2" aria-hidden="true" tabindex="-1"></a>train_pois<span class="sc">$</span>residuos_pearson <span class="ot">&lt;-</span> <span class="fu">residuals</span>(modelo_poisson, <span class="at">type =</span> <span class="st">"pearson"</span>)</span>
<span id="cb208-3"><a href="#cb208-3" aria-hidden="true" tabindex="-1"></a>train_pois<span class="sc">$</span>residuos_deviance <span class="ot">&lt;-</span> <span class="fu">residuals</span>(modelo_poisson, <span class="at">type =</span> <span class="st">"deviance"</span>)</span>
<span id="cb208-4"><a href="#cb208-4" aria-hidden="true" tabindex="-1"></a>train_pois<span class="sc">$</span>valores_ajustados <span class="ot">&lt;-</span> <span class="fu">fitted</span>(modelo_poisson)</span>
<span id="cb208-5"><a href="#cb208-5" aria-hidden="true" tabindex="-1"></a>train_pois<span class="sc">$</span>leverage <span class="ot">&lt;-</span> <span class="fu">hatvalues</span>(modelo_poisson)</span>
<span id="cb208-6"><a href="#cb208-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-7"><a href="#cb208-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Estadístico de dispersión</span></span>
<span id="cb208-8"><a href="#cb208-8" aria-hidden="true" tabindex="-1"></a>pearson_stat <span class="ot">&lt;-</span> <span class="fu">sum</span>(train_pois<span class="sc">$</span>residuos_pearson<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb208-9"><a href="#cb208-9" aria-hidden="true" tabindex="-1"></a>df_residual <span class="ot">&lt;-</span> modelo_poisson<span class="sc">$</span>df.residual</span>
<span id="cb208-10"><a href="#cb208-10" aria-hidden="true" tabindex="-1"></a>dispersion_stat <span class="ot">&lt;-</span> pearson_stat <span class="sc">/</span> df_residual</span>
<span id="cb208-11"><a href="#cb208-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-12"><a href="#cb208-12" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== DIAGNÓSTICO DE SOBREDISPERSIÓN ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== DIAGNÓSTICO DE SOBREDISPERSIÓN ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb210"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Estadístico de Pearson:"</span>, <span class="fu">round</span>(pearson_stat, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Estadístico de Pearson: 127.35 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb212"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Grados de libertad:"</span>, df_residual, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Grados de libertad: 136 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb214"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Estadístico de dispersión:"</span>, <span class="fu">round</span>(dispersion_stat, <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Estadístico de dispersión: 0.936 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb216"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(dispersion_stat <span class="sc">&gt;</span> <span class="fl">1.5</span>) {</span>
<span id="cb216-2"><a href="#cb216-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"CONCLUSIÓN: Hay evidencia de sobredispersión (φ &gt; 1.5)</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb216-3"><a href="#cb216-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"RECOMENDACIÓN: Considerar modelo binomial negativo</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb216-4"><a href="#cb216-4" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span>(dispersion_stat <span class="sc">&gt;</span> <span class="fl">1.2</span>) {</span>
<span id="cb216-5"><a href="#cb216-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"CONCLUSIÓN: Posible sobredispersión leve (φ &gt; 1.2)</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb216-6"><a href="#cb216-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"RECOMENDACIÓN: Verificar con modelo binomial negativo</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb216-7"><a href="#cb216-7" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb216-8"><a href="#cb216-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"CONCLUSIÓN: No hay evidencia clara de sobredispersión</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb216-9"><a href="#cb216-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"RECOMENDACIÓN: Modelo de Poisson es apropiado</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb216-10"><a href="#cb216-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>CONCLUSIÓN: No hay evidencia clara de sobredispersión
RECOMENDACIÓN: Modelo de Poisson es apropiado</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb218"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráficos de diagnóstico</span></span>
<span id="cb218-2"><a href="#cb218-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(train_pois, <span class="fu">aes</span>(<span class="at">x =</span> valores_ajustados, <span class="at">y =</span> residuos_deviance)) <span class="sc">+</span></span>
<span id="cb218-3"><a href="#cb218-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb218-4"><a href="#cb218-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb218-5"><a href="#cb218-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb218-6"><a href="#cb218-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Residuos Deviance vs Valores Ajustados"</span>,</span>
<span id="cb218-7"><a href="#cb218-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Valores Ajustados"</span>, <span class="at">y =</span> <span class="st">"Residuos Deviance"</span>) <span class="sc">+</span></span>
<span id="cb218-8"><a href="#cb218-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb218-9"><a href="#cb218-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-10"><a href="#cb218-10" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(train_pois, <span class="fu">aes</span>(<span class="at">sample =</span> residuos_deviance)) <span class="sc">+</span></span>
<span id="cb218-11"><a href="#cb218-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_qq</span>() <span class="sc">+</span></span>
<span id="cb218-12"><a href="#cb218-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_qq_line</span>(<span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb218-13"><a href="#cb218-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Q-Q Plot de Residuos Deviance"</span>,</span>
<span id="cb218-14"><a href="#cb218-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Cuantiles Teóricos"</span>, <span class="at">y =</span> <span class="st">"Cuantiles Muestra"</span>) <span class="sc">+</span></span>
<span id="cb218-15"><a href="#cb218-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb218-16"><a href="#cb218-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-17"><a href="#cb218-17" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(train_pois, <span class="fu">aes</span>(<span class="at">x =</span> valores_ajustados, <span class="at">y =</span> <span class="fu">sqrt</span>(<span class="fu">abs</span>(residuos_deviance)))) <span class="sc">+</span></span>
<span id="cb218-18"><a href="#cb218-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb218-19"><a href="#cb218-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb218-20"><a href="#cb218-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Escala-Localización"</span>,</span>
<span id="cb218-21"><a href="#cb218-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Valores Ajustados"</span>, <span class="at">y =</span> <span class="st">"√|Residuos Deviance|"</span>) <span class="sc">+</span></span>
<span id="cb218-22"><a href="#cb218-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb218-23"><a href="#cb218-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-24"><a href="#cb218-24" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(train_pois, <span class="fu">aes</span>(<span class="at">x =</span> leverage, <span class="at">y =</span> residuos_deviance)) <span class="sc">+</span></span>
<span id="cb218-25"><a href="#cb218-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb218-26"><a href="#cb218-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb218-27"><a href="#cb218-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Residuos vs Leverage"</span>,</span>
<span id="cb218-28"><a href="#cb218-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Leverage"</span>, <span class="at">y =</span> <span class="st">"Residuos Deviance"</span>) <span class="sc">+</span></span>
<span id="cb218-29"><a href="#cb218-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb218-30"><a href="#cb218-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-31"><a href="#cb218-31" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p1, p2, p3, p4, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lab5_modelos_generalizados_files/figure-html/poisson_diagnostics-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="modelo-binomial-negativo" class="level3">
<h3 class="anchored" data-anchor-id="modelo-binomial-negativo">Modelo Binomial Negativo</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb219"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ajustar modelo binomial negativo para comparar</span></span>
<span id="cb219-2"><a href="#cb219-2" aria-hidden="true" tabindex="-1"></a>modelo_nb <span class="ot">&lt;-</span> <span class="fu">glm.nb</span>(infecciones <span class="sc">~</span> calidad <span class="sc">+</span> size_medium <span class="sc">+</span> size_large <span class="sc">+</span> complejidad, </span>
<span id="cb219-3"><a href="#cb219-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> train_pois)</span>
<span id="cb219-4"><a href="#cb219-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-5"><a href="#cb219-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modelo_nb)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm.nb(formula = infecciones ~ calidad + size_medium + size_large + 
    complejidad, data = train_pois, init.theta = 26714.62576, 
    link = log)

Coefficients:
             Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  1.168848   0.454312   2.573   0.0101 *  
calidad     -0.012462   0.005370  -2.321   0.0203 *  
size_medium  0.597776   0.126306   4.733 2.21e-06 ***
size_large   0.826952   0.129689   6.376 1.81e-10 ***
complejidad  0.006368   0.003492   1.824   0.0682 .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for Negative Binomial(26714.63) family taken to be 1)

    Null deviance: 196.77  on 140  degrees of freedom
Residual deviance: 141.78  on 136  degrees of freedom
AIC: 526.19

Number of Fisher Scoring iterations: 1

              Theta:  26715 
          Std. Err.:  472513 
Warning while fitting theta: iteration limit reached 

 2 x log-likelihood:  -514.19 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb221"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Comparar modelos</span></span>
<span id="cb221-2"><a href="#cb221-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== COMPARACIÓN POISSON VS BINOMIAL NEGATIVO ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== COMPARACIÓN POISSON VS BINOMIAL NEGATIVO ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb223"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"AIC Poisson:"</span>, <span class="fu">round</span>(<span class="fu">AIC</span>(modelo_poisson), <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>AIC Poisson: 524.19 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb225"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"AIC Binomial Negativo:"</span>, <span class="fu">round</span>(<span class="fu">AIC</span>(modelo_nb), <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>AIC Binomial Negativo: 526.19 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb227"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Diferencia AIC:"</span>, <span class="fu">round</span>(<span class="fu">AIC</span>(modelo_poisson) <span class="sc">-</span> <span class="fu">AIC</span>(modelo_nb), <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Diferencia AIC: -2 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb229"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Parámetro theta (binomial negativo):"</span>, <span class="fu">round</span>(modelo_nb<span class="sc">$</span>theta, <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Parámetro theta (binomial negativo): 26714.63 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb231"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb231-1"><a href="#cb231-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(modelo_nb<span class="sc">$</span>theta <span class="sc">&lt;</span> <span class="dv">10</span>) {</span>
<span id="cb231-2"><a href="#cb231-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Interpretación: Theta bajo indica sobredispersión significativa</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb231-3"><a href="#cb231-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"RECOMENDACIÓN: Usar modelo binomial negativo</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb231-4"><a href="#cb231-4" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb231-5"><a href="#cb231-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Interpretación: Theta alto, poca sobredispersión</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb231-6"><a href="#cb231-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"RECOMENDACIÓN: Modelo de Poisson puede ser suficiente</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb231-7"><a href="#cb231-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Interpretación: Theta alto, poca sobredispersión
RECOMENDACIÓN: Modelo de Poisson puede ser suficiente</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb233"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test formal de sobredispersión (LR test)</span></span>
<span id="cb233-2"><a href="#cb233-2" aria-hidden="true" tabindex="-1"></a>lr_stat <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="fu">logLik</span>(modelo_nb) <span class="sc">-</span> <span class="fu">logLik</span>(modelo_poisson))</span>
<span id="cb233-3"><a href="#cb233-3" aria-hidden="true" tabindex="-1"></a>p_valor_lr <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">pchisq</span>(lr_stat, <span class="at">df =</span> <span class="dv">1</span>)</span>
<span id="cb233-4"><a href="#cb233-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-5"><a href="#cb233-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== TEST DE RAZÓN DE VEROSIMILITUDES ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== TEST DE RAZÓN DE VEROSIMILITUDES ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb235"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Estadístico LR:"</span>, <span class="fu">round</span>(<span class="fu">as.numeric</span>(lr_stat), <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Estadístico LR: -0.001 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb237"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb237-1"><a href="#cb237-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"p-valor:"</span>, <span class="fu">format.pval</span>(p_valor_lr, <span class="at">digits =</span> <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>p-valor: 1 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb239"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb239-1"><a href="#cb239-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(p_valor_lr <span class="sc">&lt;</span> <span class="fl">0.05</span>) {</span>
<span id="cb239-2"><a href="#cb239-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"CONCLUSIÓN: Rechazamos H0, hay sobredispersión significativa</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb239-3"><a href="#cb239-3" aria-hidden="true" tabindex="-1"></a>  modelo_final_count <span class="ot">&lt;-</span> modelo_nb</span>
<span id="cb239-4"><a href="#cb239-4" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb239-5"><a href="#cb239-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"CONCLUSIÓN: No rechazamos H0, Poisson es adecuado</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb239-6"><a href="#cb239-6" aria-hidden="true" tabindex="-1"></a>  modelo_final_count <span class="ot">&lt;-</span> modelo_poisson</span>
<span id="cb239-7"><a href="#cb239-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>CONCLUSIÓN: No rechazamos H0, Poisson es adecuado</code></pre>
</div>
</div>
</section>
<section id="validación-del-modelo-de-conteo" class="level3">
<h3 class="anchored" data-anchor-id="validación-del-modelo-de-conteo">Validación del Modelo de Conteo</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb241"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicciones en conjunto de prueba</span></span>
<span id="cb241-2"><a href="#cb241-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">exists</span>(<span class="st">"modelo_final_count"</span>) <span class="sc">&amp;&amp;</span> <span class="fu">class</span>(modelo_final_count)[<span class="dv">1</span>] <span class="sc">==</span> <span class="st">"negbin"</span>) {</span>
<span id="cb241-3"><a href="#cb241-3" aria-hidden="true" tabindex="-1"></a>  pred_count <span class="ot">&lt;-</span> <span class="fu">predict</span>(modelo_final_count, <span class="at">newdata =</span> test_pois, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb241-4"><a href="#cb241-4" aria-hidden="true" tabindex="-1"></a>  modelo_name <span class="ot">&lt;-</span> <span class="st">"Binomial Negativo"</span></span>
<span id="cb241-5"><a href="#cb241-5" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb241-6"><a href="#cb241-6" aria-hidden="true" tabindex="-1"></a>  pred_count <span class="ot">&lt;-</span> <span class="fu">predict</span>(modelo_poisson, <span class="at">newdata =</span> test_pois, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb241-7"><a href="#cb241-7" aria-hidden="true" tabindex="-1"></a>  modelo_name <span class="ot">&lt;-</span> <span class="st">"Poisson"</span></span>
<span id="cb241-8"><a href="#cb241-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb241-9"><a href="#cb241-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-10"><a href="#cb241-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Métricas de validación para datos de conteo</span></span>
<span id="cb241-11"><a href="#cb241-11" aria-hidden="true" tabindex="-1"></a>rmse_count <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((test_pois<span class="sc">$</span>infecciones <span class="sc">-</span> pred_count)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb241-12"><a href="#cb241-12" aria-hidden="true" tabindex="-1"></a>mae_count <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(test_pois<span class="sc">$</span>infecciones <span class="sc">-</span> pred_count))</span>
<span id="cb241-13"><a href="#cb241-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-14"><a href="#cb241-14" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== VALIDACIÓN DEL MODELO DE CONTEO ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== VALIDACIÓN DEL MODELO DE CONTEO ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb243"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Modelo utilizado:"</span>, modelo_name, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Modelo utilizado: Poisson </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb245"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb245-1"><a href="#cb245-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"RMSE:"</span>, <span class="fu">round</span>(rmse_count, <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>RMSE: 1.622 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb247"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb247-1"><a href="#cb247-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"MAE:"</span>, <span class="fu">round</span>(mae_count, <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>MAE: 1.202 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb249"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb249-1"><a href="#cb249-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráfico de predicciones vs reales</span></span>
<span id="cb249-2"><a href="#cb249-2" aria-hidden="true" tabindex="-1"></a>test_pois<span class="sc">$</span>predicciones <span class="ot">&lt;-</span> pred_count</span>
<span id="cb249-3"><a href="#cb249-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb249-4"><a href="#cb249-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(test_pois, <span class="fu">aes</span>(<span class="at">x =</span> infecciones, <span class="at">y =</span> predicciones)) <span class="sc">+</span></span>
<span id="cb249-5"><a href="#cb249-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb249-6"><a href="#cb249-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb249-7"><a href="#cb249-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"orange"</span>) <span class="sc">+</span></span>
<span id="cb249-8"><a href="#cb249-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Predicciones vs Valores Reales -"</span>, modelo_name),</span>
<span id="cb249-9"><a href="#cb249-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Infecciones Observadas"</span>, <span class="at">y =</span> <span class="st">"Infecciones Predichas"</span>) <span class="sc">+</span></span>
<span id="cb249-10"><a href="#cb249-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lab5_modelos_generalizados_files/figure-html/poisson_validation-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb250"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb250-1"><a href="#cb250-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Análisis de residuos en validación</span></span>
<span id="cb250-2"><a href="#cb250-2" aria-hidden="true" tabindex="-1"></a>residuos_validacion <span class="ot">&lt;-</span> test_pois<span class="sc">$</span>infecciones <span class="sc">-</span> pred_count</span>
<span id="cb250-3"><a href="#cb250-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== ANÁLISIS DE RESIDUOS EN VALIDACIÓN ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== ANÁLISIS DE RESIDUOS EN VALIDACIÓN ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb252"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb252-1"><a href="#cb252-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Media de residuos:"</span>, <span class="fu">round</span>(<span class="fu">mean</span>(residuos_validacion), <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Media de residuos: -0.0523 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb254"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb254-1"><a href="#cb254-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Desviación estándar de residuos:"</span>, <span class="fu">round</span>(<span class="fu">sd</span>(residuos_validacion), <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Desviación estándar de residuos: 1.635 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb256"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb256-1"><a href="#cb256-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Histograma de residuos</span></span>
<span id="cb256-2"><a href="#cb256-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">residuos =</span> residuos_validacion), <span class="fu">aes</span>(<span class="at">x =</span> residuos)) <span class="sc">+</span></span>
<span id="cb256-3"><a href="#cb256-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">15</span>, <span class="at">fill =</span> <span class="st">"lightcoral"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb256-4"><a href="#cb256-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb256-5"><a href="#cb256-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribución de Residuos en Validación"</span>,</span>
<span id="cb256-6"><a href="#cb256-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Residuos"</span>, <span class="at">y =</span> <span class="st">"Frecuencia"</span>) <span class="sc">+</span></span>
<span id="cb256-7"><a href="#cb256-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lab5_modelos_generalizados_files/figure-html/poisson_validation-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="parte-4-otros-glms" class="level2">
<h2 class="anchored" data-anchor-id="parte-4-otros-glms">Parte 4: Otros GLMs</h2>
<section id="regresión-gamma" class="level3">
<h3 class="anchored" data-anchor-id="regresión-gamma">Regresión Gamma</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb257"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb257-1"><a href="#cb257-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simular datos gamma (ej: costos médicos)</span></span>
<span id="cb257-2"><a href="#cb257-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">789</span>)</span>
<span id="cb257-3"><a href="#cb257-3" aria-hidden="true" tabindex="-1"></a>n_gamma <span class="ot">&lt;-</span> <span class="dv">150</span></span>
<span id="cb257-4"><a href="#cb257-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-5"><a href="#cb257-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Variables predictoras</span></span>
<span id="cb257-6"><a href="#cb257-6" aria-hidden="true" tabindex="-1"></a>edad <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n_gamma, <span class="at">mean =</span> <span class="dv">50</span>, <span class="at">sd =</span> <span class="dv">15</span>)</span>
<span id="cb257-7"><a href="#cb257-7" aria-hidden="true" tabindex="-1"></a>severidad <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, n_gamma, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.25</span>, <span class="fl">0.2</span>, <span class="fl">0.15</span>, <span class="fl">0.1</span>))</span>
<span id="cb257-8"><a href="#cb257-8" aria-hidden="true" tabindex="-1"></a>tratamiento <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"Básico"</span>, <span class="st">"Estándar"</span>, <span class="st">"Avanzado"</span>), n_gamma, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb257-9"><a href="#cb257-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-10"><a href="#cb257-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Codificar tratamiento</span></span>
<span id="cb257-11"><a href="#cb257-11" aria-hidden="true" tabindex="-1"></a>trat_estandar <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(tratamiento <span class="sc">==</span> <span class="st">"Estándar"</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb257-12"><a href="#cb257-12" aria-hidden="true" tabindex="-1"></a>trat_avanzado <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(tratamiento <span class="sc">==</span> <span class="st">"Avanzado"</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb257-13"><a href="#cb257-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-14"><a href="#cb257-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Generar costos (distribución gamma)</span></span>
<span id="cb257-15"><a href="#cb257-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Los costos aumentan con edad y severidad, y según tipo de tratamiento</span></span>
<span id="cb257-16"><a href="#cb257-16" aria-hidden="true" tabindex="-1"></a>mu_gamma <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="dv">3</span> <span class="sc">+</span> <span class="fl">0.02</span><span class="sc">*</span>edad <span class="sc">+</span> <span class="fl">0.3</span><span class="sc">*</span>severidad <span class="sc">+</span> <span class="fl">0.4</span><span class="sc">*</span>trat_estandar <span class="sc">+</span> <span class="fl">0.8</span><span class="sc">*</span>trat_avanzado)</span>
<span id="cb257-17"><a href="#cb257-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Parámetros gamma: shape y rate</span></span>
<span id="cb257-18"><a href="#cb257-18" aria-hidden="true" tabindex="-1"></a>shape_param <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb257-19"><a href="#cb257-19" aria-hidden="true" tabindex="-1"></a>rate_param <span class="ot">&lt;-</span> shape_param <span class="sc">/</span> mu_gamma</span>
<span id="cb257-20"><a href="#cb257-20" aria-hidden="true" tabindex="-1"></a>costos <span class="ot">&lt;-</span> <span class="fu">rgamma</span>(n_gamma, <span class="at">shape =</span> shape_param, <span class="at">rate =</span> rate_param)</span>
<span id="cb257-21"><a href="#cb257-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-22"><a href="#cb257-22" aria-hidden="true" tabindex="-1"></a>datos_gamma <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb257-23"><a href="#cb257-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">costos =</span> costos,</span>
<span id="cb257-24"><a href="#cb257-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">edad =</span> edad,</span>
<span id="cb257-25"><a href="#cb257-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">severidad =</span> severidad,</span>
<span id="cb257-26"><a href="#cb257-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">tratamiento =</span> tratamiento,</span>
<span id="cb257-27"><a href="#cb257-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">trat_estandar =</span> trat_estandar,</span>
<span id="cb257-28"><a href="#cb257-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">trat_avanzado =</span> trat_avanzado</span>
<span id="cb257-29"><a href="#cb257-29" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb257-30"><a href="#cb257-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-31"><a href="#cb257-31" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== REGRESIÓN GAMMA: COSTOS MÉDICOS ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== REGRESIÓN GAMMA: COSTOS MÉDICOS ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb259"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb259-1"><a href="#cb259-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Observaciones:"</span>, <span class="fu">nrow</span>(datos_gamma), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Observaciones: 150 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb261"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb261-1"><a href="#cb261-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(datos_gamma)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>     costos              edad          severidad     tratamiento       
 Min.   :   5.991   Min.   : 3.686   Min.   :1.000   Length:150        
 1st Qu.:  70.356   1st Qu.:39.597   1st Qu.:1.000   Class :character  
 Median : 153.852   Median :49.495   Median :2.000   Mode  :character  
 Mean   : 201.541   Mean   :49.468   Mean   :2.633                     
 3rd Qu.: 253.502   3rd Qu.:59.081   3rd Qu.:4.000                     
 Max.   :1030.965   Max.   :95.780   Max.   :5.000                     
 trat_estandar trat_avanzado   
 Min.   :0.0   Min.   :0.0000  
 1st Qu.:0.0   1st Qu.:0.0000  
 Median :0.0   Median :0.0000  
 Mean   :0.3   Mean   :0.2867  
 3rd Qu.:1.0   3rd Qu.:1.0000  
 Max.   :1.0   Max.   :1.0000  </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb263"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb263-1"><a href="#cb263-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Verificar distribución de costos</span></span>
<span id="cb263-2"><a href="#cb263-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(datos_gamma, <span class="fu">aes</span>(<span class="at">x =</span> costos)) <span class="sc">+</span></span>
<span id="cb263-3"><a href="#cb263-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">20</span>, <span class="at">fill =</span> <span class="st">"lightgreen"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb263-4"><a href="#cb263-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribución de Costos Médicos"</span>,</span>
<span id="cb263-5"><a href="#cb263-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Costos (€)"</span>, <span class="at">y =</span> <span class="st">"Frecuencia"</span>) <span class="sc">+</span></span>
<span id="cb263-6"><a href="#cb263-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lab5_modelos_generalizados_files/figure-html/gamma_regression-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb264"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb264-1"><a href="#cb264-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ajustar modelo gamma</span></span>
<span id="cb264-2"><a href="#cb264-2" aria-hidden="true" tabindex="-1"></a>modelo_gamma <span class="ot">&lt;-</span> <span class="fu">glm</span>(costos <span class="sc">~</span> edad <span class="sc">+</span> severidad <span class="sc">+</span> trat_estandar <span class="sc">+</span> trat_avanzado,</span>
<span id="cb264-3"><a href="#cb264-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> datos_gamma, <span class="at">family =</span> <span class="fu">Gamma</span>(<span class="at">link =</span> <span class="st">"log"</span>))</span>
<span id="cb264-4"><a href="#cb264-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-5"><a href="#cb264-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modelo_gamma)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = costos ~ edad + severidad + trat_estandar + trat_avanzado, 
    family = Gamma(link = "log"), data = datos_gamma)

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   2.745337   0.225870  12.154  &lt; 2e-16 ***
edad          0.023577   0.003565   6.614 6.70e-10 ***
severidad     0.292178   0.037287   7.836 9.11e-13 ***
trat_estandar 0.638315   0.127109   5.022 1.48e-06 ***
trat_avanzado 0.834266   0.129310   6.452 1.55e-09 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for Gamma family taken to be 0.41834)

    Null deviance: 133.430  on 149  degrees of freedom
Residual deviance:  75.141  on 145  degrees of freedom
AIC: 1804.8

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb266"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb266-1"><a href="#cb266-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Interpretación de coeficientes (efectos multiplicativos)</span></span>
<span id="cb266-2"><a href="#cb266-2" aria-hidden="true" tabindex="-1"></a>exp_coefs_gamma <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">coef</span>(modelo_gamma))</span>
<span id="cb266-3"><a href="#cb266-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== INTERPRETACIÓN MULTIPLICATIVA (GAMMA) ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== INTERPRETACIÓN MULTIPLICATIVA (GAMMA) ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb268"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb268-1"><a href="#cb268-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">round</span>(exp_coefs_gamma, <span class="dv">3</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  (Intercept)          edad     severidad trat_estandar trat_avanzado 
       15.570         1.024         1.339         1.893         2.303 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb270"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb270-1"><a href="#cb270-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">edad: Por cada año adicional, los costos se multiplican por"</span>, <span class="fu">round</span>(exp_coefs_gamma[<span class="st">"edad"</span>], <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
edad: Por cada año adicional, los costos se multiplican por 1.0239 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb272"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb272-1"><a href="#cb272-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"severidad: Por cada nivel adicional de severidad, los costos se multiplican por"</span>, <span class="fu">round</span>(exp_coefs_gamma[<span class="st">"severidad"</span>], <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>severidad: Por cada nivel adicional de severidad, los costos se multiplican por 1.339 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb274"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb274-1"><a href="#cb274-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"trat_avanzado: Tratamiento avanzado vs básico multiplica costos por"</span>, <span class="fu">round</span>(exp_coefs_gamma[<span class="st">"trat_avanzado"</span>], <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>trat_avanzado: Tratamiento avanzado vs básico multiplica costos por 2.303 </code></pre>
</div>
</div>
</section>
<section id="comparación-de-familias-de-distribución" class="level3">
<h3 class="anchored" data-anchor-id="comparación-de-familias-de-distribución">Comparación de Familias de Distribución</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb276"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb276-1"><a href="#cb276-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Comparar diferentes familias para el mismo dataset</span></span>
<span id="cb276-2"><a href="#cb276-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Usar datos de infecciones pero probando diferentes distribuciones</span></span>
<span id="cb276-3"><a href="#cb276-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb276-4"><a href="#cb276-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== COMPARACIÓN DE FAMILIAS DE DISTRIBUCIÓN ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== COMPARACIÓN DE FAMILIAS DE DISTRIBUCIÓN ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb278"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb278-1"><a href="#cb278-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Dataset: Infecciones hospitalarias</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset: Infecciones hospitalarias</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb280"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb280-1"><a href="#cb280-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Modelos con diferentes distribuciones</span></span>
<span id="cb280-2"><a href="#cb280-2" aria-hidden="true" tabindex="-1"></a>modelo_gaussian <span class="ot">&lt;-</span> <span class="fu">glm</span>(infecciones <span class="sc">~</span> calidad <span class="sc">+</span> size_medium <span class="sc">+</span> size_large <span class="sc">+</span> complejidad, </span>
<span id="cb280-3"><a href="#cb280-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> train_pois, <span class="at">family =</span> gaussian)</span>
<span id="cb280-4"><a href="#cb280-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb280-5"><a href="#cb280-5" aria-hidden="true" tabindex="-1"></a>modelo_poisson_comp <span class="ot">&lt;-</span> <span class="fu">glm</span>(infecciones <span class="sc">~</span> calidad <span class="sc">+</span> size_medium <span class="sc">+</span> size_large <span class="sc">+</span> complejidad, </span>
<span id="cb280-6"><a href="#cb280-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">data =</span> train_pois, <span class="at">family =</span> poisson)</span>
<span id="cb280-7"><a href="#cb280-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb280-8"><a href="#cb280-8" aria-hidden="true" tabindex="-1"></a>modelo_quasipoisson <span class="ot">&lt;-</span> <span class="fu">glm</span>(infecciones <span class="sc">~</span> calidad <span class="sc">+</span> size_medium <span class="sc">+</span> size_large <span class="sc">+</span> complejidad, </span>
<span id="cb280-9"><a href="#cb280-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">data =</span> train_pois, <span class="at">family =</span> quasipoisson)</span>
<span id="cb280-10"><a href="#cb280-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb280-11"><a href="#cb280-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Comparar AIC (no disponible para quasipoisson)</span></span>
<span id="cb280-12"><a href="#cb280-12" aria-hidden="true" tabindex="-1"></a>modelos_comp <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb280-13"><a href="#cb280-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Gaussiano"</span> <span class="ot">=</span> modelo_gaussian,</span>
<span id="cb280-14"><a href="#cb280-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Poisson"</span> <span class="ot">=</span> modelo_poisson_comp</span>
<span id="cb280-15"><a href="#cb280-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb280-16"><a href="#cb280-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb280-17"><a href="#cb280-17" aria-hidden="true" tabindex="-1"></a>comparacion_aic <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb280-18"><a href="#cb280-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">Modelo =</span> <span class="fu">names</span>(modelos_comp),</span>
<span id="cb280-19"><a href="#cb280-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">AIC =</span> <span class="fu">sapply</span>(modelos_comp, AIC),</span>
<span id="cb280-20"><a href="#cb280-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">Deviance =</span> <span class="fu">sapply</span>(modelos_comp, deviance),</span>
<span id="cb280-21"><a href="#cb280-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">Dispersion =</span> <span class="fu">c</span>(</span>
<span id="cb280-22"><a href="#cb280-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summary</span>(modelo_gaussian)<span class="sc">$</span>dispersion,</span>
<span id="cb280-23"><a href="#cb280-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summary</span>(modelo_poisson_comp)<span class="sc">$</span>dispersion</span>
<span id="cb280-24"><a href="#cb280-24" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb280-25"><a href="#cb280-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb280-26"><a href="#cb280-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb280-27"><a href="#cb280-27" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(comparacion_aic)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>             Modelo      AIC Deviance Dispersion
Gaussiano Gaussiano 553.2439 383.5584   2.820283
Poisson     Poisson 524.1887 141.7914   1.000000</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb282"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb282-1"><a href="#cb282-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Información adicional sobre quasipoisson</span></span>
<span id="cb282-2"><a href="#cb282-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== MODELO QUASI-POISSON ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== MODELO QUASI-POISSON ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb284"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb284-1"><a href="#cb284-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Dispersión estimada:"</span>, <span class="fu">round</span>(<span class="fu">summary</span>(modelo_quasipoisson)<span class="sc">$</span>dispersion, <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dispersión estimada: 0.936 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb286"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb286-1"><a href="#cb286-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">summary</span>(modelo_quasipoisson)<span class="sc">$</span>dispersion <span class="sc">&gt;</span> <span class="fl">1.5</span>) {</span>
<span id="cb286-2"><a href="#cb286-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Interpretación: Sobredispersión confirmada</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb286-3"><a href="#cb286-3" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb286-4"><a href="#cb286-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Interpretación: Dispersión cercana a 1, Poisson adecuado</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb286-5"><a href="#cb286-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Interpretación: Dispersión cercana a 1, Poisson adecuado</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb288"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb288-1"><a href="#cb288-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicciones para comparar</span></span>
<span id="cb288-2"><a href="#cb288-2" aria-hidden="true" tabindex="-1"></a>pred_gaussian <span class="ot">&lt;-</span> <span class="fu">predict</span>(modelo_gaussian, <span class="at">newdata =</span> test_pois, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb288-3"><a href="#cb288-3" aria-hidden="true" tabindex="-1"></a>pred_poisson_comp <span class="ot">&lt;-</span> <span class="fu">predict</span>(modelo_poisson_comp, <span class="at">newdata =</span> test_pois, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb288-4"><a href="#cb288-4" aria-hidden="true" tabindex="-1"></a>pred_quasipoisson <span class="ot">&lt;-</span> <span class="fu">predict</span>(modelo_quasipoisson, <span class="at">newdata =</span> test_pois, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb288-5"><a href="#cb288-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb288-6"><a href="#cb288-6" aria-hidden="true" tabindex="-1"></a><span class="co"># RMSE de cada modelo</span></span>
<span id="cb288-7"><a href="#cb288-7" aria-hidden="true" tabindex="-1"></a>rmse_comparison <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb288-8"><a href="#cb288-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">Modelo =</span> <span class="fu">c</span>(<span class="st">"Gaussiano"</span>, <span class="st">"Poisson"</span>, <span class="st">"Quasi-Poisson"</span>),</span>
<span id="cb288-9"><a href="#cb288-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">RMSE =</span> <span class="fu">c</span>(</span>
<span id="cb288-10"><a href="#cb288-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sqrt</span>(<span class="fu">mean</span>((test_pois<span class="sc">$</span>infecciones <span class="sc">-</span> pred_gaussian)<span class="sc">^</span><span class="dv">2</span>)),</span>
<span id="cb288-11"><a href="#cb288-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sqrt</span>(<span class="fu">mean</span>((test_pois<span class="sc">$</span>infecciones <span class="sc">-</span> pred_poisson_comp)<span class="sc">^</span><span class="dv">2</span>)),</span>
<span id="cb288-12"><a href="#cb288-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sqrt</span>(<span class="fu">mean</span>((test_pois<span class="sc">$</span>infecciones <span class="sc">-</span> pred_quasipoisson)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb288-13"><a href="#cb288-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb288-14"><a href="#cb288-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb288-15"><a href="#cb288-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb288-16"><a href="#cb288-16" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== COMPARACIÓN DE RMSE EN VALIDACIÓN ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== COMPARACIÓN DE RMSE EN VALIDACIÓN ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb290"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb290-1"><a href="#cb290-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rmse_comparison)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>         Modelo     RMSE
1     Gaussiano 1.621397
2       Poisson 1.621970
3 Quasi-Poisson 1.621970</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb292"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb292-1"><a href="#cb292-1" aria-hidden="true" tabindex="-1"></a><span class="co"># El mejor modelo según RMSE</span></span>
<span id="cb292-2"><a href="#cb292-2" aria-hidden="true" tabindex="-1"></a>mejor_modelo <span class="ot">&lt;-</span> rmse_comparison<span class="sc">$</span>Modelo[<span class="fu">which.min</span>(rmse_comparison<span class="sc">$</span>RMSE)]</span>
<span id="cb292-3"><a href="#cb292-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Mejor modelo según RMSE:"</span>, mejor_modelo, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Mejor modelo según RMSE: Gaussiano </code></pre>
</div>
</div>
</section>
</section>
<section id="parte-5-ejercicios-prácticos" class="level2">
<h2 class="anchored" data-anchor-id="parte-5-ejercicios-prácticos">Parte 5: Ejercicios Prácticos</h2>
<section id="ejercicio-1-análisis-completo-de-regresión-logística" class="level3">
<h3 class="anchored" data-anchor-id="ejercicio-1-análisis-completo-de-regresión-logística">Ejercicio 1: Análisis Completo de Regresión Logística</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb294"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb294-1"><a href="#cb294-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Dataset para análisis de admisión universitaria</span></span>
<span id="cb294-2"><a href="#cb294-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">999</span>)</span>
<span id="cb294-3"><a href="#cb294-3" aria-hidden="true" tabindex="-1"></a>n_admit <span class="ot">&lt;-</span> <span class="dv">300</span></span>
<span id="cb294-4"><a href="#cb294-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb294-5"><a href="#cb294-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Simular datos de admisión</span></span>
<span id="cb294-6"><a href="#cb294-6" aria-hidden="true" tabindex="-1"></a>gre_score <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n_admit, <span class="at">mean =</span> <span class="dv">550</span>, <span class="at">sd =</span> <span class="dv">100</span>)</span>
<span id="cb294-7"><a href="#cb294-7" aria-hidden="true" tabindex="-1"></a>gpa <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n_admit, <span class="at">mean =</span> <span class="fl">3.2</span>, <span class="at">sd =</span> <span class="fl">0.5</span>)</span>
<span id="cb294-8"><a href="#cb294-8" aria-hidden="true" tabindex="-1"></a>rank_school <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, n_admit, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.15</span>, <span class="fl">0.25</span>, <span class="fl">0.35</span>, <span class="fl">0.25</span>))</span>
<span id="cb294-9"><a href="#cb294-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb294-10"><a href="#cb294-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Probabilidad de admisión</span></span>
<span id="cb294-11"><a href="#cb294-11" aria-hidden="true" tabindex="-1"></a>logit_p <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">4</span> <span class="sc">+</span> <span class="fl">0.003</span><span class="sc">*</span>gre_score <span class="sc">+</span> <span class="fl">1.2</span><span class="sc">*</span>gpa <span class="sc">-</span> <span class="fl">0.5</span><span class="sc">*</span>rank_school</span>
<span id="cb294-12"><a href="#cb294-12" aria-hidden="true" tabindex="-1"></a>prob_admit <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(<span class="sc">-</span>logit_p))</span>
<span id="cb294-13"><a href="#cb294-13" aria-hidden="true" tabindex="-1"></a>admit <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n_admit, <span class="dv">1</span>, prob_admit)</span>
<span id="cb294-14"><a href="#cb294-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb294-15"><a href="#cb294-15" aria-hidden="true" tabindex="-1"></a>datos_admision <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb294-16"><a href="#cb294-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">admit =</span> admit,</span>
<span id="cb294-17"><a href="#cb294-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">gre =</span> gre_score,</span>
<span id="cb294-18"><a href="#cb294-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">gpa =</span> gpa,</span>
<span id="cb294-19"><a href="#cb294-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">rank =</span> <span class="fu">factor</span>(rank_school)</span>
<span id="cb294-20"><a href="#cb294-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb294-21"><a href="#cb294-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb294-22"><a href="#cb294-22" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== EJERCICIO 1: ADMISIÓN UNIVERSITARIA ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== EJERCICIO 1: ADMISIÓN UNIVERSITARIA ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb296"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb296-1"><a href="#cb296-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Tareas a realizar:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Tareas a realizar:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb298"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb298-1"><a href="#cb298-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"1. Análisis exploratorio de los datos</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>1. Análisis exploratorio de los datos</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb300"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb300-1"><a href="#cb300-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"2. Ajustar modelo de regresión logística</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>2. Ajustar modelo de regresión logística</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb302"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb302-1"><a href="#cb302-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"3. Interpretar odds ratios</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>3. Interpretar odds ratios</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb304"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb304-1"><a href="#cb304-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"4. Evaluar bondad de ajuste</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>4. Evaluar bondad de ajuste</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb306"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb306-1"><a href="#cb306-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"5. Realizar diagnósticos</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>5. Realizar diagnósticos</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb308"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb308-1"><a href="#cb308-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"6. Validar el modelo</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>6. Validar el modelo</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb310"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb310-1"><a href="#cb310-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"7. Crear curva ROC y calcular AUC</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>7. Crear curva ROC y calcular AUC</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb312"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb312-1"><a href="#cb312-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Información básica</span></span>
<span id="cb312-2"><a href="#cb312-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(datos_admision)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>     admit             gre             gpa        rank   
 Min.   :0.0000   Min.   :290.5   Min.   :1.942   1: 40  
 1st Qu.:0.0000   1st Qu.:469.4   1st Qu.:2.882   2: 71  
 Median :0.0000   Median :544.3   Median :3.202   3:115  
 Mean   :0.4967   Mean   :540.0   Mean   :3.206   4: 74  
 3rd Qu.:1.0000   3rd Qu.:610.1   3rd Qu.:3.522          
 Max.   :1.0000   Max.   :788.3   Max.   :4.731          </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb314"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb314-1"><a href="#cb314-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(datos_admision<span class="sc">$</span>admit)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  0   1 
151 149 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb316"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb316-1"><a href="#cb316-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Tu análisis aquí...</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Tu análisis aquí...</code></pre>
</div>
</div>
</section>
<section id="ejercicio-2-análisis-de-datos-de-conteo" class="level3">
<h3 class="anchored" data-anchor-id="ejercicio-2-análisis-de-datos-de-conteo">Ejercicio 2: Análisis de Datos de Conteo</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb318"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb318-1"><a href="#cb318-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Dataset para análisis de reclamaciones de seguros</span></span>
<span id="cb318-2"><a href="#cb318-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">888</span>)</span>
<span id="cb318-3"><a href="#cb318-3" aria-hidden="true" tabindex="-1"></a>n_claims <span class="ot">&lt;-</span> <span class="dv">250</span></span>
<span id="cb318-4"><a href="#cb318-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb318-5"><a href="#cb318-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Simular datos de reclamaciones</span></span>
<span id="cb318-6"><a href="#cb318-6" aria-hidden="true" tabindex="-1"></a>age_driver <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n_claims, <span class="at">mean =</span> <span class="dv">40</span>, <span class="at">sd =</span> <span class="dv">12</span>)</span>
<span id="cb318-7"><a href="#cb318-7" aria-hidden="true" tabindex="-1"></a>years_exp <span class="ot">&lt;-</span> <span class="fu">pmax</span>(<span class="dv">0</span>, age_driver <span class="sc">-</span> <span class="dv">18</span> <span class="sc">+</span> <span class="fu">rnorm</span>(n_claims, <span class="dv">0</span>, <span class="dv">3</span>))</span>
<span id="cb318-8"><a href="#cb318-8" aria-hidden="true" tabindex="-1"></a>car_age <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">15</span>, n_claims, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="fl">0.2</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">15</span>)))</span>
<span id="cb318-9"><a href="#cb318-9" aria-hidden="true" tabindex="-1"></a>coverage_type <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"Básica"</span>, <span class="st">"Completa"</span>, <span class="st">"Premium"</span>), n_claims, </span>
<span id="cb318-10"><a href="#cb318-10" aria-hidden="true" tabindex="-1"></a>                       <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.4</span>, <span class="fl">0.4</span>, <span class="fl">0.2</span>))</span>
<span id="cb318-11"><a href="#cb318-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb318-12"><a href="#cb318-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Número de reclamaciones (con sobredispersión)</span></span>
<span id="cb318-13"><a href="#cb318-13" aria-hidden="true" tabindex="-1"></a>lambda_claims <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fl">0.5</span> <span class="sc">-</span> <span class="fl">0.02</span><span class="sc">*</span>years_exp <span class="sc">+</span> <span class="fl">0.05</span><span class="sc">*</span>car_age <span class="sc">+</span> </span>
<span id="cb318-14"><a href="#cb318-14" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">ifelse</span>(coverage_type <span class="sc">==</span> <span class="st">"Completa"</span>, <span class="fl">0.3</span>, <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb318-15"><a href="#cb318-15" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">ifelse</span>(coverage_type <span class="sc">==</span> <span class="st">"Premium"</span>, <span class="fl">0.6</span>, <span class="dv">0</span>))</span>
<span id="cb318-16"><a href="#cb318-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb318-17"><a href="#cb318-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Añadir sobredispersión usando binomial negativa</span></span>
<span id="cb318-18"><a href="#cb318-18" aria-hidden="true" tabindex="-1"></a>claims <span class="ot">&lt;-</span> <span class="fu">rnbinom</span>(n_claims, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">mu =</span> lambda_claims)</span>
<span id="cb318-19"><a href="#cb318-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb318-20"><a href="#cb318-20" aria-hidden="true" tabindex="-1"></a>datos_seguros <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb318-21"><a href="#cb318-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">claims =</span> claims,</span>
<span id="cb318-22"><a href="#cb318-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_driver =</span> age_driver,</span>
<span id="cb318-23"><a href="#cb318-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">years_exp =</span> years_exp,</span>
<span id="cb318-24"><a href="#cb318-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">car_age =</span> car_age,</span>
<span id="cb318-25"><a href="#cb318-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">coverage =</span> coverage_type</span>
<span id="cb318-26"><a href="#cb318-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb318-27"><a href="#cb318-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb318-28"><a href="#cb318-28" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== EJERCICIO 2: RECLAMACIONES DE SEGUROS ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== EJERCICIO 2: RECLAMACIONES DE SEGUROS ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb320"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb320-1"><a href="#cb320-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Tareas a realizar:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Tareas a realizar:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb322"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb322-1"><a href="#cb322-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"1. Análisis exploratorio (media, varianza, distribución)</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>1. Análisis exploratorio (media, varianza, distribución)</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb324"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb324-1"><a href="#cb324-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"2. Ajustar modelo de Poisson</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>2. Ajustar modelo de Poisson</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb326"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb326-1"><a href="#cb326-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"3. Diagnósticar sobredispersión</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>3. Diagnósticar sobredispersión</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb328"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb328-1"><a href="#cb328-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"4. Comparar con modelo binomial negativo</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>4. Comparar con modelo binomial negativo</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb330"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb330-1"><a href="#cb330-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"5. Interpretar coeficientes como IRR</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>5. Interpretar coeficientes como IRR</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb332"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb332-1"><a href="#cb332-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"6. Validar el modelo final</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>6. Validar el modelo final</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb334"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb334-1"><a href="#cb334-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(datos_seguros)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>     claims         age_driver       years_exp        car_age     
 Min.   : 0.000   Min.   : 9.725   Min.   : 0.00   Min.   : 1.00  
 1st Qu.: 0.000   1st Qu.:32.112   1st Qu.:13.80   1st Qu.: 2.00  
 Median : 1.000   Median :41.158   Median :22.73   Median : 3.00  
 Mean   : 1.756   Mean   :40.855   Mean   :22.89   Mean   : 4.34  
 3rd Qu.: 3.000   3rd Qu.:49.214   3rd Qu.:31.51   3rd Qu.: 6.00  
 Max.   :10.000   Max.   :75.627   Max.   :58.70   Max.   :15.00  
   coverage        
 Length:250        
 Class :character  
 Mode  :character  
                   
                   
                   </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb336"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb336-1"><a href="#cb336-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Media de reclamaciones:"</span>, <span class="fu">round</span>(<span class="fu">mean</span>(datos_seguros<span class="sc">$</span>claims), <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Media de reclamaciones: 1.756 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb338"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb338-1"><a href="#cb338-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Varianza de reclamaciones:"</span>, <span class="fu">round</span>(<span class="fu">var</span>(datos_seguros<span class="sc">$</span>claims), <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Varianza de reclamaciones: 3.318 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb340"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb340-1"><a href="#cb340-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Razón varianza/media:"</span>, <span class="fu">round</span>(<span class="fu">var</span>(datos_seguros<span class="sc">$</span>claims)<span class="sc">/</span><span class="fu">mean</span>(datos_seguros<span class="sc">$</span>claims), <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Razón varianza/media: 1.889 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb342"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb342-1"><a href="#cb342-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Tu análisis aquí...</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Tu análisis aquí...</code></pre>
</div>
</div>
</section>
<section id="ejercicio-3-selección-de-modelo-glm" class="level3">
<h3 class="anchored" data-anchor-id="ejercicio-3-selección-de-modelo-glm">Ejercicio 3: Selección de Modelo GLM</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb344"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb344-1"><a href="#cb344-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Dataset con múltiples tipos de respuesta para practicar selección</span></span>
<span id="cb344-2"><a href="#cb344-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">777</span>)</span>
<span id="cb344-3"><a href="#cb344-3" aria-hidden="true" tabindex="-1"></a>n_multi <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb344-4"><a href="#cb344-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb344-5"><a href="#cb344-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Variables predictoras</span></span>
<span id="cb344-6"><a href="#cb344-6" aria-hidden="true" tabindex="-1"></a>income <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">rnorm</span>(n_multi, <span class="at">mean =</span> <span class="dv">10</span>, <span class="at">sd =</span> <span class="fl">0.5</span>))  <span class="co"># Income log-normal</span></span>
<span id="cb344-7"><a href="#cb344-7" aria-hidden="true" tabindex="-1"></a>education <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, n_multi, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb344-8"><a href="#cb344-8" aria-hidden="true" tabindex="-1"></a>age <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n_multi, <span class="at">mean =</span> <span class="dv">45</span>, <span class="at">sd =</span> <span class="dv">12</span>)</span>
<span id="cb344-9"><a href="#cb344-9" aria-hidden="true" tabindex="-1"></a>urban <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n_multi, <span class="dv">1</span>, <span class="fl">0.6</span>)</span>
<span id="cb344-10"><a href="#cb344-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb344-11"><a href="#cb344-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Múltiples variables respuesta</span></span>
<span id="cb344-12"><a href="#cb344-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Binaria: Posee casa propia</span></span>
<span id="cb344-13"><a href="#cb344-13" aria-hidden="true" tabindex="-1"></a>own_house <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n_multi, <span class="dv">1</span>, <span class="fu">plogis</span>(<span class="sc">-</span><span class="dv">2</span> <span class="sc">+</span> <span class="fl">0.00002</span><span class="sc">*</span>income <span class="sc">+</span> <span class="fl">0.3</span><span class="sc">*</span>education <span class="sc">+</span> <span class="fl">0.02</span><span class="sc">*</span>age <span class="sc">+</span> <span class="fl">0.5</span><span class="sc">*</span>urban))</span>
<span id="cb344-14"><a href="#cb344-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb344-15"><a href="#cb344-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Conteo: Número de productos financieros</span></span>
<span id="cb344-16"><a href="#cb344-16" aria-hidden="true" tabindex="-1"></a>n_products <span class="ot">&lt;-</span> <span class="fu">rpois</span>(n_multi, <span class="fu">exp</span>(<span class="fl">0.5</span> <span class="sc">+</span> <span class="fl">0.00001</span><span class="sc">*</span>income <span class="sc">+</span> <span class="fl">0.1</span><span class="sc">*</span>education <span class="sc">+</span> <span class="fl">0.01</span><span class="sc">*</span>age <span class="sc">+</span> <span class="fl">0.2</span><span class="sc">*</span>urban))</span>
<span id="cb344-17"><a href="#cb344-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb344-18"><a href="#cb344-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Continua positiva: Gasto anual en seguros</span></span>
<span id="cb344-19"><a href="#cb344-19" aria-hidden="true" tabindex="-1"></a>insurance_spend <span class="ot">&lt;-</span> <span class="fu">rgamma</span>(n_multi, <span class="at">shape =</span> <span class="dv">2</span>, </span>
<span id="cb344-20"><a href="#cb344-20" aria-hidden="true" tabindex="-1"></a>                         <span class="at">rate =</span> <span class="dv">2</span><span class="sc">/</span><span class="fu">exp</span>(<span class="dv">5</span> <span class="sc">+</span> <span class="fl">0.00001</span><span class="sc">*</span>income <span class="sc">+</span> <span class="fl">0.1</span><span class="sc">*</span>education <span class="sc">+</span> <span class="fl">0.02</span><span class="sc">*</span>age <span class="sc">+</span> <span class="fl">0.3</span><span class="sc">*</span>urban))</span>
<span id="cb344-21"><a href="#cb344-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb344-22"><a href="#cb344-22" aria-hidden="true" tabindex="-1"></a>datos_financieros <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb344-23"><a href="#cb344-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">income =</span> income,</span>
<span id="cb344-24"><a href="#cb344-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">education =</span> education,</span>
<span id="cb344-25"><a href="#cb344-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">age =</span> age,</span>
<span id="cb344-26"><a href="#cb344-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">urban =</span> urban,</span>
<span id="cb344-27"><a href="#cb344-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">own_house =</span> own_house,</span>
<span id="cb344-28"><a href="#cb344-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_products =</span> n_products,</span>
<span id="cb344-29"><a href="#cb344-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">insurance_spend =</span> insurance_spend</span>
<span id="cb344-30"><a href="#cb344-30" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb344-31"><a href="#cb344-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb344-32"><a href="#cb344-32" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== EJERCICIO 3: SELECCIÓN DE MODELO GLM ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== EJERCICIO 3: SELECCIÓN DE MODELO GLM ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb346"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb346-1"><a href="#cb346-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Dataset con múltiples tipos de respuesta:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset con múltiples tipos de respuesta:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb348"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb348-1"><a href="#cb348-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"- own_house: Binaria (posee casa propia)</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>- own_house: Binaria (posee casa propia)</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb350"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb350-1"><a href="#cb350-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"- n_products: Conteo (número de productos financieros)</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>- n_products: Conteo (número de productos financieros)</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb352"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb352-1"><a href="#cb352-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"- insurance_spend: Continua positiva (gasto en seguros)</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>- insurance_spend: Continua positiva (gasto en seguros)</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb354"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb354-1"><a href="#cb354-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Tareas a realizar:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Tareas a realizar:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb356"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb356-1"><a href="#cb356-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"1. Para cada variable respuesta, determinar la familia de distribución apropiada</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>1. Para cada variable respuesta, determinar la familia de distribución apropiada</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb358"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb358-1"><a href="#cb358-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"2. Ajustar modelos GLM apropiados</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>2. Ajustar modelos GLM apropiados</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb360"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb360-1"><a href="#cb360-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"3. Comparar diferentes especificaciones</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>3. Comparar diferentes especificaciones</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb362"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb362-1"><a href="#cb362-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"4. Realizar diagnósticos específicos</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>4. Realizar diagnósticos específicos</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb364"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb364-1"><a href="#cb364-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"5. Validar y comparar modelos</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>5. Validar y comparar modelos</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb366"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb366-1"><a href="#cb366-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(datos_financieros)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>     income        education          age            urban       own_house   
 Min.   : 4695   Min.   :1.000   Min.   :14.82   Min.   :0.0   Min.   :0.00  
 1st Qu.:15512   1st Qu.:2.000   1st Qu.:36.33   1st Qu.:0.0   1st Qu.:0.00  
 Median :21741   Median :3.000   Median :43.68   Median :1.0   Median :1.00  
 Mean   :24941   Mean   :2.765   Mean   :43.97   Mean   :0.6   Mean   :0.67  
 3rd Qu.:30593   3rd Qu.:4.000   3rd Qu.:52.06   3rd Qu.:1.0   3rd Qu.:1.00  
 Max.   :85802   Max.   :5.000   Max.   :74.44   Max.   :1.0   Max.   :1.00  
   n_products     insurance_spend  
 Min.   : 0.000   Min.   :  25.47  
 1st Qu.: 3.000   1st Qu.: 367.86  
 Median : 5.000   Median : 582.46  
 Mean   : 4.895   Mean   : 733.34  
 3rd Qu.: 6.000   3rd Qu.: 999.15  
 Max.   :15.000   Max.   :2819.85  </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb368"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb368-1"><a href="#cb368-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Tu análisis aquí...</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Tu análisis aquí...</code></pre>
</div>
</div>
</section>
</section>
<section id="parte-6-conceptos-clave-para-recordar" class="level2">
<h2 class="anchored" data-anchor-id="parte-6-conceptos-clave-para-recordar">Parte 6: Conceptos Clave para Recordar</h2>
<section id="guía-de-decisión-para-glms" class="level3">
<h3 class="anchored" data-anchor-id="guía-de-decisión-para-glms">Guía de Decisión para GLMs</h3>
<div class="callout callout-style-default callout-important callout-titled" title="¿Qué GLM usar según el tipo de variable respuesta?">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>¿Qué GLM usar según el tipo de variable respuesta?
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Variable Binaria (0/1, Sí/No, Éxito/Fracaso):</strong></p>
<ul>
<li><strong>Modelo:</strong> Regresión Logística</li>
<li><strong>Familia:</strong> Binomial</li>
<li><strong>Enlace:</strong> Logit (canónico)</li>
<li><strong>Interpretación:</strong> Odds Ratios</li>
<li><strong>Validación:</strong> Matriz de confusión, Curva ROC, AUC</li>
</ul>
<p><strong>Variable de Conteo (0, 1, 2, 3, …):</strong></p>
<ul>
<li><strong>Modelo inicial:</strong> Regresión de Poisson</li>
<li><strong>Familia:</strong> Poisson</li>
<li><strong>Enlace:</strong> Log (canónico)</li>
<li><strong>Diagnóstico clave:</strong> Verificar sobredispersión</li>
<li><strong>Si hay sobredispersión:</strong> Cambiar a Binomial Negativa</li>
<li><strong>Interpretación:</strong> Incidence Rate Ratios (IRR)</li>
</ul>
<p><strong>Variable Continua Positiva y Sesgada:</strong></p>
<ul>
<li><strong>Modelo:</strong> Regresión Gamma</li>
<li><strong>Familia:</strong> Gamma</li>
<li><strong>Enlace:</strong> Log (común) o Inverso (canónico)</li>
<li><strong>Interpretación:</strong> Efectos multiplicativos</li>
<li><strong>Uso típico:</strong> Costos, tiempos, valores monetarios</li>
</ul>
</div>
</div>
</section>
<section id="diagnósticos-específicos-para-glms" class="level3">
<h3 class="anchored" data-anchor-id="diagnósticos-específicos-para-glms">Diagnósticos Específicos para GLMs</h3>
<div class="callout callout-style-default callout-note callout-titled" title="Herramientas de diagnóstico">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Herramientas de diagnóstico
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Deviance:</strong></p>
<ul>
<li>Medida principal de bondad de ajuste</li>
<li>Basada en verosimilitud</li>
<li>Útil para comparar modelos anidados</li>
</ul>
<p><strong>Residuos en GLMs:</strong></p>
<ul>
<li><strong>Pearson:</strong> Para verificar dispersión</li>
<li><strong>Deviance:</strong> Para gráficos diagnósticos</li>
<li><strong>Estudentizados:</strong> Para detectar outliers</li>
</ul>
<p><strong>Sobredispersión (crucial en Poisson):</strong></p>
<ul>
<li><strong>Estadístico:</strong> φ = χ²Pearson / gl</li>
<li><strong>Si φ &gt; 1.5:</strong> Considerar Binomial Negativa</li>
<li><strong>Test formal:</strong> LRT entre Poisson y Binomial Negativa</li>
</ul>
</div>
</div>
</section>
<section id="interpretación-de-coeficientes" class="level3">
<h3 class="anchored" data-anchor-id="interpretación-de-coeficientes">Interpretación de Coeficientes</h3>
<div class="callout callout-style-default callout-warning callout-titled" title="Interpretación según el enlace">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Warning</span>Interpretación según el enlace
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Enlace Logit (Regresión Logística):</strong></p>
<ul>
<li><strong>Coeficiente β:</strong> Cambio en log-odds por unidad</li>
<li><strong>exp(β) = OR:</strong> Odds Ratio</li>
<li><strong>Interpretación:</strong> Cambio multiplicativo en odds</li>
</ul>
<p><strong>Enlace Log (Poisson/Gamma):</strong></p>
<ul>
<li><strong>Coeficiente β:</strong> Cambio en log-tasa por unidad</li>
<li><strong>exp(β) = IRR:</strong> Incidence Rate Ratio</li>
<li><strong>Interpretación:</strong> Cambio multiplicativo en tasa/media</li>
</ul>
<p><strong>Enlace Identidad (Gaussiano):</strong></p>
<ul>
<li><strong>Coeficiente β:</strong> Cambio en media por unidad</li>
<li><strong>Interpretación:</strong> Cambio aditivo directo</li>
</ul>
</div>
</div>
</section>
<section id="validación-por-tipo-de-modelo" class="level3">
<h3 class="anchored" data-anchor-id="validación-por-tipo-de-modelo">Validación por Tipo de Modelo</h3>
<div class="callout callout-style-default callout-tip callout-titled" title="Métricas de validación apropiadas">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Métricas de validación apropiadas
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Regresión Logística:</strong></p>
<ul>
<li>Matriz de confusión (Accuracy, Sensitivity, Specificity)</li>
<li>Curva ROC y AUC</li>
<li>Calibración (gráfico de probabilidades)</li>
</ul>
<p><strong>Regresión de Poisson/Binomial Negativa:</strong></p>
<ul>
<li>RMSE y MAE en escala original</li>
<li>Gráfico predicciones vs observados</li>
<li>Análisis de sobredispersión residual</li>
</ul>
<p><strong>Regresión Gamma:</strong></p>
<ul>
<li>RMSE y MAE en escala original</li>
<li>Gráfico de residuos vs ajustados</li>
<li>Verificación de forma de distribución</li>
</ul>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>