<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.21">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Víctor Aceña Gil - Isaac Martín de Diego">
<meta name="dcterms.date" content="2025-09-03">

<title>Laboratorio 3: Ingeniería de Características - Transformaciones e Interacciones</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="lab3_ingenieria_caracteristicas_files/libs/clipboard/clipboard.min.js"></script>
<script src="lab3_ingenieria_caracteristicas_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="lab3_ingenieria_caracteristicas_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="lab3_ingenieria_caracteristicas_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="lab3_ingenieria_caracteristicas_files/libs/quarto-html/popper.min.js"></script>
<script src="lab3_ingenieria_caracteristicas_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="lab3_ingenieria_caracteristicas_files/libs/quarto-html/anchor.min.js"></script>
<link href="lab3_ingenieria_caracteristicas_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="lab3_ingenieria_caracteristicas_files/libs/quarto-html/quarto-syntax-highlighting-ea1d7ac60288e0f1efdbc993fd8432ae.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="lab3_ingenieria_caracteristicas_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="lab3_ingenieria_caracteristicas_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="lab3_ingenieria_caracteristicas_files/libs/bootstrap/bootstrap-4d7f0bce1131f3e5f9547cd857cfbfc8.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#objetivos-del-laboratorio" id="toc-objetivos-del-laboratorio" class="nav-link active" data-scroll-target="#objetivos-del-laboratorio">Objetivos del Laboratorio</a></li>
  <li><a href="#configuración-inicial" id="toc-configuración-inicial" class="nav-link" data-scroll-target="#configuración-inicial">Configuración Inicial</a></li>
  <li><a href="#parte-1-diagnóstico-de-problemas-en-los-datos" id="toc-parte-1-diagnóstico-de-problemas-en-los-datos" class="nav-link" data-scroll-target="#parte-1-diagnóstico-de-problemas-en-los-datos">Parte 1: Diagnóstico de Problemas en los Datos</a>
  <ul class="collapse">
  <li><a href="#identificación-de-problemas-comunes" id="toc-identificación-de-problemas-comunes" class="nav-link" data-scroll-target="#identificación-de-problemas-comunes">Identificación de Problemas Comunes</a></li>
  <li><a href="#análisis-visual-de-problemas" id="toc-análisis-visual-de-problemas" class="nav-link" data-scroll-target="#análisis-visual-de-problemas">Análisis Visual de Problemas</a></li>
  <li><a href="#tests-estadísticos-de-diagnóstico" id="toc-tests-estadísticos-de-diagnóstico" class="nav-link" data-scroll-target="#tests-estadísticos-de-diagnóstico">Tests Estadísticos de Diagnóstico</a></li>
  </ul></li>
  <li><a href="#parte-2-escalado-y-normalización" id="toc-parte-2-escalado-y-normalización" class="nav-link" data-scroll-target="#parte-2-escalado-y-normalización">Parte 2: Escalado y Normalización</a>
  <ul class="collapse">
  <li><a href="#comparación-de-métodos-de-escalado" id="toc-comparación-de-métodos-de-escalado" class="nav-link" data-scroll-target="#comparación-de-métodos-de-escalado">Comparación de Métodos de Escalado</a></li>
  <li><a href="#visualización-del-impacto-del-escalado" id="toc-visualización-del-impacto-del-escalado" class="nav-link" data-scroll-target="#visualización-del-impacto-del-escalado">Visualización del Impacto del Escalado</a></li>
  </ul></li>
  <li><a href="#parte-3-transformaciones-clásicas" id="toc-parte-3-transformaciones-clásicas" class="nav-link" data-scroll-target="#parte-3-transformaciones-clásicas">Parte 3: Transformaciones Clásicas</a>
  <ul class="collapse">
  <li><a href="#transformación-logarítmica" id="toc-transformación-logarítmica" class="nav-link" data-scroll-target="#transformación-logarítmica">Transformación Logarítmica</a></li>
  <li><a href="#interpretación-de-coeficientes-transformados" id="toc-interpretación-de-coeficientes-transformados" class="nav-link" data-scroll-target="#interpretación-de-coeficientes-transformados">Interpretación de Coeficientes Transformados</a></li>
  <li><a href="#transformación-de-raíz-cuadrada" id="toc-transformación-de-raíz-cuadrada" class="nav-link" data-scroll-target="#transformación-de-raíz-cuadrada">Transformación de Raíz Cuadrada</a></li>
  </ul></li>
  <li><a href="#parte-4-transformaciones-avanzadas---box-cox" id="toc-parte-4-transformaciones-avanzadas---box-cox" class="nav-link" data-scroll-target="#parte-4-transformaciones-avanzadas---box-cox">Parte 4: Transformaciones Avanzadas - Box-Cox</a>
  <ul class="collapse">
  <li><a href="#implementación-de-box-cox" id="toc-implementación-de-box-cox" class="nav-link" data-scroll-target="#implementación-de-box-cox">Implementación de Box-Cox</a></li>
  <li><a href="#análisis-post-transformación" id="toc-análisis-post-transformación" class="nav-link" data-scroll-target="#análisis-post-transformación">Análisis Post-Transformación</a></li>
  </ul></li>
  <li><a href="#parte-5-tratamiento-de-variables-categóricas" id="toc-parte-5-tratamiento-de-variables-categóricas" class="nav-link" data-scroll-target="#parte-5-tratamiento-de-variables-categóricas">Parte 5: Tratamiento de Variables Categóricas</a>
  <ul class="collapse">
  <li><a href="#one-hot-encoding-vs-codificación-ordinal" id="toc-one-hot-encoding-vs-codificación-ordinal" class="nav-link" data-scroll-target="#one-hot-encoding-vs-codificación-ordinal">One-Hot Encoding vs Codificación Ordinal</a></li>
  <li><a href="#implementación-de-codificación-ordinal" id="toc-implementación-de-codificación-ordinal" class="nav-link" data-scroll-target="#implementación-de-codificación-ordinal">Implementación de Codificación Ordinal</a></li>
  <li><a href="#implementación-de-one-hot-encoding" id="toc-implementación-de-one-hot-encoding" class="nav-link" data-scroll-target="#implementación-de-one-hot-encoding">Implementación de One-Hot Encoding</a></li>
  <li><a href="#comparación-de-métodos-de-codificación" id="toc-comparación-de-métodos-de-codificación" class="nav-link" data-scroll-target="#comparación-de-métodos-de-codificación">Comparación de Métodos de Codificación</a></li>
  </ul></li>
  <li><a href="#parte-6-interacciones-entre-variables" id="toc-parte-6-interacciones-entre-variables" class="nav-link" data-scroll-target="#parte-6-interacciones-entre-variables">Parte 6: Interacciones entre Variables</a>
  <ul class="collapse">
  <li><a href="#interacciones-continua-continua" id="toc-interacciones-continua-continua" class="nav-link" data-scroll-target="#interacciones-continua-continua">Interacciones Continua × Continua</a></li>
  <li><a href="#visualización-de-interacciones" id="toc-visualización-de-interacciones" class="nav-link" data-scroll-target="#visualización-de-interacciones">Visualización de Interacciones</a></li>
  <li><a href="#interacciones-categórica-continua" id="toc-interacciones-categórica-continua" class="nav-link" data-scroll-target="#interacciones-categórica-continua">Interacciones Categórica × Continua</a></li>
  </ul></li>
  <li><a href="#parte-7-ejercicios-prácticos" id="toc-parte-7-ejercicios-prácticos" class="nav-link" data-scroll-target="#parte-7-ejercicios-prácticos">Parte 7: Ejercicios Prácticos</a>
  <ul class="collapse">
  <li><a href="#ejercicio-1-análisis-completo-de-transformaciones" id="toc-ejercicio-1-análisis-completo-de-transformaciones" class="nav-link" data-scroll-target="#ejercicio-1-análisis-completo-de-transformaciones">Ejercicio 1: Análisis Completo de Transformaciones</a></li>
  <li><a href="#ejercicio-2-variables-categóricas-complejas" id="toc-ejercicio-2-variables-categóricas-complejas" class="nav-link" data-scroll-target="#ejercicio-2-variables-categóricas-complejas">Ejercicio 2: Variables Categóricas Complejas</a></li>
  <li><a href="#ejercicio-3-interacciones-en-contexto-real" id="toc-ejercicio-3-interacciones-en-contexto-real" class="nav-link" data-scroll-target="#ejercicio-3-interacciones-en-contexto-real">Ejercicio 3: Interacciones en Contexto Real</a></li>
  </ul></li>
  <li><a href="#parte-8-ingeniería-de-características-avanzada" id="toc-parte-8-ingeniería-de-características-avanzada" class="nav-link" data-scroll-target="#parte-8-ingeniería-de-características-avanzada">Parte 8: Ingeniería de Características Avanzada</a>
  <ul class="collapse">
  <li><a href="#creación-de-ratios-y-métricas-compuestas" id="toc-creación-de-ratios-y-métricas-compuestas" class="nav-link" data-scroll-target="#creación-de-ratios-y-métricas-compuestas">Creación de Ratios y Métricas Compuestas</a></li>
  <li><a href="#modelo-con-variables-engineered" id="toc-modelo-con-variables-engineered" class="nav-link" data-scroll-target="#modelo-con-variables-engineered">Modelo con Variables Engineered</a></li>
  </ul></li>
  <li><a href="#parte-9-conceptos-clave-para-recordar" id="toc-parte-9-conceptos-clave-para-recordar" class="nav-link" data-scroll-target="#parte-9-conceptos-clave-para-recordar">Parte 9: Conceptos Clave para Recordar</a>
  <ul class="collapse">
  <li><a href="#guía-de-decisión-para-transformaciones" id="toc-guía-de-decisión-para-transformaciones" class="nav-link" data-scroll-target="#guía-de-decisión-para-transformaciones">Guía de Decisión para Transformaciones</a></li>
  <li><a href="#estrategias-de-codificación" id="toc-estrategias-de-codificación" class="nav-link" data-scroll-target="#estrategias-de-codificación">Estrategias de Codificación</a></li>
  <li><a href="#principios-para-interacciones" id="toc-principios-para-interacciones" class="nav-link" data-scroll-target="#principios-para-interacciones">Principios para Interacciones</a></li>
  <li><a href="#workflow-de-ingeniería-de-características" id="toc-workflow-de-ingeniería-de-características" class="nav-link" data-scroll-target="#workflow-de-ingeniería-de-características">Workflow de Ingeniería de Características</a></li>
  </ul></li>
  <li><a href="#próximo-laboratorio" id="toc-próximo-laboratorio" class="nav-link" data-scroll-target="#próximo-laboratorio">Próximo Laboratorio</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Laboratorio 3: Ingeniería de Características - Transformaciones e Interacciones</h1>
<p class="subtitle lead">Modelos Estadísticos de Predicción</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Víctor Aceña Gil - Isaac Martín de Diego </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 3, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="objetivos-del-laboratorio" class="level2">
<h2 class="anchored" data-anchor-id="objetivos-del-laboratorio">Objetivos del Laboratorio</h2>
<p>Al finalizar este laboratorio, serás capaz de:</p>
<ul>
<li>Diagnosticar problemas que requieren transformaciones de variables</li>
<li>Aplicar transformaciones clásicas (logarítmica, potencial, inversa) y avanzadas (Box-Cox, Yeo-Johnson)</li>
<li>Interpretar modelos con variables transformadas</li>
<li>Codificar variables categóricas usando técnicas apropiadas</li>
<li>Crear e interpretar términos de interacción entre variables</li>
<li>Realizar ingeniería de características avanzada mediante combinaciones y ratios</li>
</ul>
</section>
<section id="configuración-inicial" class="level2">
<h2 class="anchored" data-anchor-id="configuración-inicial">Configuración Inicial</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cargar librerías necesarias</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressPackageStartupMessages</span>({</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(tidyverse)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(car)          <span class="co"># Para Box-Cox y diagnósticos</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(MASS)         <span class="co"># Para datasets y transformaciones</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(forecast)     <span class="co"># Para Box-Cox</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(corrplot)     <span class="co"># Para matrices de correlación</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(gridExtra)    <span class="co"># Para múltiples gráficos</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(GGally)       <span class="co"># Para gráficos de pares</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(knitr)        <span class="co"># Para tablas</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(caret)        <span class="co"># Para encoding de variables</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="parte-1-diagnóstico-de-problemas-en-los-datos" class="level2">
<h2 class="anchored" data-anchor-id="parte-1-diagnóstico-de-problemas-en-los-datos">Parte 1: Diagnóstico de Problemas en los Datos</h2>
<section id="identificación-de-problemas-comunes" class="level3">
<h3 class="anchored" data-anchor-id="identificación-de-problemas-comunes">Identificación de Problemas Comunes</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear dataset con múltiples problemas para diagnóstico</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Generar variables con diferentes problemas</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">runif</span>(n, <span class="dv">1</span>, <span class="dv">100</span>)                    <span class="co"># Variable normal</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">rnorm</span>(n, <span class="dv">2</span>, <span class="fl">0.5</span>))              <span class="co"># Variable con distribución log-normal (asimétrica)</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>x3 <span class="ot">&lt;-</span> <span class="fu">rbeta</span>(n, <span class="fl">0.5</span>, <span class="dv">2</span>) <span class="sc">*</span> <span class="dv">100</span>             <span class="co"># Variable con valores entre 0-100, asimétrica</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>x4 <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>), n, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.3</span>, <span class="fl">0.2</span>))</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Variable respuesta con diferentes relaciones</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>y_linear <span class="ot">&lt;-</span> <span class="dv">50</span> <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>x1 <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">10</span>)  <span class="co"># Relación lineal simple</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>y_log <span class="ot">&lt;-</span> <span class="dv">10</span> <span class="sc">+</span> <span class="dv">3</span><span class="sc">*</span><span class="fu">log</span>(x1) <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">5</span>) <span class="co"># Relación logarítmica</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>y_power <span class="ot">&lt;-</span> <span class="dv">5</span><span class="sc">*</span>x1<span class="sc">^</span><span class="fl">0.5</span> <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">8</span>)     <span class="co"># Relación de potencia</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>y_hetero <span class="ot">&lt;-</span> <span class="dv">30</span> <span class="sc">+</span> <span class="fl">0.5</span><span class="sc">*</span>x2 <span class="sc">+</span> x2<span class="sc">*</span><span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="fl">0.1</span>)  <span class="co"># Heterocedasticidad</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear dataset de diagnóstico</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>datos_diagnostico <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">x1 =</span> x1, <span class="at">x2 =</span> x2, <span class="at">x3 =</span> x3, <span class="at">x4 =</span> x4,</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">y_linear =</span> y_linear, <span class="at">y_log =</span> y_log, </span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">y_power =</span> y_power, <span class="at">y_hetero =</span> y_hetero</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Resumen estadístico inicial</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(datos_diagnostico)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>       x1               x2               x3                x4           
 Min.   : 1.062   Min.   : 2.647   Min.   : 0.00065   Length:200        
 1st Qu.:27.940   1st Qu.: 5.424   1st Qu.: 2.80451   Class :character  
 Median :48.728   Median : 7.100   Median :12.45256   Mode  :character  
 Mean   :51.133   Mean   : 8.390   Mean   :20.13455                     
 3rd Qu.:73.604   3rd Qu.:10.027   3rd Qu.:31.17041                     
 Max.   :99.433   Max.   :37.357   Max.   :93.60517                     
    y_linear          y_log           y_power          y_hetero    
 Min.   : 43.69   Min.   : 3.871   Min.   :-6.751   Min.   :31.01  
 1st Qu.:106.32   1st Qu.:17.842   1st Qu.:24.849   1st Qu.:32.54  
 Median :150.79   Median :21.473   Median :34.930   Median :33.50  
 Mean   :153.16   Mean   :21.271   Mean   :33.935   Mean   :34.32  
 3rd Qu.:196.18   3rd Qu.:23.956   3rd Qu.:43.177   3rd Qu.:35.17  
 Max.   :263.54   Max.   :37.360   Max.   :65.396   Max.   :53.78  </code></pre>
</div>
</div>
</section>
<section id="análisis-visual-de-problemas" class="level3">
<h3 class="anchored" data-anchor-id="análisis-visual-de-problemas">Análisis Visual de Problemas</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Función para crear gráficos de diagnóstico</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>crear_diagnosticos <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y, titulo) {</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Scatter:"</span>, titulo), <span class="at">x =</span> <span class="st">"X"</span>, <span class="at">y =</span> <span class="st">"Y"</span>) <span class="sc">+</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Residuos del modelo lineal</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  modelo <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x)</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  residuos <span class="ot">&lt;-</span> <span class="fu">residuals</span>(modelo)</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  ajustados <span class="ot">&lt;-</span> <span class="fu">fitted</span>(modelo)</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">ajustados =</span> ajustados, <span class="at">residuos =</span> residuos), </span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> ajustados, <span class="at">y =</span> residuos)) <span class="sc">+</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Residuos:"</span>, titulo), </span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"Valores Ajustados"</span>, <span class="at">y =</span> <span class="st">"Residuos"</span>) <span class="sc">+</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">scatter =</span> p1, <span class="at">residuos =</span> p2))</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Diagnósticos para diferentes relaciones</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>diag_linear <span class="ot">&lt;-</span> <span class="fu">crear_diagnosticos</span>(datos_diagnostico<span class="sc">$</span>x1, datos_diagnostico<span class="sc">$</span>y_linear, <span class="st">"Relación Lineal"</span>)</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>diag_log <span class="ot">&lt;-</span> <span class="fu">crear_diagnosticos</span>(datos_diagnostico<span class="sc">$</span>x1, datos_diagnostico<span class="sc">$</span>y_log, <span class="st">"Relación Logarítmica"</span>)</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>diag_power <span class="ot">&lt;-</span> <span class="fu">crear_diagnosticos</span>(datos_diagnostico<span class="sc">$</span>x1, datos_diagnostico<span class="sc">$</span>y_power, <span class="st">"Relación de Potencia"</span>)</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>diag_hetero <span class="ot">&lt;-</span> <span class="fu">crear_diagnosticos</span>(datos_diagnostico<span class="sc">$</span>x2, datos_diagnostico<span class="sc">$</span>y_hetero, <span class="st">"Heterocedasticidad"</span>)</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Mostrar diagnósticos</span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>  diag_linear<span class="sc">$</span>scatter, diag_linear<span class="sc">$</span>residuos,</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>  diag_log<span class="sc">$</span>scatter, diag_log<span class="sc">$</span>residuos,</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">2</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lab3_ingenieria_caracteristicas_files/figure-html/visual_diagnostics-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  diag_power<span class="sc">$</span>scatter, diag_power<span class="sc">$</span>residuos,</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  diag_hetero<span class="sc">$</span>scatter, diag_hetero<span class="sc">$</span>residuos,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">2</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lab3_ingenieria_caracteristicas_files/figure-html/visual_diagnostics-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="tests-estadísticos-de-diagnóstico" class="level3">
<h3 class="anchored" data-anchor-id="tests-estadísticos-de-diagnóstico">Tests Estadísticos de Diagnóstico</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test de Breusch-Pagan para heterocedasticidad</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>test_hetero <span class="ot">&lt;-</span> <span class="cf">function</span>(modelo, nombre) {</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  bp_test <span class="ot">&lt;-</span> <span class="fu">ncvTest</span>(modelo)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"=== Test de Breusch-Pagan:"</span>, nombre, <span class="st">"===</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Chi-square:"</span>, <span class="fu">round</span>(bp_test<span class="sc">$</span>ChiSquare, <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"p-valor:"</span>, <span class="fu">round</span>(bp_test<span class="sc">$</span>p, <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(bp_test<span class="sc">$</span>p <span class="sc">&lt;</span> <span class="fl">0.05</span>) {</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Conclusión: Hay evidencia de heterocedasticidad</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Conclusión: No hay evidencia de heterocedasticidad</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Test de normalidad de residuos</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>test_normalidad <span class="ot">&lt;-</span> <span class="cf">function</span>(modelo, nombre) {</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  residuos <span class="ot">&lt;-</span> <span class="fu">residuals</span>(modelo)</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  sw_test <span class="ot">&lt;-</span> <span class="fu">shapiro.test</span>(residuos)</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"=== Test de Shapiro-Wilk:"</span>, nombre, <span class="st">"===</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"W:"</span>, <span class="fu">round</span>(sw_test<span class="sc">$</span>statistic, <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"p-valor:"</span>, <span class="fu">round</span>(sw_test<span class="sc">$</span>p.value, <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(sw_test<span class="sc">$</span>p.value <span class="sc">&lt;</span> <span class="fl">0.05</span>) {</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Conclusión: Los residuos no siguen distribución normal</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Conclusión: Los residuos siguen distribución normal</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Test RESET para forma funcional</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>test_reset <span class="ot">&lt;-</span> <span class="cf">function</span>(modelo, nombre) {</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>  reset_test <span class="ot">&lt;-</span> <span class="fu">resettest</span>(modelo)</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"=== Test RESET:"</span>, nombre, <span class="st">"===</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"F-statistic:"</span>, <span class="fu">round</span>(reset_test<span class="sc">$</span>statistic, <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"p-valor:"</span>, <span class="fu">round</span>(reset_test<span class="sc">$</span>p.value, <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(reset_test<span class="sc">$</span>p.value <span class="sc">&lt;</span> <span class="fl">0.05</span>) {</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Conclusión: La forma funcional es inadecuada</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Conclusión: La forma funcional es adecuada</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Aplicar tests a diferentes modelos</span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>modelo_lineal <span class="ot">&lt;-</span> <span class="fu">lm</span>(y_linear <span class="sc">~</span> x1, <span class="at">data =</span> datos_diagnostico)</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>modelo_log_prob <span class="ot">&lt;-</span> <span class="fu">lm</span>(y_log <span class="sc">~</span> x1, <span class="at">data =</span> datos_diagnostico)</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>modelo_power_prob <span class="ot">&lt;-</span> <span class="fu">lm</span>(y_power <span class="sc">~</span> x1, <span class="at">data =</span> datos_diagnostico)</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>modelo_hetero_prob <span class="ot">&lt;-</span> <span class="fu">lm</span>(y_hetero <span class="sc">~</span> x2, <span class="at">data =</span> datos_diagnostico)</span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a><span class="fu">test_hetero</span>(modelo_lineal, <span class="st">"Relación Lineal"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== Test de Breusch-Pagan: Relación Lineal ===
Chi-square: 0.0405 
p-valor: 0.8405 
Conclusión: No hay evidencia de heterocedasticidad</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_hetero</span>(modelo_hetero_prob, <span class="st">"Heterocedasticidad"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== Test de Breusch-Pagan: Heterocedasticidad ===
Chi-square: 120.5093 
p-valor: 0 
Conclusión: Hay evidencia de heterocedasticidad</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_normalidad</span>(modelo_lineal, <span class="st">"Relación Lineal"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== Test de Shapiro-Wilk: Relación Lineal ===
W: 0.9955 
p-valor: 0.8237 
Conclusión: Los residuos siguen distribución normal</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_normalidad</span>(modelo_log_prob, <span class="st">"Relación Logarítmica"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== Test de Shapiro-Wilk: Relación Logarítmica ===
W: 0.9929 
p-valor: 0.4455 
Conclusión: Los residuos siguen distribución normal</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressPackageStartupMessages</span>(<span class="fu">library</span>(lmtest))</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">test_reset</span>(modelo_lineal, <span class="st">"Relación Lineal"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== Test RESET: Relación Lineal ===
F-statistic: 0.0362 
p-valor: 0.9645 
Conclusión: La forma funcional es adecuada</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_reset</span>(modelo_log_prob, <span class="st">"Relación Logarítmica (sin transformar)"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== Test RESET: Relación Logarítmica (sin transformar) ===
F-statistic: 3.3254 
p-valor: 0.038 
Conclusión: La forma funcional es inadecuada</code></pre>
</div>
</div>
</section>
</section>
<section id="parte-2-escalado-y-normalización" class="level2">
<h2 class="anchored" data-anchor-id="parte-2-escalado-y-normalización">Parte 2: Escalado y Normalización</h2>
<section id="comparación-de-métodos-de-escalado" class="level3">
<h3 class="anchored" data-anchor-id="comparación-de-métodos-de-escalado">Comparación de Métodos de Escalado</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear datos con diferentes escalas</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>datos_escala <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">ingresos =</span> <span class="fu">rnorm</span>(<span class="dv">100</span>, <span class="dv">50000</span>, <span class="dv">15000</span>),      <span class="co"># Ingresos en euros</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">edad =</span> <span class="fu">rnorm</span>(<span class="dv">100</span>, <span class="dv">35</span>, <span class="dv">10</span>),                <span class="co"># Edad en años</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">puntuacion =</span> <span class="fu">rnorm</span>(<span class="dv">100</span>, <span class="fl">7.5</span>, <span class="fl">1.2</span>)        <span class="co"># Puntuación de 1-10</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Añadir algunos outliers</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>datos_escala<span class="sc">$</span>ingresos[<span class="fu">c</span>(<span class="dv">95</span><span class="sc">:</span><span class="dv">98</span>)] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">150000</span>, <span class="dv">180000</span>, <span class="dv">200000</span>, <span class="dv">250000</span>)</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>datos_escala<span class="sc">$</span>edad[<span class="fu">c</span>(<span class="dv">97</span><span class="sc">:</span><span class="dv">100</span>)] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">70</span>, <span class="dv">75</span>, <span class="dv">80</span>, <span class="dv">85</span>)</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Aplicar diferentes métodos de escalado</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>datos_escalados <span class="ot">&lt;-</span> datos_escala <span class="sc">%&gt;%</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Estandarización (Z-score)</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">ingresos_std =</span> <span class="fu">scale</span>(ingresos)[,<span class="dv">1</span>],</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">edad_std =</span> <span class="fu">scale</span>(edad)[,<span class="dv">1</span>],</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">puntuacion_std =</span> <span class="fu">scale</span>(puntuacion)[,<span class="dv">1</span>],</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Normalización Min-Max</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">ingresos_norm =</span> (ingresos <span class="sc">-</span> <span class="fu">min</span>(ingresos)) <span class="sc">/</span> (<span class="fu">max</span>(ingresos) <span class="sc">-</span> <span class="fu">min</span>(ingresos)),</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">edad_norm =</span> (edad <span class="sc">-</span> <span class="fu">min</span>(edad)) <span class="sc">/</span> (<span class="fu">max</span>(edad) <span class="sc">-</span> <span class="fu">min</span>(edad)),</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">puntuacion_norm =</span> (puntuacion <span class="sc">-</span> <span class="fu">min</span>(puntuacion)) <span class="sc">/</span> (<span class="fu">max</span>(puntuacion) <span class="sc">-</span> <span class="fu">min</span>(puntuacion)),</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Escalado robusto</span></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">ingresos_rob =</span> (ingresos <span class="sc">-</span> <span class="fu">median</span>(ingresos)) <span class="sc">/</span> <span class="fu">IQR</span>(ingresos),</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">edad_rob =</span> (edad <span class="sc">-</span> <span class="fu">median</span>(edad)) <span class="sc">/</span> <span class="fu">IQR</span>(edad),</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">puntuacion_rob =</span> (puntuacion <span class="sc">-</span> <span class="fu">median</span>(puntuacion)) <span class="sc">/</span> <span class="fu">IQR</span>(puntuacion)</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear tabla comparativa</span></span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>crear_tabla_escalado <span class="ot">&lt;-</span> <span class="cf">function</span>(variable, nombre) {</span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>  original <span class="ot">&lt;-</span> datos_escalados[[variable]]</span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>  std <span class="ot">&lt;-</span> datos_escalados[[<span class="fu">paste0</span>(variable, <span class="st">"_std"</span>)]]</span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>  norm <span class="ot">&lt;-</span> datos_escalados[[<span class="fu">paste0</span>(variable, <span class="st">"_norm"</span>)]]</span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a>  rob <span class="ot">&lt;-</span> datos_escalados[[<span class="fu">paste0</span>(variable, <span class="st">"_rob"</span>)]]</span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">Variable =</span> nombre,</span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a>    Método <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Original"</span>, <span class="st">"Estandarización"</span>, <span class="st">"Min-Max"</span>, <span class="st">"Robusto"</span>),</span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">Media =</span> <span class="fu">round</span>(<span class="fu">c</span>(<span class="fu">mean</span>(original), <span class="fu">mean</span>(std), <span class="fu">mean</span>(norm), <span class="fu">median</span>(rob)), <span class="dv">3</span>),</span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">Desviacion =</span> <span class="fu">round</span>(<span class="fu">c</span>(<span class="fu">sd</span>(original), <span class="fu">sd</span>(std), <span class="fu">sd</span>(norm), <span class="fu">mad</span>(rob)), <span class="dv">3</span>),</span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">Minimo =</span> <span class="fu">round</span>(<span class="fu">c</span>(<span class="fu">min</span>(original), <span class="fu">min</span>(std), <span class="fu">min</span>(norm), <span class="fu">min</span>(rob)), <span class="dv">3</span>),</span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">Maximo =</span> <span class="fu">round</span>(<span class="fu">c</span>(<span class="fu">max</span>(original), <span class="fu">max</span>(std), <span class="fu">max</span>(norm), <span class="fu">max</span>(rob)), <span class="dv">3</span>),</span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">Q25 =</span> <span class="fu">round</span>(<span class="fu">c</span>(<span class="fu">quantile</span>(original, <span class="fl">0.25</span>), <span class="fu">quantile</span>(std, <span class="fl">0.25</span>), </span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">quantile</span>(norm, <span class="fl">0.25</span>), <span class="fu">quantile</span>(rob, <span class="fl">0.25</span>)), <span class="dv">3</span>),</span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">Q75 =</span> <span class="fu">round</span>(<span class="fu">c</span>(<span class="fu">quantile</span>(original, <span class="fl">0.75</span>), <span class="fu">quantile</span>(std, <span class="fl">0.75</span>), </span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">quantile</span>(norm, <span class="fl">0.75</span>), <span class="fu">quantile</span>(rob, <span class="fl">0.75</span>)), <span class="dv">3</span>)</span>
<span id="cb18-49"><a href="#cb18-49" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb18-50"><a href="#cb18-50" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-51"><a href="#cb18-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-52"><a href="#cb18-52" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear tablas para cada variable</span></span>
<span id="cb18-53"><a href="#cb18-53" aria-hidden="true" tabindex="-1"></a>tabla_ingresos <span class="ot">&lt;-</span> <span class="fu">crear_tabla_escalado</span>(<span class="st">"ingresos"</span>, <span class="st">"Ingresos"</span>)</span>
<span id="cb18-54"><a href="#cb18-54" aria-hidden="true" tabindex="-1"></a>tabla_edad <span class="ot">&lt;-</span> <span class="fu">crear_tabla_escalado</span>(<span class="st">"edad"</span>, <span class="st">"Edad"</span>)</span>
<span id="cb18-55"><a href="#cb18-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-56"><a href="#cb18-56" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(tabla_ingresos, <span class="at">caption =</span> <span class="st">"Comparación de métodos de escalado - Ingresos"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Comparación de métodos de escalado - Ingresos</caption>
<colgroup>
<col style="width: 10%">
<col style="width: 18%">
<col style="width: 11%">
<col style="width: 12%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Variable</th>
<th style="text-align: left;">Método</th>
<th style="text-align: right;">Media</th>
<th style="text-align: right;">Desviacion</th>
<th style="text-align: right;">Minimo</th>
<th style="text-align: right;">Maximo</th>
<th style="text-align: right;">Q25</th>
<th style="text-align: right;">Q75</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Ingresos</td>
<td style="text-align: left;">Original</td>
<td style="text-align: right;">57009.846</td>
<td style="text-align: right;">33021.878</td>
<td style="text-align: right;">16269.649</td>
<td style="text-align: right;">2.500e+05</td>
<td style="text-align: right;">41654.706</td>
<td style="text-align: right;">63714.607</td>
</tr>
<tr class="even">
<td style="text-align: left;">Ingresos</td>
<td style="text-align: left;">Estandarización</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: right;">-1.234</td>
<td style="text-align: right;">5.844e+00</td>
<td style="text-align: right;">-0.465</td>
<td style="text-align: right;">0.203</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Ingresos</td>
<td style="text-align: left;">Min-Max</td>
<td style="text-align: right;">0.174</td>
<td style="text-align: right;">0.141</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">1.000e+00</td>
<td style="text-align: right;">0.109</td>
<td style="text-align: right;">0.203</td>
</tr>
<tr class="even">
<td style="text-align: left;">Ingresos</td>
<td style="text-align: left;">Robusto</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.772</td>
<td style="text-align: right;">-1.604</td>
<td style="text-align: right;">8.991e+00</td>
<td style="text-align: right;">-0.454</td>
<td style="text-align: right;">0.546</td>
</tr>
</tbody>
</table>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(tabla_edad, <span class="at">caption =</span> <span class="st">"Comparación de métodos de escalado - Edad"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Comparación de métodos de escalado - Edad</caption>
<colgroup>
<col style="width: 12%">
<col style="width: 22%">
<col style="width: 9%">
<col style="width: 15%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Variable</th>
<th style="text-align: left;">Método</th>
<th style="text-align: right;">Media</th>
<th style="text-align: right;">Desviacion</th>
<th style="text-align: right;">Minimo</th>
<th style="text-align: right;">Maximo</th>
<th style="text-align: right;">Q25</th>
<th style="text-align: right;">Q75</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Edad</td>
<td style="text-align: left;">Original</td>
<td style="text-align: right;">36.160</td>
<td style="text-align: right;">13.760</td>
<td style="text-align: right;">4.521</td>
<td style="text-align: right;">85.000</td>
<td style="text-align: right;">26.891</td>
<td style="text-align: right;">44.055</td>
</tr>
<tr class="even">
<td style="text-align: left;">Edad</td>
<td style="text-align: left;">Estandarización</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: right;">-2.299</td>
<td style="text-align: right;">3.549</td>
<td style="text-align: right;">-0.674</td>
<td style="text-align: right;">0.574</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Edad</td>
<td style="text-align: left;">Min-Max</td>
<td style="text-align: right;">0.393</td>
<td style="text-align: right;">0.171</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: right;">0.278</td>
<td style="text-align: right;">0.491</td>
</tr>
<tr class="even">
<td style="text-align: left;">Edad</td>
<td style="text-align: left;">Robusto</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.754</td>
<td style="text-align: right;">-1.781</td>
<td style="text-align: right;">2.908</td>
<td style="text-align: right;">-0.477</td>
<td style="text-align: right;">0.523</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="visualización-del-impacto-del-escalado" class="level3">
<h3 class="anchored" data-anchor-id="visualización-del-impacto-del-escalado">Visualización del Impacto del Escalado</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear versión larga para visualización</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>datos_viz <span class="ot">&lt;-</span> datos_escalados <span class="sc">%&gt;%</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(ingresos, ingresos_std, ingresos_norm, ingresos_rob) <span class="sc">%&gt;%</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>id, <span class="at">names_to =</span> <span class="st">"método"</span>, <span class="at">values_to =</span> <span class="st">"valor"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(método <span class="ot">=</span> <span class="fu">factor</span>(método, </span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>                        <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"ingresos"</span>, <span class="st">"ingresos_std"</span>, <span class="st">"ingresos_norm"</span>, <span class="st">"ingresos_rob"</span>),</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>                        <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Original"</span>, <span class="st">"Estandarización"</span>, <span class="st">"Min-Max"</span>, <span class="st">"Robusto"</span>)))</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Boxplots comparativos</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(datos_viz, <span class="fu">aes</span>(<span class="at">x =</span> método, <span class="at">y =</span> valor, <span class="at">fill =</span> método)) <span class="sc">+</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Comparación de Métodos de Escalado"</span>,</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Efecto en la distribución de Ingresos"</span>,</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Método de Escalado"</span>, <span class="at">y =</span> <span class="st">"Valores Transformados"</span>) <span class="sc">+</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lab3_ingenieria_caracteristicas_files/figure-html/scaling_visualization-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Densidades superpuestas</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(datos_viz, <span class="fu">aes</span>(<span class="at">x =</span> valor, <span class="at">fill =</span> método)) <span class="sc">+</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>método, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribuciones después del Escalado"</span>,</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Valores"</span>, <span class="at">y =</span> <span class="st">"Densidad"</span>) <span class="sc">+</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lab3_ingenieria_caracteristicas_files/figure-html/scaling_visualization-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="parte-3-transformaciones-clásicas" class="level2">
<h2 class="anchored" data-anchor-id="parte-3-transformaciones-clásicas">Parte 3: Transformaciones Clásicas</h2>
<section id="transformación-logarítmica" class="level3">
<h3 class="anchored" data-anchor-id="transformación-logarítmica">Transformación Logarítmica</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Datos con relación exponencial y heterocedasticidad multiplicativa</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">150</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>x_exp <span class="ot">&lt;-</span> <span class="fu">runif</span>(n, <span class="dv">1</span>, <span class="dv">10</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>y_exp <span class="ot">&lt;-</span> <span class="dv">5</span> <span class="sc">*</span> <span class="fu">exp</span>(<span class="fl">0.3</span> <span class="sc">*</span> x_exp) <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">2</span> <span class="sc">*</span> <span class="fu">exp</span>(<span class="fl">0.15</span> <span class="sc">*</span> x_exp))</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>datos_exp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> x_exp, <span class="at">y =</span> y_exp)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Modelo original (problemático)</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>modelo_original <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> datos_exp)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformación logarítmica de Y</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>datos_exp<span class="sc">$</span>log_y <span class="ot">&lt;-</span> <span class="fu">log</span>(datos_exp<span class="sc">$</span>y)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>modelo_log_y <span class="ot">&lt;-</span> <span class="fu">lm</span>(log_y <span class="sc">~</span> x, <span class="at">data =</span> datos_exp)</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformación logarítmica de ambas variables</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>datos_exp<span class="sc">$</span>log_x <span class="ot">&lt;-</span> <span class="fu">log</span>(datos_exp<span class="sc">$</span>x)</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>modelo_log_log <span class="ot">&lt;-</span> <span class="fu">lm</span>(log_y <span class="sc">~</span> log_x, <span class="at">data =</span> datos_exp)</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Comparar modelos</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== COMPARACIÓN DE MODELOS CON TRANSFORMACIÓN LOGARÍTMICA ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== COMPARACIÓN DE MODELOS CON TRANSFORMACIÓN LOGARÍTMICA ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Modelo original - R²:"</span>, <span class="fu">round</span>(<span class="fu">summary</span>(modelo_original)<span class="sc">$</span>r.squared, <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Modelo original - R²: 0.892 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Modelo log-lineal - R²:"</span>, <span class="fu">round</span>(<span class="fu">summary</span>(modelo_log_y)<span class="sc">$</span>r.squared, <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Modelo log-lineal - R²: 0.9345 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Modelo log-log - R²:"</span>, <span class="fu">round</span>(<span class="fu">summary</span>(modelo_log_log)<span class="sc">$</span>r.squared, <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Modelo log-log - R²: 0.8679 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Diagnósticos de heterocedasticidad</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">test_hetero</span>(modelo_original, <span class="st">"Original"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== Test de Breusch-Pagan: Original ===
Chi-square: 9.0689 
p-valor: 0.0026 
Conclusión: Hay evidencia de heterocedasticidad</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_hetero</span>(modelo_log_y, <span class="st">"Log-Lineal"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== Test de Breusch-Pagan: Log-Lineal ===
Chi-square: 52.2872 
p-valor: 0 
Conclusión: Hay evidencia de heterocedasticidad</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualización de transformaciones</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(datos_exp, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Modelo Original"</span>, <span class="at">x =</span> <span class="st">"X"</span>, <span class="at">y =</span> <span class="st">"Y"</span>) <span class="sc">+</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(datos_exp, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> log_y)) <span class="sc">+</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Transformación Log(Y)"</span>, <span class="at">x =</span> <span class="st">"X"</span>, <span class="at">y =</span> <span class="st">"Log(Y)"</span>) <span class="sc">+</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(datos_exp, <span class="fu">aes</span>(<span class="at">x =</span> log_x, <span class="at">y =</span> log_y)) <span class="sc">+</span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Transformación Log-Log"</span>, <span class="at">x =</span> <span class="st">"Log(X)"</span>, <span class="at">y =</span> <span class="st">"Log(Y)"</span>) <span class="sc">+</span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p1, p2, p3, <span class="at">ncol =</span> <span class="dv">3</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lab3_ingenieria_caracteristicas_files/figure-html/log_transformation-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="interpretación-de-coeficientes-transformados" class="level3">
<h3 class="anchored" data-anchor-id="interpretación-de-coeficientes-transformados">Interpretación de Coeficientes Transformados</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraer coeficientes para interpretación</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>coef_log_y <span class="ot">&lt;-</span> <span class="fu">coef</span>(modelo_log_y)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>coef_log_log <span class="ot">&lt;-</span> <span class="fu">coef</span>(modelo_log_log)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== INTERPRETACIÓN DE COEFICIENTES ===</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== INTERPRETACIÓN DE COEFICIENTES ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"MODELO LOG-LINEAL: log(Y) = β₀ + β₁X</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>MODELO LOG-LINEAL: log(Y) = β₀ + β₁X</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Intercepto:"</span>, <span class="fu">round</span>(coef_log_y[<span class="dv">1</span>], <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Intercepto: 1.5641 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Pendiente:"</span>, <span class="fu">round</span>(coef_log_y[<span class="dv">2</span>], <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Pendiente: 0.3058 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Interpretación: Un aumento de 1 unidad en X se asocia con un cambio de"</span>, </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">round</span>(coef_log_y[<span class="dv">2</span>]<span class="sc">*</span><span class="dv">100</span>, <span class="dv">2</span>), <span class="st">"% en Y</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Interpretación: Un aumento de 1 unidad en X se asocia con un cambio de 30.58 % en Y</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"MODELO LOG-LOG: log(Y) = β₀ + β₁log(X)</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>MODELO LOG-LOG: log(Y) = β₀ + β₁log(X)</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Intercepto:"</span>, <span class="fu">round</span>(coef_log_log[<span class="dv">1</span>], <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Intercepto: 1.2842 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Pendiente (elasticidad):"</span>, <span class="fu">round</span>(coef_log_log[<span class="dv">2</span>], <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Pendiente (elasticidad): 1.2843 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Interpretación: Un aumento de 1% en X se asocia con un cambio de"</span>, </span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">round</span>(coef_log_log[<span class="dv">2</span>], <span class="dv">2</span>), <span class="st">"% en Y</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Interpretación: Un aumento de 1% en X se asocia con un cambio de 1.28 % en Y</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ejemplo de predicción con retransformación</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>x_nuevo <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>pred_log_y <span class="ot">&lt;-</span> <span class="fu">predict</span>(modelo_log_y, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">x =</span> x_nuevo))</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>pred_original <span class="ot">&lt;-</span> <span class="fu">exp</span>(pred_log_y)</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"EJEMPLO DE PREDICCIÓN:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>EJEMPLO DE PREDICCIÓN:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Para X ="</span>, x_nuevo, <span class="st">":</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Para X = 5 :</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Log(Y) predicho:"</span>, <span class="fu">round</span>(pred_log_y, <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Log(Y) predicho: 3.093 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Y predicho (retransformado):"</span>, <span class="fu">round</span>(pred_original, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Y predicho (retransformado): 22.04 </code></pre>
</div>
</div>
</section>
<section id="transformación-de-raíz-cuadrada" class="level3">
<h3 class="anchored" data-anchor-id="transformación-de-raíz-cuadrada">Transformación de Raíz Cuadrada</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Datos de conteo con varianza proporcional a la media (Poisson-like)</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">120</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>x_count <span class="ot">&lt;-</span> <span class="fu">runif</span>(n, <span class="dv">1</span>, <span class="dv">20</span>)</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>lambda <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">+</span> <span class="fl">0.5</span> <span class="sc">*</span> x_count  <span class="co"># Media de Poisson variable</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>y_count <span class="ot">&lt;-</span> <span class="fu">rpois</span>(n, lambda)</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>datos_count <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> x_count, <span class="at">y =</span> y_count)</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Verificar relación varianza-media</span></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>grupos <span class="ot">&lt;-</span> <span class="fu">cut</span>(datos_count<span class="sc">$</span>x, <span class="at">breaks =</span> <span class="dv">4</span>)</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>media_por_grupo <span class="ot">&lt;-</span> <span class="fu">tapply</span>(datos_count<span class="sc">$</span>y, grupos, mean)</span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>var_por_grupo <span class="ot">&lt;-</span> <span class="fu">tapply</span>(datos_count<span class="sc">$</span>y, grupos, var)</span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== DIAGNÓSTICO VARIANZA-MEDIA ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== DIAGNÓSTICO VARIANZA-MEDIA ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>tabla_var_media <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Grupo =</span> <span class="fu">names</span>(media_por_grupo),</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Media =</span> <span class="fu">round</span>(media_por_grupo, <span class="dv">2</span>),</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Varianza =</span> <span class="fu">round</span>(var_por_grupo, <span class="dv">2</span>),</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Ratio_Var_Media =</span> <span class="fu">round</span>(var_por_grupo <span class="sc">/</span> media_por_grupo, <span class="dv">2</span>)</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(tabla_var_media, <span class="at">caption =</span> <span class="st">"Relación Varianza-Media por grupos"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Relación Varianza-Media por grupos</caption>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">Grupo</th>
<th style="text-align: right;">Media</th>
<th style="text-align: right;">Varianza</th>
<th style="text-align: right;">Ratio_Var_Media</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(1.17,5.84]</td>
<td style="text-align: left;">(1.17,5.84]</td>
<td style="text-align: right;">3.59</td>
<td style="text-align: right;">4.03</td>
<td style="text-align: right;">1.12</td>
</tr>
<tr class="even">
<td style="text-align: left;">(5.84,10.5]</td>
<td style="text-align: left;">(5.84,10.5]</td>
<td style="text-align: right;">7.00</td>
<td style="text-align: right;">11.20</td>
<td style="text-align: right;">1.60</td>
</tr>
<tr class="odd">
<td style="text-align: left;">(10.5,15.1]</td>
<td style="text-align: left;">(10.5,15.1]</td>
<td style="text-align: right;">9.00</td>
<td style="text-align: right;">6.89</td>
<td style="text-align: right;">0.77</td>
</tr>
<tr class="even">
<td style="text-align: left;">(15.1,19.8]</td>
<td style="text-align: left;">(15.1,19.8]</td>
<td style="text-align: right;">10.58</td>
<td style="text-align: right;">8.43</td>
<td style="text-align: right;">0.80</td>
</tr>
</tbody>
</table>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Modelo original</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>modelo_count_orig <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> datos_count)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformación raíz cuadrada</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>datos_count<span class="sc">$</span>sqrt_y <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(datos_count<span class="sc">$</span>y)</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>modelo_sqrt <span class="ot">&lt;-</span> <span class="fu">lm</span>(sqrt_y <span class="sc">~</span> x, <span class="at">data =</span> datos_count)</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Comparar heterocedasticidad</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a><span class="fu">test_hetero</span>(modelo_count_orig, <span class="st">"Datos de Conteo Original"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== Test de Breusch-Pagan: Datos de Conteo Original ===
Chi-square: 1.6373 
p-valor: 0.2007 
Conclusión: No hay evidencia de heterocedasticidad</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_hetero</span>(modelo_sqrt, <span class="st">"Datos con Transformación √Y"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== Test de Breusch-Pagan: Datos con Transformación √Y ===
Chi-square: 4.2819 
p-valor: 0.0385 
Conclusión: Hay evidencia de heterocedasticidad</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualización</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(datos_count, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Datos Originales"</span>, <span class="at">x =</span> <span class="st">"X"</span>, <span class="at">y =</span> <span class="st">"Y (conteos)"</span>) <span class="sc">+</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(datos_count, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> sqrt_y)) <span class="sc">+</span></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Transformación √Y"</span>, <span class="at">x =</span> <span class="st">"X"</span>, <span class="at">y =</span> <span class="st">"√Y"</span>) <span class="sc">+</span></span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráficos de residuos</span></span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a>residuos_orig <span class="ot">&lt;-</span> <span class="fu">residuals</span>(modelo_count_orig)</span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a>residuos_sqrt <span class="ot">&lt;-</span> <span class="fu">residuals</span>(modelo_sqrt)</span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a>ajustados_orig <span class="ot">&lt;-</span> <span class="fu">fitted</span>(modelo_count_orig)</span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a>ajustados_sqrt <span class="ot">&lt;-</span> <span class="fu">fitted</span>(modelo_sqrt)</span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">x =</span> ajustados_orig, <span class="at">y =</span> residuos_orig), <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb68-22"><a href="#cb68-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb68-23"><a href="#cb68-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb68-24"><a href="#cb68-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Residuos - Original"</span>, <span class="at">x =</span> <span class="st">"Ajustados"</span>, <span class="at">y =</span> <span class="st">"Residuos"</span>) <span class="sc">+</span></span>
<span id="cb68-25"><a href="#cb68-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb68-26"><a href="#cb68-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-27"><a href="#cb68-27" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">x =</span> ajustados_sqrt, <span class="at">y =</span> residuos_sqrt), <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb68-28"><a href="#cb68-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb68-29"><a href="#cb68-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb68-30"><a href="#cb68-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb68-31"><a href="#cb68-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Residuos - √Y"</span>, <span class="at">x =</span> <span class="st">"Ajustados"</span>, <span class="at">y =</span> <span class="st">"Residuos"</span>) <span class="sc">+</span></span>
<span id="cb68-32"><a href="#cb68-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb68-33"><a href="#cb68-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-34"><a href="#cb68-34" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p1, p2, p3, p4, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lab3_ingenieria_caracteristicas_files/figure-html/sqrt_transformation-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="parte-4-transformaciones-avanzadas---box-cox" class="level2">
<h2 class="anchored" data-anchor-id="parte-4-transformaciones-avanzadas---box-cox">Parte 4: Transformaciones Avanzadas - Box-Cox</h2>
<section id="implementación-de-box-cox" class="level3">
<h3 class="anchored" data-anchor-id="implementación-de-box-cox">Implementación de Box-Cox</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Datos con distribución asimétrica</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">150</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>x_bc <span class="ot">&lt;-</span> <span class="fu">runif</span>(n, <span class="dv">1</span>, <span class="dv">10</span>)</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Variable respuesta con asimetría positiva</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>y_bc <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">*</span>x_bc<span class="sc">^</span><span class="fl">1.5</span> <span class="sc">+</span> <span class="fu">rgamma</span>(n, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>datos_bc <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> x_bc, <span class="at">y =</span> y_bc)</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Análisis de distribución original</span></span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(datos_bc, <span class="fu">aes</span>(<span class="at">x =</span> y)) <span class="sc">+</span></span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">20</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">fill =</span> <span class="st">"lightblue"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribución Original de Y"</span>, <span class="at">x =</span> <span class="st">"Y"</span>, <span class="at">y =</span> <span class="st">"Frecuencia"</span>) <span class="sc">+</span></span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(datos_bc, <span class="fu">aes</span>(<span class="at">sample =</span> y)) <span class="sc">+</span></span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_qq</span>() <span class="sc">+</span></span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_qq_line</span>(<span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Q-Q Plot Original"</span>, <span class="at">x =</span> <span class="st">"Cuantiles Teóricos"</span>, <span class="at">y =</span> <span class="st">"Cuantiles Muestra"</span>) <span class="sc">+</span></span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p1, p2, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lab3_ingenieria_caracteristicas_files/figure-html/boxcox_implementation-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Aplicar transformación Box-Cox</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>modelo_bc_orig <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> datos_bc)</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Buscar lambda óptimo</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>bc_result <span class="ot">&lt;-</span> <span class="fu">boxcox</span>(modelo_bc_orig, <span class="at">plotit =</span> <span class="cn">TRUE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lab3_ingenieria_caracteristicas_files/figure-html/boxcox_implementation-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>lambda_optimo <span class="ot">&lt;-</span> bc_result<span class="sc">$</span>x[<span class="fu">which.max</span>(bc_result<span class="sc">$</span>y)]</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== TRANSFORMACIÓN BOX-COX ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== TRANSFORMACIÓN BOX-COX ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Lambda óptimo:"</span>, <span class="fu">round</span>(lambda_optimo, <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Lambda óptimo: 0.6263 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Interpretar lambda</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">abs</span>(lambda_optimo <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">&lt;</span> <span class="fl">0.1</span>) {</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Interpretación: Sin transformación (λ ≈ 1)</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span>(<span class="fu">abs</span>(lambda_optimo <span class="sc">-</span> <span class="fl">0.5</span>) <span class="sc">&lt;</span> <span class="fl">0.1</span>) {</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Interpretación: Transformación de raíz cuadrada (λ ≈ 0.5)</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span>(<span class="fu">abs</span>(lambda_optimo <span class="sc">-</span> <span class="dv">0</span>) <span class="sc">&lt;</span> <span class="fl">0.1</span>) {</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Interpretación: Transformación logarítmica (λ ≈ 0)</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span>(<span class="fu">abs</span>(lambda_optimo <span class="sc">-</span> (<span class="sc">-</span><span class="dv">1</span>)) <span class="sc">&lt;</span> <span class="fl">0.1</span>) {</span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Interpretación: Transformación inversa (λ ≈ -1)</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Interpretación: Transformación de potencia con λ ="</span>, <span class="fu">round</span>(lambda_optimo, <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Interpretación: Transformación de potencia con λ = 0.626 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Aplicar transformación</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">abs</span>(lambda_optimo) <span class="sc">&lt;</span> <span class="fl">0.01</span>) {</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>  datos_bc<span class="sc">$</span>y_bc <span class="ot">&lt;-</span> <span class="fu">log</span>(datos_bc<span class="sc">$</span>y)</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>  datos_bc<span class="sc">$</span>y_bc <span class="ot">&lt;-</span> (datos_bc<span class="sc">$</span>y<span class="sc">^</span>lambda_optimo <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">/</span> lambda_optimo</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Modelo con variable transformada</span></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>modelo_bc_trans <span class="ot">&lt;-</span> <span class="fu">lm</span>(y_bc <span class="sc">~</span> x, <span class="at">data =</span> datos_bc)</span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Comparar modelos</span></span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Comparación de modelos:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Comparación de modelos:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"R² original:"</span>, <span class="fu">round</span>(<span class="fu">summary</span>(modelo_bc_orig)<span class="sc">$</span>r.squared, <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>R² original: 0.9796 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"R² transformado:"</span>, <span class="fu">round</span>(<span class="fu">summary</span>(modelo_bc_trans)<span class="sc">$</span>r.squared, <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>R² transformado: 0.9895 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tests de normalidad</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="fu">test_normalidad</span>(modelo_bc_orig, <span class="st">"Original"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== Test de Shapiro-Wilk: Original ===
W: 0.9484 
p-valor: 0 
Conclusión: Los residuos no siguen distribución normal</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_normalidad</span>(modelo_bc_trans, <span class="st">"Box-Cox"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== Test de Shapiro-Wilk: Box-Cox ===
W: 0.8892 
p-valor: 0 
Conclusión: Los residuos no siguen distribución normal</code></pre>
</div>
</div>
</section>
<section id="análisis-post-transformación" class="level3">
<h3 class="anchored" data-anchor-id="análisis-post-transformación">Análisis Post-Transformación</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Distribución después de transformación</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(datos_bc, <span class="fu">aes</span>(<span class="at">x =</span> y_bc)) <span class="sc">+</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">20</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">fill =</span> <span class="st">"lightgreen"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribución Después de Box-Cox"</span>, <span class="at">x =</span> <span class="st">"Y Transformada"</span>, <span class="at">y =</span> <span class="st">"Frecuencia"</span>) <span class="sc">+</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(datos_bc, <span class="fu">aes</span>(<span class="at">sample =</span> y_bc)) <span class="sc">+</span></span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_qq</span>() <span class="sc">+</span></span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_qq_line</span>(<span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Q-Q Plot Después de Box-Cox"</span>, <span class="at">x =</span> <span class="st">"Cuantiles Teóricos"</span>, <span class="at">y =</span> <span class="st">"Cuantiles Muestra"</span>) <span class="sc">+</span></span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p3, p4, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lab3_ingenieria_caracteristicas_files/figure-html/boxcox_analysis-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráficos de regresión</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>p5 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(datos_bc, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Regresión Original"</span>, <span class="at">x =</span> <span class="st">"X"</span>, <span class="at">y =</span> <span class="st">"Y"</span>) <span class="sc">+</span></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>p6 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(datos_bc, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y_bc)) <span class="sc">+</span></span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Regresión con Box-Cox"</span>, <span class="at">x =</span> <span class="st">"X"</span>, <span class="at">y =</span> <span class="st">"Y Transformada"</span>) <span class="sc">+</span></span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p5, p6, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lab3_ingenieria_caracteristicas_files/figure-html/boxcox_analysis-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Interpretación y predicción con retransformación</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>coef_bc <span class="ot">&lt;-</span> <span class="fu">coef</span>(modelo_bc_trans)</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>x_pred <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>y_trans_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(modelo_bc_trans, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">x =</span> x_pred))</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Retransformación (aproximación)</span></span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">abs</span>(lambda_optimo) <span class="sc">&lt;</span> <span class="fl">0.01</span>) {</span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>  y_orig_pred <span class="ot">&lt;-</span> <span class="fu">exp</span>(y_trans_pred)</span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a>  y_orig_pred <span class="ot">&lt;-</span> (lambda_optimo <span class="sc">*</span> y_trans_pred <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span>lambda_optimo)</span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== PREDICCIÓN CON RETRANSFORMACIÓN ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== PREDICCIÓN CON RETRANSFORMACIÓN ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Para X ="</span>, x_pred, <span class="st">":</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Para X = 5 :</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Y transformada predicha:"</span>, <span class="fu">round</span>(y_trans_pred, <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Y transformada predicha: 10.1962 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Y original predicha (retransformada):"</span>, <span class="fu">round</span>(y_orig_pred, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Y original predicha (retransformada): 24.36 </code></pre>
</div>
</div>
</section>
</section>
<section id="parte-5-tratamiento-de-variables-categóricas" class="level2">
<h2 class="anchored" data-anchor-id="parte-5-tratamiento-de-variables-categóricas">Parte 5: Tratamiento de Variables Categóricas</h2>
<section id="one-hot-encoding-vs-codificación-ordinal" class="level3">
<h3 class="anchored" data-anchor-id="one-hot-encoding-vs-codificación-ordinal">One-Hot Encoding vs Codificación Ordinal</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear dataset con variables categóricas variadas</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">456</span>)</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>datos_cat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Variable ordinal</span></span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">educacion =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"Primaria"</span>, <span class="st">"Secundaria"</span>, <span class="st">"Universidad"</span>, <span class="st">"Posgrado"</span>), </span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>                    n, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.4</span>, <span class="fl">0.1</span>)),</span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Variable nominal</span></span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">region =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"Norte"</span>, <span class="st">"Sur"</span>, <span class="st">"Este"</span>, <span class="st">"Oeste"</span>), </span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true" tabindex="-1"></a>                 n, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.2</span>)),</span>
<span id="cb97-13"><a href="#cb97-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb97-14"><a href="#cb97-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Variable binaria</span></span>
<span id="cb97-15"><a href="#cb97-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">genero =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"M"</span>, <span class="st">"F"</span>), n, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb97-16"><a href="#cb97-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb97-17"><a href="#cb97-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Variables numéricas</span></span>
<span id="cb97-18"><a href="#cb97-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">experiencia =</span> <span class="fu">round</span>(<span class="fu">runif</span>(n, <span class="dv">0</span>, <span class="dv">20</span>)),</span>
<span id="cb97-19"><a href="#cb97-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">edad =</span> <span class="fu">round</span>(<span class="fu">rnorm</span>(n, <span class="dv">35</span>, <span class="dv">8</span>))</span>
<span id="cb97-20"><a href="#cb97-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb97-21"><a href="#cb97-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-22"><a href="#cb97-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear variable respuesta que depende de las categóricas</span></span>
<span id="cb97-23"><a href="#cb97-23" aria-hidden="true" tabindex="-1"></a>salario_base <span class="ot">&lt;-</span> <span class="dv">30000</span></span>
<span id="cb97-24"><a href="#cb97-24" aria-hidden="true" tabindex="-1"></a>efecto_educacion <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Primaria"</span> <span class="ot">=</span> <span class="dv">0</span>, <span class="st">"Secundaria"</span> <span class="ot">=</span> <span class="dv">5000</span>, </span>
<span id="cb97-25"><a href="#cb97-25" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Universidad"</span> <span class="ot">=</span> <span class="dv">15000</span>, <span class="st">"Posgrado"</span> <span class="ot">=</span> <span class="dv">25000</span>)</span>
<span id="cb97-26"><a href="#cb97-26" aria-hidden="true" tabindex="-1"></a>efecto_region <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Norte"</span> <span class="ot">=</span> <span class="dv">2000</span>, <span class="st">"Sur"</span> <span class="ot">=</span> <span class="dv">0</span>, <span class="st">"Este"</span> <span class="ot">=</span> <span class="dv">1000</span>, <span class="st">"Oeste"</span> <span class="ot">=</span> <span class="dv">1500</span>)</span>
<span id="cb97-27"><a href="#cb97-27" aria-hidden="true" tabindex="-1"></a>efecto_genero <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"M"</span> <span class="ot">=</span> <span class="dv">3000</span>, <span class="st">"F"</span> <span class="ot">=</span> <span class="dv">0</span>)</span>
<span id="cb97-28"><a href="#cb97-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-29"><a href="#cb97-29" aria-hidden="true" tabindex="-1"></a>datos_cat<span class="sc">$</span>salario <span class="ot">&lt;-</span> salario_base <span class="sc">+</span> </span>
<span id="cb97-30"><a href="#cb97-30" aria-hidden="true" tabindex="-1"></a>  efecto_educacion[datos_cat<span class="sc">$</span>educacion] <span class="sc">+</span></span>
<span id="cb97-31"><a href="#cb97-31" aria-hidden="true" tabindex="-1"></a>  efecto_region[datos_cat<span class="sc">$</span>region] <span class="sc">+</span></span>
<span id="cb97-32"><a href="#cb97-32" aria-hidden="true" tabindex="-1"></a>  efecto_genero[datos_cat<span class="sc">$</span>genero] <span class="sc">+</span></span>
<span id="cb97-33"><a href="#cb97-33" aria-hidden="true" tabindex="-1"></a>  <span class="dv">500</span> <span class="sc">*</span> datos_cat<span class="sc">$</span>experiencia <span class="sc">+</span></span>
<span id="cb97-34"><a href="#cb97-34" aria-hidden="true" tabindex="-1"></a>  <span class="dv">200</span> <span class="sc">*</span> datos_cat<span class="sc">$</span>edad <span class="sc">+</span></span>
<span id="cb97-35"><a href="#cb97-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">5000</span>)</span>
<span id="cb97-36"><a href="#cb97-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-37"><a href="#cb97-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Resumen de los datos categóricos</span></span>
<span id="cb97-38"><a href="#cb97-38" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== DISTRIBUCIÓN DE VARIABLES CATEGÓRICAS ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== DISTRIBUCIÓN DE VARIABLES CATEGÓRICAS ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(datos_cat<span class="sc">$</span>educacion)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
   Posgrado    Primaria  Secundaria Universidad 
         29          43          61          67 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(datos_cat<span class="sc">$</span>region)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 Este Norte Oeste   Sur 
   44    71    42    43 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(datos_cat<span class="sc">$</span>genero)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  F   M 
 92 108 </code></pre>
</div>
</div>
</section>
<section id="implementación-de-codificación-ordinal" class="level3">
<h3 class="anchored" data-anchor-id="implementación-de-codificación-ordinal">Implementación de Codificación Ordinal</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Codificación ordinal para educación (variable con orden natural)</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>datos_cat<span class="sc">$</span>educacion_ord <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">factor</span>(datos_cat<span class="sc">$</span>educacion, </span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Primaria"</span>, <span class="st">"Secundaria"</span>, <span class="st">"Universidad"</span>, <span class="st">"Posgrado"</span>),</span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">ordered =</span> <span class="cn">TRUE</span>))</span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Verificar la codificación</span></span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>tabla_ord <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">Categoria =</span> <span class="fu">c</span>(<span class="st">"Primaria"</span>, <span class="st">"Secundaria"</span>, <span class="st">"Universidad"</span>, <span class="st">"Posgrado"</span>),</span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">Codigo =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span></span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb105-11"><a href="#cb105-11" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(tabla_ord, <span class="at">caption =</span> <span class="st">"Codificación Ordinal - Educación"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Codificación Ordinal - Educación</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Categoria</th>
<th style="text-align: right;">Codigo</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Primaria</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Secundaria</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Universidad</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">Posgrado</td>
<td style="text-align: right;">4</td>
</tr>
</tbody>
</table>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Modelo con codificación ordinal</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>modelo_ordinal <span class="ot">&lt;-</span> <span class="fu">lm</span>(salario <span class="sc">~</span> educacion_ord <span class="sc">+</span> experiencia <span class="sc">+</span> edad, <span class="at">data =</span> datos_cat)</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modelo_ordinal)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = salario ~ educacion_ord + experiencia + edad, data = datos_cat)

Residuals:
     Min       1Q   Median       3Q      Max 
-15841.8  -3753.9     32.3   3451.6  14428.8 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   24468.69    2065.35  11.847  &lt; 2e-16 ***
educacion_ord  8097.45     382.35  21.178  &lt; 2e-16 ***
experiencia     384.80      64.91   5.928 1.36e-08 ***
edad            205.66      47.27   4.351 2.18e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 5282 on 196 degrees of freedom
Multiple R-squared:  0.7225,    Adjusted R-squared:  0.7182 
F-statistic: 170.1 on 3 and 196 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== INTERPRETACIÓN CODIFICACIÓN ORDINAL ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== INTERPRETACIÓN CODIFICACIÓN ORDINAL ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>coef_ord <span class="ot">&lt;-</span> <span class="fu">coef</span>(modelo_ordinal)</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Coeficiente educación:"</span>, <span class="fu">round</span>(coef_ord[<span class="dv">2</span>], <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Coeficiente educación: 8097.45 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Interpretación: Cada nivel adicional de educación aumenta el salario en €"</span>, </span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">round</span>(coef_ord[<span class="dv">2</span>], <span class="dv">0</span>), <span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Interpretación: Cada nivel adicional de educación aumenta el salario en € 8097 </code></pre>
</div>
</div>
</section>
<section id="implementación-de-one-hot-encoding" class="level3">
<h3 class="anchored" data-anchor-id="implementación-de-one-hot-encoding">Implementación de One-Hot Encoding</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="co"># One-Hot Encoding para región (variable nominal)</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Método 1: usando model.matrix (elimina una categoría de referencia)</span></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>region_dummies <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span> region <span class="sc">-</span> <span class="dv">1</span>, <span class="at">data =</span> datos_cat)</span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(region_dummies) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"region_"</span>, <span class="fu">colnames</span>(region_dummies))</span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Método 2: usando caret::dummyVars (control de rank)</span></span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a>dummy_vars <span class="ot">&lt;-</span> <span class="fu">dummyVars</span>(<span class="sc">~</span> region, <span class="at">data =</span> datos_cat, <span class="at">fullRank =</span> <span class="cn">TRUE</span>)</span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a>region_dummies_caret <span class="ot">&lt;-</span> <span class="fu">predict</span>(dummy_vars, <span class="at">newdata =</span> datos_cat)</span>
<span id="cb114-9"><a href="#cb114-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-10"><a href="#cb114-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Añadir dummies al dataset</span></span>
<span id="cb114-11"><a href="#cb114-11" aria-hidden="true" tabindex="-1"></a>datos_cat_dummy <span class="ot">&lt;-</span> <span class="fu">cbind</span>(datos_cat, region_dummies_caret)</span>
<span id="cb114-12"><a href="#cb114-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-13"><a href="#cb114-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Verificar la codificación</span></span>
<span id="cb114-14"><a href="#cb114-14" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== ONE-HOT ENCODING - REGIÓN ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== ONE-HOT ENCODING - REGIÓN ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Variables creadas:"</span>, <span class="fu">colnames</span>(region_dummies_caret), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Variables creadas: regionNorte regionOeste regionSur </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Categoría de referencia: Norte (omitida para evitar colinealidad)</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Categoría de referencia: Norte (omitida para evitar colinealidad)</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mostrar algunas filas como ejemplo</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>ejemplo_encoding <span class="ot">&lt;-</span> datos_cat_dummy[<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>, <span class="fu">c</span>(<span class="st">"region"</span>, <span class="fu">colnames</span>(region_dummies_caret))]</span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(ejemplo_encoding, <span class="at">caption =</span> <span class="st">"Ejemplo de One-Hot Encoding"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Ejemplo de One-Hot Encoding</caption>
<thead>
<tr class="header">
<th style="text-align: left;">region</th>
<th style="text-align: right;">regionNorte</th>
<th style="text-align: right;">regionOeste</th>
<th style="text-align: right;">regionSur</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Este</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sur</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Oeste</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Norte</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Este</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Norte</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Este</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sur</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Obtener los nombres de las columnas dummy creadas</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>dummy_cols <span class="ot">&lt;-</span> <span class="fu">colnames</span>(region_dummies_caret)</span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Columnas dummy creadas:"</span>, <span class="fu">paste</span>(dummy_cols, <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Columnas dummy creadas: regionNorte, regionOeste, regionSur </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear la fórmula del modelo dinámicamente</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>formula_str <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"salario ~"</span>, <span class="fu">paste</span>(dummy_cols, <span class="at">collapse =</span> <span class="st">" + "</span>), <span class="st">"+ educacion_ord + experiencia + edad"</span>)</span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Fórmula del modelo:"</span>, formula_str, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Fórmula del modelo: salario ~ regionNorte + regionOeste + regionSur + educacion_ord + experiencia + edad </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Modelo con one-hot encoding</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>modelo_onehot <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">as.formula</span>(formula_str), <span class="at">data =</span> datos_cat_dummy)</span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modelo_onehot)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = as.formula(formula_str), data = datos_cat_dummy)

Residuals:
     Min       1Q   Median       3Q      Max 
-16295.1  -3689.4   -273.2   3365.7  14839.9 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   24332.62    2127.43  11.438  &lt; 2e-16 ***
regionNorte     536.26    1023.70   0.524    0.601    
regionOeste    -334.06    1158.94  -0.288    0.773    
regionSur      -207.58    1145.13  -0.181    0.856    
educacion_ord  8100.57     387.01  20.931  &lt; 2e-16 ***
experiencia     386.76      65.53   5.902 1.59e-08 ***
edad            206.54      47.77   4.324 2.46e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 5310 on 193 degrees of freedom
Multiple R-squared:  0.7238,    Adjusted R-squared:  0.7152 
F-statistic: 84.29 on 6 and 193 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== INTERPRETACIÓN ONE-HOT ENCODING ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== INTERPRETACIÓN ONE-HOT ENCODING ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>coef_oh <span class="ot">&lt;-</span> <span class="fu">coef</span>(modelo_onehot)</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">length</span>(dummy_cols) <span class="sc">&gt;=</span> <span class="dv">3</span>) {</span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Coeficientes de las regiones (vs categoría de referencia):</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(dummy_cols)) {</span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(dummy_cols[i] <span class="sc">%in%</span> <span class="fu">names</span>(coef_oh)) {</span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(dummy_cols[i], <span class="st">":"</span>, <span class="fu">round</span>(coef_oh[dummy_cols[i]], <span class="dv">2</span>), <span class="st">"€</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb129-8"><a href="#cb129-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb129-9"><a href="#cb129-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Coeficientes de las regiones (vs categoría de referencia):
regionNorte : 536.26 €
regionOeste : -334.06 €
regionSur : -207.58 €</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"(La categoría omitida es la de referencia)</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>(La categoría omitida es la de referencia)</code></pre>
</div>
</div>
</section>
<section id="comparación-de-métodos-de-codificación" class="level3">
<h3 class="anchored" data-anchor-id="comparación-de-métodos-de-codificación">Comparación de Métodos de Codificación</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Modelo incorrecto: tratando región como ordinal</span></span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>datos_cat<span class="sc">$</span>region_num <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">factor</span>(datos_cat<span class="sc">$</span>region))</span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>modelo_incorrecto <span class="ot">&lt;-</span> <span class="fu">lm</span>(salario <span class="sc">~</span> region_num <span class="sc">+</span> educacion_ord <span class="sc">+</span> experiencia <span class="sc">+</span> edad, <span class="at">data =</span> datos_cat)</span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Comparar los tres enfoques</span></span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a>modelos_comp <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Ordinal_Incorrecto"</span> <span class="ot">=</span> modelo_incorrecto,</span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"OneHot_Correcto"</span> <span class="ot">=</span> modelo_onehot,</span>
<span id="cb133-9"><a href="#cb133-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Factores_R"</span> <span class="ot">=</span> <span class="fu">lm</span>(salario <span class="sc">~</span> region <span class="sc">+</span> educacion_ord <span class="sc">+</span> experiencia <span class="sc">+</span> edad, <span class="at">data =</span> datos_cat)</span>
<span id="cb133-10"><a href="#cb133-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb133-11"><a href="#cb133-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-12"><a href="#cb133-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraer métricas de comparación</span></span>
<span id="cb133-13"><a href="#cb133-13" aria-hidden="true" tabindex="-1"></a>comparacion_encoding <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb133-14"><a href="#cb133-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">Modelo =</span> <span class="fu">names</span>(modelos_comp),</span>
<span id="cb133-15"><a href="#cb133-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">R2 =</span> <span class="fu">sapply</span>(modelos_comp, <span class="cf">function</span>(m) <span class="fu">summary</span>(m)<span class="sc">$</span>r.squared),</span>
<span id="cb133-16"><a href="#cb133-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">R2_adj =</span> <span class="fu">sapply</span>(modelos_comp, <span class="cf">function</span>(m) <span class="fu">summary</span>(m)<span class="sc">$</span>adj.r.squared),</span>
<span id="cb133-17"><a href="#cb133-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">AIC =</span> <span class="fu">sapply</span>(modelos_comp, AIC),</span>
<span id="cb133-18"><a href="#cb133-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">RMSE =</span> <span class="fu">sapply</span>(modelos_comp, <span class="cf">function</span>(m) <span class="fu">sqrt</span>(<span class="fu">mean</span>(<span class="fu">residuals</span>(m)<span class="sc">^</span><span class="dv">2</span>)))</span>
<span id="cb133-19"><a href="#cb133-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb133-20"><a href="#cb133-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-21"><a href="#cb133-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear una copia para mostrar con números redondeados</span></span>
<span id="cb133-22"><a href="#cb133-22" aria-hidden="true" tabindex="-1"></a>comparacion_display <span class="ot">&lt;-</span> comparacion_encoding</span>
<span id="cb133-23"><a href="#cb133-23" aria-hidden="true" tabindex="-1"></a>comparacion_display[, <span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>] <span class="ot">&lt;-</span> <span class="fu">round</span>(comparacion_display[, <span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>], <span class="dv">4</span>)</span>
<span id="cb133-24"><a href="#cb133-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-25"><a href="#cb133-25" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(comparacion_display, <span class="at">caption =</span> <span class="st">"Comparación de métodos de codificación"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Comparación de métodos de codificación</caption>
<colgroup>
<col style="width: 27%">
<col style="width: 27%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">Modelo</th>
<th style="text-align: right;">R2</th>
<th style="text-align: right;">R2_adj</th>
<th style="text-align: right;">AIC</th>
<th style="text-align: right;">RMSE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Ordinal_Incorrecto</td>
<td style="text-align: left;">Ordinal_Incorrecto</td>
<td style="text-align: right;">0.7228</td>
<td style="text-align: right;">0.7171</td>
<td style="text-align: right;">4004.086</td>
<td style="text-align: right;">5225.345</td>
</tr>
<tr class="even">
<td style="text-align: left;">OneHot_Correcto</td>
<td style="text-align: left;">OneHot_Correcto</td>
<td style="text-align: right;">0.7238</td>
<td style="text-align: right;">0.7152</td>
<td style="text-align: right;">4007.380</td>
<td style="text-align: right;">5216.136</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Factores_R</td>
<td style="text-align: left;">Factores_R</td>
<td style="text-align: right;">0.7238</td>
<td style="text-align: right;">0.7152</td>
<td style="text-align: right;">4007.380</td>
<td style="text-align: right;">5216.136</td>
</tr>
</tbody>
</table>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== ANÁLISIS DE RESULTADOS ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== ANÁLISIS DE RESULTADOS ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"El modelo 'Ordinal_Incorrecto' asume incorrectamente que las regiones tienen un orden natural.</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>El modelo 'Ordinal_Incorrecto' asume incorrectamente que las regiones tienen un orden natural.</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Los modelos 'OneHot_Correcto' y 'Factores_R' son equivalentes y tratan región como nominal.</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Los modelos 'OneHot_Correcto' y 'Factores_R' son equivalentes y tratan región como nominal.</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"La diferencia en R² muestra el impacto de la codificación incorrecta.</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>La diferencia en R² muestra el impacto de la codificación incorrecta.</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualización del error de codificación ordinal incorrecta</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>medias_region_real <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(salario <span class="sc">~</span> region, <span class="at">data =</span> datos_cat, mean)</span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>orden_real <span class="ot">&lt;-</span> medias_region_real[<span class="fu">order</span>(medias_region_real<span class="sc">$</span>salario), ]</span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Orden real de regiones por salario promedio:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Orden real de regiones por salario promedio:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(orden_real)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  region  salario
1   Este 54020.46
4    Sur 54644.99
2  Norte 56278.44
3  Oeste 57079.01</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Orden asumido por codificación numérica:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Orden asumido por codificación numérica:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">data.frame</span>(<span class="at">region =</span> <span class="fu">levels</span>(<span class="fu">factor</span>(datos_cat<span class="sc">$</span>region)), <span class="at">codigo =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  region codigo
1   Este      1
2  Norte      2
3  Oeste      3
4    Sur      4</code></pre>
</div>
</div>
</section>
</section>
<section id="parte-6-interacciones-entre-variables" class="level2">
<h2 class="anchored" data-anchor-id="parte-6-interacciones-entre-variables">Parte 6: Interacciones entre Variables</h2>
<section id="interacciones-continua-continua" class="level3">
<h3 class="anchored" data-anchor-id="interacciones-continua-continua">Interacciones Continua × Continua</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simular datos con interacción precio-publicidad</span></span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">789</span>)</span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a>precio <span class="ot">&lt;-</span> <span class="fu">runif</span>(n, <span class="dv">50</span>, <span class="dv">150</span>)</span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a>publicidad <span class="ot">&lt;-</span> <span class="fu">runif</span>(n, <span class="dv">0</span>, <span class="dv">10</span>)</span>
<span id="cb150-6"><a href="#cb150-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-7"><a href="#cb150-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Modelo con interacción: el efecto del precio depende de la publicidad</span></span>
<span id="cb150-8"><a href="#cb150-8" aria-hidden="true" tabindex="-1"></a><span class="co"># A mayor publicidad, menor sensibilidad al precio</span></span>
<span id="cb150-9"><a href="#cb150-9" aria-hidden="true" tabindex="-1"></a>ventas <span class="ot">&lt;-</span> <span class="dv">1000</span> <span class="sc">-</span> <span class="dv">4</span><span class="sc">*</span>precio <span class="sc">+</span> <span class="dv">60</span><span class="sc">*</span>publicidad <span class="sc">+</span> <span class="fl">0.6</span><span class="sc">*</span>precio<span class="sc">*</span>publicidad<span class="sc">/</span><span class="dv">10</span> <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">50</span>)</span>
<span id="cb150-10"><a href="#cb150-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-11"><a href="#cb150-11" aria-hidden="true" tabindex="-1"></a>datos_inter <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(precio, publicidad, ventas)</span>
<span id="cb150-12"><a href="#cb150-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-13"><a href="#cb150-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Modelo sin interacción</span></span>
<span id="cb150-14"><a href="#cb150-14" aria-hidden="true" tabindex="-1"></a>modelo_sin_inter <span class="ot">&lt;-</span> <span class="fu">lm</span>(ventas <span class="sc">~</span> precio <span class="sc">+</span> publicidad, <span class="at">data =</span> datos_inter)</span>
<span id="cb150-15"><a href="#cb150-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-16"><a href="#cb150-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Modelo con interacción</span></span>
<span id="cb150-17"><a href="#cb150-17" aria-hidden="true" tabindex="-1"></a>modelo_con_inter <span class="ot">&lt;-</span> <span class="fu">lm</span>(ventas <span class="sc">~</span> precio <span class="sc">*</span> publicidad, <span class="at">data =</span> datos_inter)</span>
<span id="cb150-18"><a href="#cb150-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-19"><a href="#cb150-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Comparar modelos</span></span>
<span id="cb150-20"><a href="#cb150-20" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== COMPARACIÓN MODELOS CON/SIN INTERACCIÓN ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== COMPARACIÓN MODELOS CON/SIN INTERACCIÓN ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Sin interacción - R²:"</span>, <span class="fu">round</span>(<span class="fu">summary</span>(modelo_sin_inter)<span class="sc">$</span>r.squared, <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sin interacción - R²: 0.9547 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Con interacción - R²:"</span>, <span class="fu">round</span>(<span class="fu">summary</span>(modelo_con_inter)<span class="sc">$</span>r.squared, <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Con interacción - R²: 0.9547 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test F para la interacción</span></span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a>anova_inter <span class="ot">&lt;-</span> <span class="fu">anova</span>(modelo_sin_inter, modelo_con_inter)</span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(anova_inter)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Model 1: ventas ~ precio + publicidad
Model 2: ventas ~ precio * publicidad
  Res.Df    RSS Df Sum of Sq      F Pr(&gt;F)
1    197 507537                           
2    196 507252  1    284.86 0.1101 0.7404</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Interpretación de coeficientes</span></span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a>coef_inter <span class="ot">&lt;-</span> <span class="fu">coef</span>(modelo_con_inter)</span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== INTERPRETACIÓN DE LA INTERACCIÓN ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== INTERPRETACIÓN DE LA INTERACCIÓN ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Intercepto:"</span>, <span class="fu">round</span>(coef_inter[<span class="dv">1</span>], <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Intercepto: 968.37 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb162"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Efecto precio:"</span>, <span class="fu">round</span>(coef_inter[<span class="dv">2</span>], <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Efecto precio: -3.7432 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Efecto publicidad:"</span>, <span class="fu">round</span>(coef_inter[<span class="dv">3</span>], <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Efecto publicidad: 65.78 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Interacción precio×publicidad:"</span>, <span class="fu">round</span>(coef_inter[<span class="dv">4</span>], <span class="dv">6</span>), <span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Interacción precio×publicidad: 0.014703 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb168"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcular efectos marginales en diferentes niveles de publicidad</span></span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a>publicidad_niveles <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>)</span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a>efectos_precio <span class="ot">&lt;-</span> coef_inter[<span class="dv">2</span>] <span class="sc">+</span> coef_inter[<span class="dv">4</span>] <span class="sc">*</span> publicidad_niveles</span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true" tabindex="-1"></a>tabla_efectos <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb168-6"><a href="#cb168-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Publicidad =</span> publicidad_niveles,</span>
<span id="cb168-7"><a href="#cb168-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">Efecto_Precio =</span> <span class="fu">round</span>(efectos_precio, <span class="dv">4</span>)</span>
<span id="cb168-8"><a href="#cb168-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb168-9"><a href="#cb168-9" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(tabla_efectos, <span class="at">caption =</span> <span class="st">"Efecto del precio según nivel de publicidad"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Efecto del precio según nivel de publicidad</caption>
<thead>
<tr class="header">
<th style="text-align: right;">Publicidad</th>
<th style="text-align: right;">Efecto_Precio</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">-3.7432</td>
</tr>
<tr class="even">
<td style="text-align: right;">5</td>
<td style="text-align: right;">-3.6697</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10</td>
<td style="text-align: right;">-3.5962</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="visualización-de-interacciones" class="level3">
<h3 class="anchored" data-anchor-id="visualización-de-interacciones">Visualización de Interacciones</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb169"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear grupos de publicidad para visualización</span></span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a>datos_inter<span class="sc">$</span>pub_grupo <span class="ot">&lt;-</span> <span class="fu">cut</span>(datos_inter<span class="sc">$</span>publicidad, </span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a>                            <span class="at">breaks =</span> <span class="dv">3</span>, </span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a>                            <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Baja"</span>, <span class="st">"Media"</span>, <span class="st">"Alta"</span>))</span>
<span id="cb169-5"><a href="#cb169-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-6"><a href="#cb169-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráfico de interacción - scatter plot</span></span>
<span id="cb169-7"><a href="#cb169-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(datos_inter, <span class="fu">aes</span>(<span class="at">x =</span> precio, <span class="at">y =</span> ventas, <span class="at">color =</span> pub_grupo)) <span class="sc">+</span></span>
<span id="cb169-8"><a href="#cb169-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb169-9"><a href="#cb169-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> y <span class="sc">~</span> x, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb169-10"><a href="#cb169-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Interacción Precio × Publicidad"</span>,</span>
<span id="cb169-11"><a href="#cb169-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"El efecto del precio varía según el nivel de publicidad"</span>,</span>
<span id="cb169-12"><a href="#cb169-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Precio (€)"</span>, <span class="at">y =</span> <span class="st">"Ventas"</span>, <span class="at">color =</span> <span class="st">"Publicidad"</span>) <span class="sc">+</span></span>
<span id="cb169-13"><a href="#cb169-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lab3_ingenieria_caracteristicas_files/figure-html/interaction_visualization-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb170"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráfico de interacción clásico</span></span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcular medias por grupos</span></span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a>datos_inter<span class="sc">$</span>precio_grupo <span class="ot">&lt;-</span> <span class="fu">cut</span>(datos_inter<span class="sc">$</span>precio, </span>
<span id="cb170-4"><a href="#cb170-4" aria-hidden="true" tabindex="-1"></a>                               <span class="at">breaks =</span> <span class="dv">3</span>, </span>
<span id="cb170-5"><a href="#cb170-5" aria-hidden="true" tabindex="-1"></a>                               <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Bajo"</span>, <span class="st">"Medio"</span>, <span class="st">"Alto"</span>))</span>
<span id="cb170-6"><a href="#cb170-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-7"><a href="#cb170-7" aria-hidden="true" tabindex="-1"></a>medias_inter <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(ventas <span class="sc">~</span> precio_grupo <span class="sc">+</span> pub_grupo, <span class="at">data =</span> datos_inter, mean)</span>
<span id="cb170-8"><a href="#cb170-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-9"><a href="#cb170-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(medias_inter, <span class="fu">aes</span>(<span class="at">x =</span> precio_grupo, <span class="at">y =</span> ventas, <span class="at">color =</span> pub_grupo, <span class="at">group =</span> pub_grupo)) <span class="sc">+</span></span>
<span id="cb170-10"><a href="#cb170-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb170-11"><a href="#cb170-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb170-12"><a href="#cb170-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Gráfico de Interacción: Precio × Publicidad"</span>,</span>
<span id="cb170-13"><a href="#cb170-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Líneas no paralelas indican presencia de interacción"</span>,</span>
<span id="cb170-14"><a href="#cb170-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Nivel de Precio"</span>, <span class="at">y =</span> <span class="st">"Ventas Promedio"</span>, <span class="at">color =</span> <span class="st">"Publicidad"</span>) <span class="sc">+</span></span>
<span id="cb170-15"><a href="#cb170-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lab3_ingenieria_caracteristicas_files/figure-html/interaction_visualization-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="interacciones-categórica-continua" class="level3">
<h3 class="anchored" data-anchor-id="interacciones-categórica-continua">Interacciones Categórica × Continua</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb171"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Interacción género × experiencia en salarios</span></span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a>datos_mixta <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb171-3"><a href="#cb171-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">experiencia =</span> <span class="fu">runif</span>(<span class="dv">150</span>, <span class="dv">0</span>, <span class="dv">20</span>),</span>
<span id="cb171-4"><a href="#cb171-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">genero =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"Masculino"</span>, <span class="st">"Femenino"</span>), <span class="dv">150</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb171-5"><a href="#cb171-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb171-6"><a href="#cb171-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-7"><a href="#cb171-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Salario con interacción: brecha de género creciente con experiencia</span></span>
<span id="cb171-8"><a href="#cb171-8" aria-hidden="true" tabindex="-1"></a>salario_base <span class="ot">&lt;-</span> <span class="dv">35000</span></span>
<span id="cb171-9"><a href="#cb171-9" aria-hidden="true" tabindex="-1"></a>efecto_exp_mujer <span class="ot">&lt;-</span> <span class="dv">1200</span>  <span class="co"># €1200 por año para mujeres</span></span>
<span id="cb171-10"><a href="#cb171-10" aria-hidden="true" tabindex="-1"></a>efecto_exp_hombre <span class="ot">&lt;-</span> <span class="dv">2000</span>  <span class="co"># €2000 por año para hombres</span></span>
<span id="cb171-11"><a href="#cb171-11" aria-hidden="true" tabindex="-1"></a>efecto_genero_base <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(datos_mixta<span class="sc">$</span>genero <span class="sc">==</span> <span class="st">"Masculino"</span>, <span class="dv">3000</span>, <span class="dv">0</span>)</span>
<span id="cb171-12"><a href="#cb171-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-13"><a href="#cb171-13" aria-hidden="true" tabindex="-1"></a>dummy_masculino <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(datos_mixta<span class="sc">$</span>genero <span class="sc">==</span> <span class="st">"Masculino"</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb171-14"><a href="#cb171-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-15"><a href="#cb171-15" aria-hidden="true" tabindex="-1"></a>datos_mixta<span class="sc">$</span>salario <span class="ot">&lt;-</span> salario_base <span class="sc">+</span> </span>
<span id="cb171-16"><a href="#cb171-16" aria-hidden="true" tabindex="-1"></a>                      efecto_exp_mujer <span class="sc">*</span> datos_mixta<span class="sc">$</span>experiencia <span class="sc">+</span></span>
<span id="cb171-17"><a href="#cb171-17" aria-hidden="true" tabindex="-1"></a>                      efecto_genero_base <span class="sc">*</span> dummy_masculino <span class="sc">+</span></span>
<span id="cb171-18"><a href="#cb171-18" aria-hidden="true" tabindex="-1"></a>                      (efecto_exp_hombre <span class="sc">-</span> efecto_exp_mujer) <span class="sc">*</span> datos_mixta<span class="sc">$</span>experiencia <span class="sc">*</span> dummy_masculino <span class="sc">+</span></span>
<span id="cb171-19"><a href="#cb171-19" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">rnorm</span>(<span class="dv">150</span>, <span class="dv">0</span>, <span class="dv">4000</span>)</span>
<span id="cb171-20"><a href="#cb171-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-21"><a href="#cb171-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Modelo con interacción</span></span>
<span id="cb171-22"><a href="#cb171-22" aria-hidden="true" tabindex="-1"></a>modelo_mixta <span class="ot">&lt;-</span> <span class="fu">lm</span>(salario <span class="sc">~</span> experiencia <span class="sc">*</span> genero, <span class="at">data =</span> datos_mixta)</span>
<span id="cb171-23"><a href="#cb171-23" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modelo_mixta)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = salario ~ experiencia * genero, data = datos_mixta)

Residuals:
   Min     1Q Median     3Q    Max 
 -7053  -2853   -291   2374  11601 

Coefficients:
                            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)                 35428.06     900.18  39.356  &lt; 2e-16 ***
experiencia                  1186.73      72.01  16.481  &lt; 2e-16 ***
generoMasculino              2349.22    1369.90   1.715   0.0885 .  
experiencia:generoMasculino   767.85     118.21   6.495 1.22e-09 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 3912 on 146 degrees of freedom
Multiple R-squared:  0.8555,    Adjusted R-squared:  0.8525 
F-statistic: 288.2 on 3 and 146 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb173"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Interpretación</span></span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a>coef_mixta <span class="ot">&lt;-</span> <span class="fu">coef</span>(modelo_mixta)</span>
<span id="cb173-3"><a href="#cb173-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== INTERPRETACIÓN INTERACCIÓN GÉNERO × EXPERIENCIA ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== INTERPRETACIÓN INTERACCIÓN GÉNERO × EXPERIENCIA ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb175"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Intercepto (mujeres con 0 experiencia):"</span>, <span class="fu">round</span>(coef_mixta[<span class="dv">1</span>], <span class="dv">0</span>), <span class="st">"€</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Intercepto (mujeres con 0 experiencia): 35428 €</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb177"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Efecto experiencia (mujeres):"</span>, <span class="fu">round</span>(coef_mixta[<span class="dv">2</span>], <span class="dv">0</span>), <span class="st">"€/año</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Efecto experiencia (mujeres): 1187 €/año</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb179"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Diferencia inicial (hombres vs mujeres):"</span>, <span class="fu">round</span>(coef_mixta[<span class="dv">3</span>], <span class="dv">0</span>), <span class="st">"€</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Diferencia inicial (hombres vs mujeres): 2349 €</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb181"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Interacción (diferencia en retorno a experiencia):"</span>, <span class="fu">round</span>(coef_mixta[<span class="dv">4</span>], <span class="dv">0</span>), <span class="st">"€/año</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Interacción (diferencia en retorno a experiencia): 768 €/año</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb183"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Para hombres:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Para hombres:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb185"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"- Intercepto:"</span>, <span class="fu">round</span>(coef_mixta[<span class="dv">1</span>] <span class="sc">+</span> coef_mixta[<span class="dv">3</span>], <span class="dv">0</span>), <span class="st">"€</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>- Intercepto: 37777 €</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb187"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"- Efecto experiencia:"</span>, <span class="fu">round</span>(coef_mixta[<span class="dv">2</span>] <span class="sc">+</span> coef_mixta[<span class="dv">4</span>], <span class="dv">0</span>), <span class="st">"€/año</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>- Efecto experiencia: 1955 €/año</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb189"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualización de la divergencia</span></span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(datos_mixta, <span class="fu">aes</span>(<span class="at">x =</span> experiencia, <span class="at">y =</span> salario, <span class="at">color =</span> genero)) <span class="sc">+</span></span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb189-4"><a href="#cb189-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> y <span class="sc">~</span> x, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb189-5"><a href="#cb189-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Interacción Experiencia × Género"</span>,</span>
<span id="cb189-6"><a href="#cb189-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"La brecha salarial se amplía con la experiencia"</span>,</span>
<span id="cb189-7"><a href="#cb189-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Años de experiencia"</span>, <span class="at">y =</span> <span class="st">"Salario (€)"</span>, <span class="at">color =</span> <span class="st">"Género"</span>) <span class="sc">+</span></span>
<span id="cb189-8"><a href="#cb189-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb189-9"><a href="#cb189-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Femenino"</span> <span class="ot">=</span> <span class="st">"#E69F00"</span>, <span class="st">"Masculino"</span> <span class="ot">=</span> <span class="st">"#0072B2"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lab3_ingenieria_caracteristicas_files/figure-html/categorical_continuous_interaction-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb190"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcular brecha por años de experiencia</span></span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a>años_experiencia <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>)</span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a>brecha_por_año <span class="ot">&lt;-</span> coef_mixta[<span class="dv">3</span>] <span class="sc">+</span> coef_mixta[<span class="dv">4</span>] <span class="sc">*</span> años_experiencia</span>
<span id="cb190-4"><a href="#cb190-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-5"><a href="#cb190-5" aria-hidden="true" tabindex="-1"></a>tabla_brecha <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb190-6"><a href="#cb190-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Experiencia =</span> años_experiencia,</span>
<span id="cb190-7"><a href="#cb190-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">Brecha_Salarial =</span> <span class="fu">round</span>(brecha_por_año, <span class="dv">0</span>)</span>
<span id="cb190-8"><a href="#cb190-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb190-9"><a href="#cb190-9" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(tabla_brecha, <span class="at">caption =</span> <span class="st">"Evolución de la brecha salarial de género"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Evolución de la brecha salarial de género</caption>
<thead>
<tr class="header">
<th style="text-align: right;">Experiencia</th>
<th style="text-align: right;">Brecha_Salarial</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">2349</td>
</tr>
<tr class="even">
<td style="text-align: right;">5</td>
<td style="text-align: right;">6188</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10</td>
<td style="text-align: right;">10028</td>
</tr>
<tr class="even">
<td style="text-align: right;">15</td>
<td style="text-align: right;">13867</td>
</tr>
<tr class="odd">
<td style="text-align: right;">20</td>
<td style="text-align: right;">17706</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="parte-7-ejercicios-prácticos" class="level2">
<h2 class="anchored" data-anchor-id="parte-7-ejercicios-prácticos">Parte 7: Ejercicios Prácticos</h2>
<section id="ejercicio-1-análisis-completo-de-transformaciones" class="level3">
<h3 class="anchored" data-anchor-id="ejercicio-1-análisis-completo-de-transformaciones">Ejercicio 1: Análisis Completo de Transformaciones</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb191"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Dataset con múltiples problemas</span></span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">999</span>)</span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">180</span></span>
<span id="cb191-4"><a href="#cb191-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-5"><a href="#cb191-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Variables con diferentes necesidades de transformación</span></span>
<span id="cb191-6"><a href="#cb191-6" aria-hidden="true" tabindex="-1"></a>superficie <span class="ot">&lt;-</span> <span class="fu">runif</span>(n, <span class="dv">50</span>, <span class="dv">300</span>)  <span class="co"># metros cuadrados</span></span>
<span id="cb191-7"><a href="#cb191-7" aria-hidden="true" tabindex="-1"></a>antiguedad <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>, n, <span class="at">replace =</span> <span class="cn">TRUE</span>)  <span class="co"># años</span></span>
<span id="cb191-8"><a href="#cb191-8" aria-hidden="true" tabindex="-1"></a>zona <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"Centro"</span>, <span class="st">"Periferia"</span>, <span class="st">"Suburbios"</span>), n, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.4</span>, <span class="fl">0.3</span>))</span>
<span id="cb191-9"><a href="#cb191-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-10"><a href="#cb191-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Precio con relación compleja</span></span>
<span id="cb191-11"><a href="#cb191-11" aria-hidden="true" tabindex="-1"></a>precio_base <span class="ot">&lt;-</span> <span class="dv">100000</span></span>
<span id="cb191-12"><a href="#cb191-12" aria-hidden="true" tabindex="-1"></a>efecto_superficie <span class="ot">&lt;-</span> <span class="dv">400</span> <span class="sc">*</span> superficie<span class="sc">^</span><span class="fl">0.8</span>  <span class="co"># Rendimientos decrecientes</span></span>
<span id="cb191-13"><a href="#cb191-13" aria-hidden="true" tabindex="-1"></a>efecto_antiguedad <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">2000</span> <span class="sc">*</span> <span class="fu">log</span>(antiguedad <span class="sc">+</span> <span class="dv">1</span>)  <span class="co"># Depreciación logarítmica</span></span>
<span id="cb191-14"><a href="#cb191-14" aria-hidden="true" tabindex="-1"></a>efecto_zona <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(zona <span class="sc">==</span> <span class="st">"Centro"</span>, <span class="dv">50000</span>, <span class="fu">ifelse</span>(zona <span class="sc">==</span> <span class="st">"Suburbios"</span>, <span class="dv">20000</span>, <span class="dv">0</span>))</span>
<span id="cb191-15"><a href="#cb191-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-16"><a href="#cb191-16" aria-hidden="true" tabindex="-1"></a>precio <span class="ot">&lt;-</span> precio_base <span class="sc">+</span> efecto_superficie <span class="sc">+</span> efecto_antiguedad <span class="sc">+</span> efecto_zona <span class="sc">+</span> </span>
<span id="cb191-17"><a href="#cb191-17" aria-hidden="true" tabindex="-1"></a>          superficie <span class="sc">*</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">100</span>)  <span class="co"># Heterocedasticidad</span></span>
<span id="cb191-18"><a href="#cb191-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-19"><a href="#cb191-19" aria-hidden="true" tabindex="-1"></a>datos_ejercicio <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(superficie, antiguedad, zona, precio)</span>
<span id="cb191-20"><a href="#cb191-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-21"><a href="#cb191-21" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== EJERCICIO 1: ANÁLISIS COMPLETO ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== EJERCICIO 1: ANÁLISIS COMPLETO ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb193"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Tareas a realizar:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Tareas a realizar:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb195"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"1. Analizar la distribución de las variables</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>1. Analizar la distribución de las variables</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb197"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"2. Detectar problemas en un modelo básico</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>2. Detectar problemas en un modelo básico</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb199"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"3. Aplicar transformaciones apropiadas</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>3. Aplicar transformaciones apropiadas</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb201"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"4. Comparar modelos antes y después</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>4. Comparar modelos antes y después</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb203"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"5. Interpretar coeficientes transformados</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>5. Interpretar coeficientes transformados</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb205"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Modelo básico para diagnóstico</span></span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a>modelo_basico <span class="ot">&lt;-</span> <span class="fu">lm</span>(precio <span class="sc">~</span> superficie <span class="sc">+</span> antiguedad <span class="sc">+</span> zona, <span class="at">data =</span> datos_ejercicio)</span>
<span id="cb205-3"><a href="#cb205-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-4"><a href="#cb205-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Diagnósticos básicos</span></span>
<span id="cb205-5"><a href="#cb205-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"R² modelo básico:"</span>, <span class="fu">round</span>(<span class="fu">summary</span>(modelo_basico)<span class="sc">$</span>r.squared, <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>R² modelo básico: 0.5385 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb207"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_hetero</span>(modelo_basico, <span class="st">"Modelo Básico"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== Test de Breusch-Pagan: Modelo Básico ===
Chi-square: 17.6159 
p-valor: 0 
Conclusión: Hay evidencia de heterocedasticidad</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb209"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_reset</span>(modelo_basico, <span class="st">"Modelo Básico"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== Test RESET: Modelo Básico ===
F-statistic: 1.0685 
p-valor: 0.3458 
Conclusión: La forma funcional es adecuada</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb211"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Tu análisis aquí...</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Tu análisis aquí...</code></pre>
</div>
</div>
</section>
<section id="ejercicio-2-variables-categóricas-complejas" class="level3">
<h3 class="anchored" data-anchor-id="ejercicio-2-variables-categóricas-complejas">Ejercicio 2: Variables Categóricas Complejas</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb213"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Dataset con variables categóricas de diferentes tipos</span></span>
<span id="cb213-2"><a href="#cb213-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">888</span>)</span>
<span id="cb213-3"><a href="#cb213-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb213-4"><a href="#cb213-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-5"><a href="#cb213-5" aria-hidden="true" tabindex="-1"></a>datos_cat_ejercicio <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb213-6"><a href="#cb213-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Variable ordinal</span></span>
<span id="cb213-7"><a href="#cb213-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">calificacion_credito =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"D"</span>, <span class="st">"C"</span>, <span class="st">"B"</span>, <span class="st">"A"</span>, <span class="st">"AA"</span>), n, <span class="at">replace =</span> <span class="cn">TRUE</span>, </span>
<span id="cb213-8"><a href="#cb213-8" aria-hidden="true" tabindex="-1"></a>                               <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.25</span>, <span class="fl">0.05</span>)),</span>
<span id="cb213-9"><a href="#cb213-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb213-10"><a href="#cb213-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Variable nominal con muchas categorías</span></span>
<span id="cb213-11"><a href="#cb213-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">sector =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"Tecnología"</span>, <span class="st">"Finanzas"</span>, <span class="st">"Salud"</span>, <span class="st">"Educación"</span>, <span class="st">"Manufactura"</span>, <span class="st">"Servicios"</span>), </span>
<span id="cb213-12"><a href="#cb213-12" aria-hidden="true" tabindex="-1"></a>                 n, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb213-13"><a href="#cb213-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb213-14"><a href="#cb213-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Variable binaria</span></span>
<span id="cb213-15"><a href="#cb213-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">tipo_empresa =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"Pública"</span>, <span class="st">"Privada"</span>), n, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.7</span>)),</span>
<span id="cb213-16"><a href="#cb213-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb213-17"><a href="#cb213-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Variables numéricas</span></span>
<span id="cb213-18"><a href="#cb213-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">empleados =</span> <span class="fu">round</span>(<span class="fu">runif</span>(n, <span class="dv">10</span>, <span class="dv">1000</span>)),</span>
<span id="cb213-19"><a href="#cb213-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">ingresos =</span> <span class="fu">runif</span>(n, <span class="dv">100000</span>, <span class="dv">10000000</span>)</span>
<span id="cb213-20"><a href="#cb213-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb213-21"><a href="#cb213-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-22"><a href="#cb213-22" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== EJERCICIO 2: VARIABLES CATEGÓRICAS ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== EJERCICIO 2: VARIABLES CATEGÓRICAS ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb215"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Tareas a realizar:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Tareas a realizar:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb217"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"1. Decidir método de codificación para cada variable categórica</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>1. Decidir método de codificación para cada variable categórica</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb219"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"2. Implementar las codificaciones apropiadas</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>2. Implementar las codificaciones apropiadas</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb221"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"3. Comparar diferentes enfoques</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>3. Comparar diferentes enfoques</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb223"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"4. Crear un modelo final optimizado</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>4. Crear un modelo final optimizado</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb225"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mostrar distribuciones</span></span>
<span id="cb225-2"><a href="#cb225-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Distribución de variables categóricas:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Distribución de variables categóricas:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb227"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(datos_cat_ejercicio[,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], table)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>$calificacion_credito

 A AA  B  C  D 
41  7 81 47 24 

$sector

  Educación    Finanzas Manufactura       Salud   Servicios  Tecnología 
         35          26          30          38          35          36 

$tipo_empresa

Privada Pública 
    152      48 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb229"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Tu análisis aquí...</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Tu análisis aquí...</code></pre>
</div>
</div>
</section>
<section id="ejercicio-3-interacciones-en-contexto-real" class="level3">
<h3 class="anchored" data-anchor-id="ejercicio-3-interacciones-en-contexto-real">Ejercicio 3: Interacciones en Contexto Real</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb231"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb231-1"><a href="#cb231-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Datos de marketing con múltiples interacciones potenciales</span></span>
<span id="cb231-2"><a href="#cb231-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">777</span>)</span>
<span id="cb231-3"><a href="#cb231-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">250</span></span>
<span id="cb231-4"><a href="#cb231-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-5"><a href="#cb231-5" aria-hidden="true" tabindex="-1"></a>marketing_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb231-6"><a href="#cb231-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">precio =</span> <span class="fu">runif</span>(n, <span class="dv">20</span>, <span class="dv">100</span>),</span>
<span id="cb231-7"><a href="#cb231-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">descuento =</span> <span class="fu">runif</span>(n, <span class="dv">0</span>, <span class="fl">0.3</span>),</span>
<span id="cb231-8"><a href="#cb231-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">calidad =</span> <span class="fu">runif</span>(n, <span class="dv">1</span>, <span class="dv">5</span>),</span>
<span id="cb231-9"><a href="#cb231-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">temporada =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"Alta"</span>, <span class="st">"Media"</span>, <span class="st">"Baja"</span>), n, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.4</span>, <span class="fl">0.3</span>)),</span>
<span id="cb231-10"><a href="#cb231-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">competencia =</span> <span class="fu">runif</span>(n, <span class="dv">1</span>, <span class="dv">10</span>),</span>
<span id="cb231-11"><a href="#cb231-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">canal =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"Online"</span>, <span class="st">"Tienda"</span>, <span class="st">"Híbrido"</span>), n, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb231-12"><a href="#cb231-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb231-13"><a href="#cb231-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-14"><a href="#cb231-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Variable respuesta con interacciones complejas</span></span>
<span id="cb231-15"><a href="#cb231-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Interacción precio-descuento, calidad-temporada, etc.</span></span>
<span id="cb231-16"><a href="#cb231-16" aria-hidden="true" tabindex="-1"></a>marketing_data<span class="sc">$</span>ventas <span class="ot">&lt;-</span> <span class="dv">100</span> <span class="sc">+</span> </span>
<span id="cb231-17"><a href="#cb231-17" aria-hidden="true" tabindex="-1"></a>  (<span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span> marketing_data<span class="sc">$</span>precio) <span class="sc">+</span> </span>
<span id="cb231-18"><a href="#cb231-18" aria-hidden="true" tabindex="-1"></a>  (<span class="dv">500</span> <span class="sc">*</span> marketing_data<span class="sc">$</span>descuento) <span class="sc">+</span></span>
<span id="cb231-19"><a href="#cb231-19" aria-hidden="true" tabindex="-1"></a>  (<span class="dv">30</span> <span class="sc">*</span> marketing_data<span class="sc">$</span>calidad) <span class="sc">+</span></span>
<span id="cb231-20"><a href="#cb231-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Interacciones</span></span>
<span id="cb231-21"><a href="#cb231-21" aria-hidden="true" tabindex="-1"></a>  (<span class="fl">1.5</span> <span class="sc">*</span> marketing_data<span class="sc">$</span>precio <span class="sc">*</span> marketing_data<span class="sc">$</span>descuento) <span class="sc">+</span>  <span class="co"># Descuento mitiga sensibilidad precio</span></span>
<span id="cb231-22"><a href="#cb231-22" aria-hidden="true" tabindex="-1"></a>  (<span class="fu">ifelse</span>(marketing_data<span class="sc">$</span>temporada <span class="sc">==</span> <span class="st">"Alta"</span>, <span class="dv">20</span>, <span class="dv">0</span>) <span class="sc">*</span> marketing_data<span class="sc">$</span>calidad) <span class="sc">+</span>  <span class="co"># Calidad importa más en temporada alta</span></span>
<span id="cb231-23"><a href="#cb231-23" aria-hidden="true" tabindex="-1"></a>  (<span class="sc">-</span><span class="dv">5</span> <span class="sc">*</span> marketing_data<span class="sc">$</span>competencia) <span class="sc">+</span></span>
<span id="cb231-24"><a href="#cb231-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">30</span>)</span>
<span id="cb231-25"><a href="#cb231-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-26"><a href="#cb231-26" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== EJERCICIO 3: INTERACCIONES COMPLEJAS ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== EJERCICIO 3: INTERACCIONES COMPLEJAS ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb233"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Tareas a realizar:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Tareas a realizar:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb235"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"1. Identificar potenciales interacciones usando conocimiento del dominio</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>1. Identificar potenciales interacciones usando conocimiento del dominio</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb237"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb237-1"><a href="#cb237-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"2. Explorar visualmente las interacciones</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>2. Explorar visualmente las interacciones</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb239"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb239-1"><a href="#cb239-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"3. Probar diferentes especificaciones de modelo</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>3. Probar diferentes especificaciones de modelo</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb241"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"4. Validar las interacciones estadísticamente</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>4. Validar las interacciones estadísticamente</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb243"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"5. Interpretar el modelo final en términos de negocio</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>5. Interpretar el modelo final en términos de negocio</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb245"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb245-1"><a href="#cb245-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Tu análisis aquí...</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Tu análisis aquí...</code></pre>
</div>
</div>
</section>
</section>
<section id="parte-8-ingeniería-de-características-avanzada" class="level2">
<h2 class="anchored" data-anchor-id="parte-8-ingeniería-de-características-avanzada">Parte 8: Ingeniería de Características Avanzada</h2>
<section id="creación-de-ratios-y-métricas-compuestas" class="level3">
<h3 class="anchored" data-anchor-id="creación-de-ratios-y-métricas-compuestas">Creación de Ratios y Métricas Compuestas</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb247"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb247-1"><a href="#cb247-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Dataset financiero para ingeniería de características</span></span>
<span id="cb247-2"><a href="#cb247-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">666</span>)</span>
<span id="cb247-3"><a href="#cb247-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">150</span></span>
<span id="cb247-4"><a href="#cb247-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-5"><a href="#cb247-5" aria-hidden="true" tabindex="-1"></a>empresa_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb247-6"><a href="#cb247-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">ingresos =</span> <span class="fu">runif</span>(n, <span class="dv">1000000</span>, <span class="dv">50000000</span>),</span>
<span id="cb247-7"><a href="#cb247-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">gastos =</span> <span class="fu">runif</span>(n, <span class="dv">800000</span>, <span class="dv">45000000</span>),</span>
<span id="cb247-8"><a href="#cb247-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">activos =</span> <span class="fu">runif</span>(n, <span class="dv">2000000</span>, <span class="dv">100000000</span>),</span>
<span id="cb247-9"><a href="#cb247-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">deuda =</span> <span class="fu">runif</span>(n, <span class="dv">500000</span>, <span class="dv">30000000</span>),</span>
<span id="cb247-10"><a href="#cb247-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">empleados =</span> <span class="fu">round</span>(<span class="fu">runif</span>(n, <span class="dv">50</span>, <span class="dv">2000</span>)),</span>
<span id="cb247-11"><a href="#cb247-11" aria-hidden="true" tabindex="-1"></a>  años<span class="at">_mercado =</span> <span class="fu">round</span>(<span class="fu">runif</span>(n, <span class="dv">1</span>, <span class="dv">30</span>))</span>
<span id="cb247-12"><a href="#cb247-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb247-13"><a href="#cb247-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-14"><a href="#cb247-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear características derivadas</span></span>
<span id="cb247-15"><a href="#cb247-15" aria-hidden="true" tabindex="-1"></a>empresa_data <span class="ot">&lt;-</span> empresa_data <span class="sc">%&gt;%</span></span>
<span id="cb247-16"><a href="#cb247-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb247-17"><a href="#cb247-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ratios financieros</span></span>
<span id="cb247-18"><a href="#cb247-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">margen_beneficio =</span> (ingresos <span class="sc">-</span> gastos) <span class="sc">/</span> ingresos,</span>
<span id="cb247-19"><a href="#cb247-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">ratio_deuda =</span> deuda <span class="sc">/</span> activos,</span>
<span id="cb247-20"><a href="#cb247-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">productividad =</span> ingresos <span class="sc">/</span> empleados,</span>
<span id="cb247-21"><a href="#cb247-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb247-22"><a href="#cb247-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Métricas de eficiencia</span></span>
<span id="cb247-23"><a href="#cb247-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">roi_empleados =</span> (ingresos <span class="sc">-</span> gastos) <span class="sc">/</span> empleados,</span>
<span id="cb247-24"><a href="#cb247-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">crecimiento_anualizado =</span> ingresos <span class="sc">/</span> años_mercado,</span>
<span id="cb247-25"><a href="#cb247-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb247-26"><a href="#cb247-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Categorización de empresas</span></span>
<span id="cb247-27"><a href="#cb247-27" aria-hidden="true" tabindex="-1"></a>    tamaño <span class="ot">=</span> <span class="fu">case_when</span>(</span>
<span id="cb247-28"><a href="#cb247-28" aria-hidden="true" tabindex="-1"></a>      empleados <span class="sc">&lt;</span> <span class="dv">100</span> <span class="sc">~</span> <span class="st">"Pequeña"</span>,</span>
<span id="cb247-29"><a href="#cb247-29" aria-hidden="true" tabindex="-1"></a>      empleados <span class="sc">&lt;</span> <span class="dv">500</span> <span class="sc">~</span> <span class="st">"Mediana"</span>,</span>
<span id="cb247-30"><a href="#cb247-30" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Grande"</span></span>
<span id="cb247-31"><a href="#cb247-31" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb247-32"><a href="#cb247-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb247-33"><a href="#cb247-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Índices compuestos</span></span>
<span id="cb247-34"><a href="#cb247-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">salud_financiera =</span> (margen_beneficio <span class="sc">*</span> <span class="fl">0.4</span>) <span class="sc">+</span> ((<span class="dv">1</span> <span class="sc">-</span> ratio_deuda) <span class="sc">*</span> <span class="fl">0.3</span>) <span class="sc">+</span> </span>
<span id="cb247-35"><a href="#cb247-35" aria-hidden="true" tabindex="-1"></a>                      (<span class="fu">pmin</span>(productividad<span class="sc">/</span><span class="fu">median</span>(productividad), <span class="dv">2</span>) <span class="sc">*</span> <span class="fl">0.3</span>),</span>
<span id="cb247-36"><a href="#cb247-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb247-37"><a href="#cb247-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Variables de interacción</span></span>
<span id="cb247-38"><a href="#cb247-38" aria-hidden="true" tabindex="-1"></a>    experiencia_tamaño <span class="ot">=</span> años_mercado <span class="sc">*</span> <span class="fu">log</span>(empleados),</span>
<span id="cb247-39"><a href="#cb247-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb247-40"><a href="#cb247-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Transformaciones</span></span>
<span id="cb247-41"><a href="#cb247-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">log_ingresos =</span> <span class="fu">log</span>(ingresos),</span>
<span id="cb247-42"><a href="#cb247-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">sqrt_empleados =</span> <span class="fu">sqrt</span>(empleados)</span>
<span id="cb247-43"><a href="#cb247-43" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb247-44"><a href="#cb247-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-45"><a href="#cb247-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Variable respuesta: valoración de empresa</span></span>
<span id="cb247-46"><a href="#cb247-46" aria-hidden="true" tabindex="-1"></a>empresa_data<span class="sc">$</span>valoracion <span class="ot">&lt;-</span> </span>
<span id="cb247-47"><a href="#cb247-47" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2</span> <span class="sc">*</span> empresa_data<span class="sc">$</span>log_ingresos <span class="sc">+</span></span>
<span id="cb247-48"><a href="#cb247-48" aria-hidden="true" tabindex="-1"></a>  <span class="dv">100000</span> <span class="sc">*</span> empresa_data<span class="sc">$</span>margen_beneficio <span class="sc">+</span></span>
<span id="cb247-49"><a href="#cb247-49" aria-hidden="true" tabindex="-1"></a>  <span class="dv">50000</span> <span class="sc">*</span> empresa_data<span class="sc">$</span>salud_financiera <span class="sc">+</span></span>
<span id="cb247-50"><a href="#cb247-50" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1000</span> <span class="sc">*</span> empresa_data<span class="sc">$</span>experiencia_tamaño <span class="sc">+</span></span>
<span id="cb247-51"><a href="#cb247-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">500000</span>)</span>
<span id="cb247-52"><a href="#cb247-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-53"><a href="#cb247-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Análisis de las características creadas</span></span>
<span id="cb247-54"><a href="#cb247-54" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== INGENIERÍA DE CARACTERÍSTICAS ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== INGENIERÍA DE CARACTERÍSTICAS ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb249"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb249-1"><a href="#cb249-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Características creadas:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Características creadas:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb251"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb251-1"><a href="#cb251-1" aria-hidden="true" tabindex="-1"></a>nuevas_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"margen_beneficio"</span>, <span class="st">"ratio_deuda"</span>, <span class="st">"productividad"</span>, <span class="st">"roi_empleados"</span>, </span>
<span id="cb251-2"><a href="#cb251-2" aria-hidden="true" tabindex="-1"></a>                <span class="st">"salud_financiera"</span>, <span class="st">"experiencia_tamaño"</span>)</span>
<span id="cb251-3"><a href="#cb251-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-4"><a href="#cb251-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(var <span class="cf">in</span> nuevas_vars) {</span>
<span id="cb251-5"><a href="#cb251-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"-"</span>, var, <span class="st">": rango ["</span>, <span class="fu">round</span>(<span class="fu">min</span>(empresa_data[[var]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="dv">3</span>), </span>
<span id="cb251-6"><a href="#cb251-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">","</span>, <span class="fu">round</span>(<span class="fu">max</span>(empresa_data[[var]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="dv">3</span>), <span class="st">"]</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb251-7"><a href="#cb251-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>- margen_beneficio : rango [ -14.132 , 0.953 ]
- ratio_deuda : rango [ 0.011 , 11.8 ]
- productividad : rango [ 1759.799 , 449755.3 ]
- roi_empleados : rango [ -596799.6 , 150903.9 ]
- salud_financiera : rango [ -7.331 , 1.168 ]
- experiencia_tamaño : rango [ 4.7 , 220.669 ]</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb253"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb253-1"><a href="#cb253-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Matriz de correlaciones para nuevas variables</span></span>
<span id="cb253-2"><a href="#cb253-2" aria-hidden="true" tabindex="-1"></a>cor_nuevas <span class="ot">&lt;-</span> <span class="fu">cor</span>(empresa_data[, <span class="fu">c</span>(nuevas_vars, <span class="st">"valoracion"</span>)], <span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb253-3"><a href="#cb253-3" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(cor_nuevas, <span class="at">method =</span> <span class="st">"color"</span>, <span class="at">addCoef.col =</span> <span class="st">"black"</span>, <span class="at">number.cex =</span> <span class="fl">0.7</span>,</span>
<span id="cb253-4"><a href="#cb253-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">title =</span> <span class="st">"Correlaciones - Variables Engineered"</span>, <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lab3_ingenieria_caracteristicas_files/figure-html/feature_engineering-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="modelo-con-variables-engineered" class="level3">
<h3 class="anchored" data-anchor-id="modelo-con-variables-engineered">Modelo con Variables Engineered</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb254"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb254-1"><a href="#cb254-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Modelo básico con variables originales</span></span>
<span id="cb254-2"><a href="#cb254-2" aria-hidden="true" tabindex="-1"></a>modelo_original <span class="ot">&lt;-</span> <span class="fu">lm</span>(valoracion <span class="sc">~</span> ingresos <span class="sc">+</span> gastos <span class="sc">+</span> activos <span class="sc">+</span> deuda <span class="sc">+</span> empleados <span class="sc">+</span> años_mercado, </span>
<span id="cb254-3"><a href="#cb254-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> empresa_data)</span>
<span id="cb254-4"><a href="#cb254-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb254-5"><a href="#cb254-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Modelo con variables engineered</span></span>
<span id="cb254-6"><a href="#cb254-6" aria-hidden="true" tabindex="-1"></a>modelo_engineered <span class="ot">&lt;-</span> <span class="fu">lm</span>(valoracion <span class="sc">~</span> log_ingresos <span class="sc">+</span> margen_beneficio <span class="sc">+</span> ratio_deuda <span class="sc">+</span> </span>
<span id="cb254-7"><a href="#cb254-7" aria-hidden="true" tabindex="-1"></a>                       productividad <span class="sc">+</span> salud_financiera <span class="sc">+</span> experiencia_tamaño, </span>
<span id="cb254-8"><a href="#cb254-8" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> empresa_data)</span>
<span id="cb254-9"><a href="#cb254-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb254-10"><a href="#cb254-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Comparar modelos</span></span>
<span id="cb254-11"><a href="#cb254-11" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== COMPARACIÓN MODELOS ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== COMPARACIÓN MODELOS ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb256"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb256-1"><a href="#cb256-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Modelo original:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Modelo original:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb258"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb258-1"><a href="#cb258-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  R²:"</span>, <span class="fu">round</span>(<span class="fu">summary</span>(modelo_original)<span class="sc">$</span>r.squared, <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  R²: 0.189 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb260"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  RMSE:"</span>, <span class="fu">round</span>(<span class="fu">sqrt</span>(<span class="fu">mean</span>(<span class="fu">residuals</span>(modelo_original)<span class="sc">^</span><span class="dv">2</span>)), <span class="dv">0</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  RMSE: 542765 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb262"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb262-1"><a href="#cb262-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Modelo engineered:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Modelo engineered:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb264"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb264-1"><a href="#cb264-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  R²:"</span>, <span class="fu">round</span>(<span class="fu">summary</span>(modelo_engineered)<span class="sc">$</span>r.squared, <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  R²: 0.3608 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb266"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb266-1"><a href="#cb266-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  RMSE:"</span>, <span class="fu">round</span>(<span class="fu">sqrt</span>(<span class="fu">mean</span>(<span class="fu">residuals</span>(modelo_engineered)<span class="sc">^</span><span class="dv">2</span>)), <span class="dv">0</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  RMSE: 481860 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb268"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb268-1"><a href="#cb268-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Interpretación del modelo engineered</span></span>
<span id="cb268-2"><a href="#cb268-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modelo_engineered)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = valoracion ~ log_ingresos + margen_beneficio + ratio_deuda + 
    productividad + salud_financiera + experiencia_tamaño, data = empresa_data)

Residuals:
     Min       1Q   Median       3Q      Max 
-1039147  -360415    10330   315865  1183095 

Coefficients:
                     Estimate Std. Error t value Pr(&gt;|t|)  
(Intercept)        -7.399e+05  1.484e+06  -0.498   0.6189  
log_ingresos        6.013e+04  9.441e+04   0.637   0.5252  
margen_beneficio    2.785e+05  1.290e+05   2.160   0.0325 *
ratio_deuda        -1.236e+05  1.020e+05  -1.212   0.2277  
productividad       1.391e+00  9.109e-01   1.527   0.1289  
salud_financiera   -3.465e+05  3.257e+05  -1.064   0.2891  
experiencia_tamaño  6.026e+02  7.372e+02   0.817   0.4150  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 493500 on 143 degrees of freedom
Multiple R-squared:  0.3608,    Adjusted R-squared:  0.334 
F-statistic: 13.45 on 6 and 143 DF,  p-value: 4.617e-12</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb270"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb270-1"><a href="#cb270-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== INTERPRETACIÓN BUSINESS ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== INTERPRETACIÓN BUSINESS ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb272"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb272-1"><a href="#cb272-1" aria-hidden="true" tabindex="-1"></a>coef_eng <span class="ot">&lt;-</span> <span class="fu">coef</span>(modelo_engineered)</span>
<span id="cb272-2"><a href="#cb272-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Logaritmo de ingresos:"</span>, <span class="fu">round</span>(coef_eng[<span class="dv">2</span>], <span class="dv">0</span>), <span class="st">"→ Elasticidad de valoración respecto a ingresos</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Logaritmo de ingresos: 60129 → Elasticidad de valoración respecto a ingresos</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb274"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb274-1"><a href="#cb274-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Margen de beneficio:"</span>, <span class="fu">round</span>(coef_eng[<span class="dv">3</span>], <span class="dv">0</span>), <span class="st">"→ Valoración adicional por punto de margen</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Margen de beneficio: 278513 → Valoración adicional por punto de margen</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb276"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb276-1"><a href="#cb276-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Salud financiera:"</span>, <span class="fu">round</span>(coef_eng[<span class="dv">6</span>], <span class="dv">0</span>), <span class="st">"→ Premio por buena gestión financiera</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Salud financiera: -346490 → Premio por buena gestión financiera</code></pre>
</div>
</div>
</section>
</section>
<section id="parte-9-conceptos-clave-para-recordar" class="level2">
<h2 class="anchored" data-anchor-id="parte-9-conceptos-clave-para-recordar">Parte 9: Conceptos Clave para Recordar</h2>
<section id="guía-de-decisión-para-transformaciones" class="level3">
<h3 class="anchored" data-anchor-id="guía-de-decisión-para-transformaciones">Guía de Decisión para Transformaciones</h3>
<div class="callout callout-style-default callout-important callout-titled" title="Cuándo usar cada transformación">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>Cuándo usar cada transformación
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Transformación Logarítmica:</strong></p>
<ul>
<li>Relaciones exponenciales o multiplicativas</li>
<li>Heterocedasticidad proporcional al nivel</li>
<li>Variables con rango muy amplio</li>
<li>Interpretación en términos de cambios porcentuales</li>
</ul>
<p><strong>Transformación Raíz Cuadrada:</strong></p>
<ul>
<li>Datos de conteo (distribución Poisson)</li>
<li>Varianza proporcional a la media</li>
<li>Estabilización de varianza moderada</li>
</ul>
<p><strong>Transformación Box-Cox:</strong></p>
<ul>
<li>Cuando no está claro qué transformación usar</li>
<li>Optimización automática del parámetro</li>
<li>Solo para datos estrictamente positivos</li>
</ul>
<p><strong>Transformación Yeo-Johnson:</strong></p>
<ul>
<li>Extensión de Box-Cox para datos con negativos o ceros</li>
<li>Mayor flexibilidad en el rango de datos</li>
</ul>
</div>
</div>
</section>
<section id="estrategias-de-codificación" class="level3">
<h3 class="anchored" data-anchor-id="estrategias-de-codificación">Estrategias de Codificación</h3>
<div class="callout callout-style-default callout-note callout-titled" title="Variables Categóricas">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Variables Categóricas
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>One-Hot Encoding:</strong></p>
<ul>
<li>Variables nominales (sin orden natural)</li>
<li>Cuando cada categoría debe tratarse independientemente</li>
<li>Facilita interpretación individual de efectos</li>
</ul>
<p><strong>Codificación Ordinal:</strong></p>
<ul>
<li>Variables con orden natural claro</li>
<li>Cuando el orden es relevante para el fenómeno</li>
<li>Reduce dimensionalidad y mantiene información ordinal</li>
</ul>
<p><strong>Consideraciones:</strong></p>
<ul>
<li>Siempre verificar que el método preserve la naturaleza de la variable</li>
<li>Evitar la “dummy variable trap” en modelos lineales</li>
<li>Considerar el impacto en la interpretación</li>
</ul>
</div>
</div>
</section>
<section id="principios-para-interacciones" class="level3">
<h3 class="anchored" data-anchor-id="principios-para-interacciones">Principios para Interacciones</h3>
<div class="callout callout-style-default callout-warning callout-titled" title="Mejores Prácticas">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Warning</span>Mejores Prácticas
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Identificación:</strong></p>
<ul>
<li>Justificación teórica antes que búsqueda automática</li>
<li>Exploración visual sistemática</li>
<li>Validación estadística formal</li>
</ul>
<p><strong>Interpretación:</strong></p>
<ul>
<li>Los efectos principales cambian de significado</li>
<li>Calcular efectos marginales en diferentes niveles</li>
<li>Usar visualizaciones para comunicar efectos complejos</li>
</ul>
<p><strong>Limitaciones:</strong></p>
<ul>
<li>Incremento exponencial de complejidad</li>
<li>Riesgo de sobreajuste con múltiples interacciones</li>
<li>Problemas de multicolinealidad</li>
</ul>
</div>
</div>
</section>
<section id="workflow-de-ingeniería-de-características" class="level3">
<h3 class="anchored" data-anchor-id="workflow-de-ingeniería-de-características">Workflow de Ingeniería de Características</h3>
<ol type="1">
<li><strong>Diagnóstico</strong>: Identificar problemas específicos</li>
<li><strong>Transformación</strong>: Aplicar soluciones apropiadas</li>
<li><strong>Codificación</strong>: Tratar variables categóricas correctamente</li>
<li><strong>Interacciones</strong>: Explorar efectos combinados</li>
<li><strong>Validación</strong>: Verificar mejoras en datos independientes</li>
<li><strong>Interpretación</strong>: Mantener significado business</li>
</ol>
</section>
</section>
<section id="próximo-laboratorio" class="level2">
<h2 class="anchored" data-anchor-id="próximo-laboratorio">Próximo Laboratorio</h2>
<p>En el Laboratorio 4 exploraremos técnicas de selección de variables y regularización, incluyendo métodos como Ridge, Lasso y Elastic Net para manejar modelos con muchas características.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>